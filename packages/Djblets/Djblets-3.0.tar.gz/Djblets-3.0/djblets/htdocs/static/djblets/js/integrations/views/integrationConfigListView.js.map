{"version":3,"file":"integrationConfigListView.js","names":["IntegrationConfigItem","Djblets","Config","ListItem","extend","defaults","_","removeLabel","showRemove","prototype","url","get","parse","data","editURL","id","integrationID","itemState","enabled","name","IntegrationConfigItemView","TableItemView","className","actionHandlers","template","getRenderContext","model","integration","collection","options","integrationsMap","iconSrc","iconSrcSet","integrationName","_onDeleteClicked","$","text","modalBox","title","buttons","click","destroy","beforeSend","xhr","setRequestHeader","csrfToken","IntegrationConfigListView","Backbone","View","events","addIntegrationPopupViewType","AddIntegrationPopupView","listItemsCollectionType","ListItems","listItemType","listViewType","TableView","listItemViewType","initialize","_integrationIDs","integrationIDs","_integrationsMap","list","List","configs","_popup","render","listView","el","ItemView","$el","removeAttr","_$listContainer","parent","listenTo","_showOrHideConfigsList","length","show","hide","_onAddIntegrationClicked","e","preventDefault","stopPropagation","integrations","i","push","appendTo","target"],"sources":["../../../../../../static/djblets/js/integrations/views/integrationConfigListView.es6.js"],"sourcesContent":["(function() {\n\n\n/**\n * List item for a configuration.\n *\n * This stores basic display, actions, and API information for the\n * configuration.\n */\nconst IntegrationConfigItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        removeLabel: _`Delete`,\n        showRemove: true,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Return the API URL for the item.\n     *\n     * This is the same as the ``editURL`` attribute, and is used to\n     * perform HTTP DELETE requests.\n     *\n     * Returns:\n     *     string:\n     *     The URL to perform API operations on.\n     */\n    url() {\n        return this.get('editURL');\n    },\n\n    /**\n     * Return the attributes for this item from a provided payload.\n     *\n     * Args:\n     *     data (object):\n     *         The data for this item provided when constructing the\n     *         integrations page.\n     *\n     * Returns:\n     *     object:\n     *     The new attribute data from the item.\n     */\n    parse(data) {\n        return {\n            editURL: data.editURL,\n            id: data.id,\n            integrationID: data.integrationID,\n            itemState: data.enabled ? 'enabled' : 'disabled',\n            name: data.name,\n        };\n    },\n});\n\n\n/**\n * View for displaying information and actions for a configuration.\n *\n * This renders some basic information on the state of the configuration,\n * and provides actions for deleting configurations.\n */\nconst IntegrationConfigItemView = Djblets.Config.TableItemView.extend({\n    className:\n        'djblets-c-integration-config djblets-c-config-forms-list__item',\n\n    actionHandlers: {\n        'delete': '_onDeleteClicked',\n    },\n\n    template: _.template(dedent`\n        <td class=\"djblets-c-integration-config__name\">\n         <img src=\"<%- iconSrc %>\"\n              srcset=\"<%- iconSrcSet %>\"\n              width=\"32\" height=\"32\" alt=\"\">\n         <a href=\"<%- editURL %>\"><%- name %></a>\n        </td>\n        <td class=\"djblets-c-integration-config__integration-name\">\n         <%- integrationName %>\n        </td>\n        <td class=\"djblets-c-config-forms-list__item-state\"></td>\n        <td></td>\n    `),\n\n    /**\n     * Return context data for rendering the item's template.\n     *\n     * Returns:\n     *     object:\n     *     Context data for the render.\n     */\n    getRenderContext() {\n        const integrationID = this.model.get('integrationID');\n        const integration =\n            this.model.collection.options.integrationsMap[integrationID];\n\n        return {\n            iconSrc: integration.iconSrc,\n            iconSrcSet: integration.iconSrcSet,\n            integrationName: integration.name,\n        };\n    },\n\n    /**\n     * Handle the Delete action on the item.\n     *\n     * This will display a confirmation dialog, and then send an HTTP DELETE\n     * to remove the configuration.\n     */\n    _onDeleteClicked() {\n        $('<p>')\n            .text(_`\n                This integration will be permanently removed. This cannot\n                be undone.\n            `)\n            .modalBox({\n                title: _`Are you sure you want to delete this integration?`,\n                buttons: [\n                    $('<button>')\n                        .text(_`Cancel`),\n                    $('<button class=\"danger\">')\n                        .text(_`Delete Integration`)\n                        .click(() => this.model.destroy({\n                            beforeSend: xhr => {\n                                xhr.setRequestHeader(\n                                    'X-CSRFToken',\n                                    this.model.collection.options.csrfToken);\n                            },\n                        })),\n                ],\n            });\n    },\n});\n\n\n/**\n * View for managing the integration configurations list.\n *\n * This handles events for the Add Integration button and the resulting popup.\n */\nDjblets.IntegrationConfigListView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-integration-configs__add': '_onAddIntegrationClicked',\n    },\n\n    addIntegrationPopupViewType: Djblets.AddIntegrationPopupView,\n    listItemsCollectionType: Djblets.Config.ListItems,\n    listItemType: IntegrationConfigItem,\n    listViewType: Djblets.Config.TableView,\n    listItemViewType: IntegrationConfigItemView,\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     configs (Array):\n     *         An array of data on the configurations, in display order.\n     *\n     *     integrationIDs (Array):\n     *         An array of integration IDs, in display order.\n     *\n     *     integrationsMap (object):\n     *         A mapping of integration ID to information.\n     */\n    initialize(options) {\n        this._integrationIDs = options.integrationIDs;\n        this._integrationsMap = options.integrationsMap;\n\n        this.list = new Djblets.Config.List(\n            {},\n            {\n                collection: new this.listItemsCollectionType(\n                    options.configs,\n                    {\n                        csrfToken: options.csrfToken,\n                        integrationsMap: options.integrationsMap,\n                        model: this.listItemType,\n                        parse: true,\n                    }\n                ),\n            });\n\n        this._popup = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     Djblets.IntegrationConfigListView:\n     *     This view, for chaining.\n     */\n    render() {\n        this.listView = new this.listViewType({\n            el: this.$('.djblets-c-config-forms-list'),\n            model: this.list,\n            ItemView: this.listItemViewType,\n        });\n        this.listView.render().$el\n            .removeAttr('aria-busy');\n\n        this._$listContainer = this.listView.$el.parent();\n\n        this.listenTo(this.list.collection, 'add remove',\n                      this._showOrHideConfigsList);\n        this._showOrHideConfigsList();\n\n        return this;\n    },\n\n    /**\n     * Show or hide the list of configurations.\n     *\n     * This will show the list's container if there's at least one item to\n     * show, or hide it if the list is empty.\n     */\n    _showOrHideConfigsList() {\n        if (this.list.collection.length > 0) {\n            this._$listContainer.show();\n        } else {\n            this._$listContainer.hide();\n        }\n    },\n\n    /**\n     * Handler for the Add Integration button.\n     *\n     * This will show the integrations list popup, allowing the user to choose\n     * an integration to add.\n     *\n     * The logic for showing the popup will align the popup with the left-hand\n     * side of the Add Integration button, and set the width to the maximum\n     * amount that will cleanly fit a row of tiles without obscuring any part\n     * of a tile or leaving extra space after a tile.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onAddIntegrationClicked(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!this._popup) {\n            const integrationIDs = this._integrationIDs;\n            const integrationsMap = this._integrationsMap;\n            const integrations = [];\n\n            for (let i = 0; i < integrationIDs.length; i++) {\n                integrations.push(integrationsMap[integrationIDs[i]]);\n            }\n\n            this._popup = new this.addIntegrationPopupViewType({\n                integrations: integrations,\n            });\n            this._popup.render().$el.appendTo(this.$el);\n        }\n\n        this._popup.show($(e.target));\n    },\n});\n\n\n})();\n"],"mappings":"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"}