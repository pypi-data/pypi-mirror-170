{"version":3,"file":"listEditView.js","names":["entryTemplate","_","template","Djblets","Forms","ListEditView","Backbone","View","extend","events","initialize","options","_removeText","removeText","_fieldName","fieldName","_renderedDefaultRow","renderedDefaultRow","_numItems","render","$el","data","_$list","children","find","length","$","val","_$addBtn","_createDefaultEntry","index","$entry","_updateEntryInputName","on","e","_addItem","$inputs","each","idx","el","attr","preventDefault","stopPropagation","append","_removeItem","$target","target","closest","remove","$defaultEntry","replaceWith"],"sources":["../../../../../../static/djblets/js/forms/views/listEditView.es6.js"],"sourcesContent":["(function() {\n\n\nconst entryTemplate = _.template(dedent`\n    <li class=\"djblets-c-list-edit-widget__entry\"\n        data-list-index=\"<%- index %>\">\n      <%= renderedDefaultRow %>\n     <a href=\"#\" class=\"djblets-c-list-edit-widget__remove-item\"\n        role=\"button\" title=\"<%- removeText %>\">\n       <span class=\"fa fa-times\"></span>\n     </a>\n    </li>\n`);\n\n/**\n * A view for editing a list of elements.\n *\n * This is the JavaScript view for\n * :py:class:`djblets.forms.widgets.ListEditWidget`.\n */\nDjblets.Forms.ListEditView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-list-edit-widget__add-item': '_addItem',\n        'click .djblets-c-list-edit-widget__remove-item': '_removeItem',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Version Changed:\n     *     3.0:\n     *     * Removed the `inputAttrs` option.\n     *     * Removed the `sep` option.\n     *     * Added the `fieldName` option.\n     *     * Added the `renderedDefaultRow` option.\n     *\n     * Args:\n     *     options (object):\n     *         The view options.\n     *\n     * Option Args:\n     *     removeText (string):\n     *         The localized text for removing an item.\n     *\n     *     fieldName (string):\n     *         The form field name corresponding to this ListEditWidget.\n     *\n     *     renderedDefaultRow (string):\n     *         The HTML for a default item in the list. This is used to\n     *         render a default item when adding a new item to the list.\n     */\n    initialize(options) {\n        this._removeText = options.removeText;\n        this._fieldName = options.fieldName;\n        this._renderedDefaultRow = options.renderedDefaultRow;\n        this._numItems = 0;\n\n    },\n\n    /**\n     * Render the view.\n     *\n     * Since most of the view is rendered by Django, this just sets up some\n     * event listeners.\n     *\n     * Returns:\n     *     Djblets.Forms.ListEditView:\n     *     This view.\n     */\n    render() {\n        this.$el.data('djblets-list-edit-view', this);\n\n        this._$list = this.$el.children(\n            '.djblets-c-list-edit-widget__entries');\n        this._numItems = this._$list.find('.djblets-c-list-edit-widget__entry').length;\n        $(`input[name=\"${this._fieldName}_num_rows\"]`).val(this._numItems);\n        this._$addBtn = this.$el.children(\n            '.djblets-c-list-edit-widget__add-item');\n\n        return this;\n    },\n\n    /**\n     * Create and format the HTML for a new entry in the list.\n     *\n     * Args:\n     *     index (int):\n     *         The index of the new entry in the list of entries.\n     *\n     * Returns:\n     *     jQuery:\n     *     The HTML for the new entry in the list.\n     */\n    _createDefaultEntry(index) {\n        const $entry = $(entryTemplate({\n            index: index,\n            renderedDefaultRow: this._renderedDefaultRow,\n            removeText: this._removeText,\n        }));\n        this._updateEntryInputName($entry, index);\n        $(`input[name=\"${this._fieldName}_num_rows\"]`).val(index+1);\n        $entry.find('.djblets-c-list-edit-widget__add-item')\n              .on('click', e => this._addItem(e));\n        return $entry;\n    },\n\n    /**\n     * Update the name(s) of the entry's .djblets-c-list-edit-widget__input(s)\n     * so that they contain the appropriate index for the entry.\n     *\n     * Args:\n     *     $entry (jQuery):\n     *         The entry to update.\n     *\n     *     index (int):\n     *         The index of the entry in the list of entries.\n     */\n    _updateEntryInputName($entry, index) {\n        const $inputs = $entry.find('.djblets-c-list-edit-widget__input');\n\n        // The entry may have more than one \"input\".\n        if ($inputs.length > 1) {\n            $inputs.each((idx, el) =>\n                $(el).attr('name',\n                           `${this._fieldName}_value[${index}]_${idx}`));\n        } else {\n            $inputs.attr('name', `${this._fieldName}_value[${index}]`);\n        }\n    },\n\n    /**\n     * Add an item to the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _addItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._$list.append(this._createDefaultEntry(this._numItems));\n        this._numItems += 1;\n    },\n\n    /**\n     * Remove an item.\n     *\n     * When there is only a single item in the list, we clear it instead of\n     * removing it so there is always at least one item in the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _removeItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $target = $(e.target);\n        const $entry = $target.closest('.djblets-c-list-edit-widget__entry');\n\n        if (this._numItems > 1) {\n            $entry.remove();\n            this._numItems -= 1;\n            this._$list.find('.djblets-c-list-edit-widget__entry')\n                .each((idx, el) => {\n                    const $el = $(el);\n                    $el.attr('data-list-index', idx);\n                    this._updateEntryInputName($el, idx);\n                });\n            $(`input[name=\"${this._fieldName}_num_rows\"]`)\n                .val(this._numItems);\n        } else {\n            const $defaultEntry = this._createDefaultEntry(0);\n            $entry.replaceWith($defaultEntry);\n        }\n    },\n});\n\n\n})();\n"],"mappings":";;AAAA,CAAC,YAAW;EAGZ,MAAMA,aAAa,GAAGC,CAAC,CAACC,QAAF,CAAkB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA,MAPsB,CAAtB;EAWA;AACA;AACA;AACA;AACA;AACA;;;EACAC,OAAO,CAACC,KAAR,CAAcC,YAAd,GAA6BC,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqB;IAC9CC,MAAM,EAAE;MACJ,+CAA+C,UAD3C;MAEJ,kDAAkD;IAF9C,CADsC;;IAM9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,UAAU,CAACC,OAAD,EAAU;MAChB,KAAKC,WAAL,GAAmBD,OAAO,CAACE,UAA3B;MACA,KAAKC,UAAL,GAAkBH,OAAO,CAACI,SAA1B;MACA,KAAKC,mBAAL,GAA2BL,OAAO,CAACM,kBAAnC;MACA,KAAKC,SAAL,GAAiB,CAAjB;IAEH,CArC6C;;IAuC9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,MAAM,GAAG;MACL,KAAKC,GAAL,CAASC,IAAT,CAAc,wBAAd,EAAwC,IAAxC;MAEA,KAAKC,MAAL,GAAc,KAAKF,GAAL,CAASG,QAAT,CACV,sCADU,CAAd;MAEA,KAAKL,SAAL,GAAiB,KAAKI,MAAL,CAAYE,IAAZ,CAAiB,oCAAjB,EAAuDC,MAAxE;MACAC,CAAC,CAAE,eAAc,KAAKZ,UAAW,aAAhC,CAAD,CAA+Ca,GAA/C,CAAmD,KAAKT,SAAxD;MACA,KAAKU,QAAL,GAAgB,KAAKR,GAAL,CAASG,QAAT,CACZ,uCADY,CAAhB;MAGA,OAAO,IAAP;IACH,CA5D6C;;IA8D9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIM,mBAAmB,CAACC,KAAD,EAAQ;MACvB,MAAMC,MAAM,GAAGL,CAAC,CAAC1B,aAAa,CAAC;QAC3B8B,KAAK,EAAEA,KADoB;QAE3Bb,kBAAkB,EAAE,KAAKD,mBAFE;QAG3BH,UAAU,EAAE,KAAKD;MAHU,CAAD,CAAd,CAAhB;;MAKA,KAAKoB,qBAAL,CAA2BD,MAA3B,EAAmCD,KAAnC;;MACAJ,CAAC,CAAE,eAAc,KAAKZ,UAAW,aAAhC,CAAD,CAA+Ca,GAA/C,CAAmDG,KAAK,GAAC,CAAzD;MACAC,MAAM,CAACP,IAAP,CAAY,uCAAZ,EACOS,EADP,CACU,OADV,EACmBC,CAAC,IAAI,KAAKC,QAAL,CAAcD,CAAd,CADxB;MAEA,OAAOH,MAAP;IACH,CApF6C;;IAsF9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,qBAAqB,CAACD,MAAD,EAASD,KAAT,EAAgB;MACjC,MAAMM,OAAO,GAAGL,MAAM,CAACP,IAAP,CAAY,oCAAZ,CAAhB,CADiC,CAGjC;;MACA,IAAIY,OAAO,CAACX,MAAR,GAAiB,CAArB,EAAwB;QACpBW,OAAO,CAACC,IAAR,CAAa,CAACC,GAAD,EAAMC,EAAN,KACTb,CAAC,CAACa,EAAD,CAAD,CAAMC,IAAN,CAAW,MAAX,EACY,GAAE,KAAK1B,UAAW,UAASgB,KAAM,KAAIQ,GAAI,EADrD,CADJ;MAGH,CAJD,MAIO;QACHF,OAAO,CAACI,IAAR,CAAa,MAAb,EAAsB,GAAE,KAAK1B,UAAW,UAASgB,KAAM,GAAvD;MACH;IACJ,CA5G6C;;IA8G9C;AACJ;AACA;AACA;AACA;AACA;AACA;IACIK,QAAQ,CAACD,CAAD,EAAI;MACRA,CAAC,CAACO,cAAF;MACAP,CAAC,CAACQ,eAAF;;MAEA,KAAKpB,MAAL,CAAYqB,MAAZ,CAAmB,KAAKd,mBAAL,CAAyB,KAAKX,SAA9B,CAAnB;;MACA,KAAKA,SAAL,IAAkB,CAAlB;IACH,CA3H6C;;IA6H9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACI0B,WAAW,CAACV,CAAD,EAAI;MACXA,CAAC,CAACO,cAAF;MACAP,CAAC,CAACQ,eAAF;MAEA,MAAMG,OAAO,GAAGnB,CAAC,CAACQ,CAAC,CAACY,MAAH,CAAjB;MACA,MAAMf,MAAM,GAAGc,OAAO,CAACE,OAAR,CAAgB,oCAAhB,CAAf;;MAEA,IAAI,KAAK7B,SAAL,GAAiB,CAArB,EAAwB;QACpBa,MAAM,CAACiB,MAAP;QACA,KAAK9B,SAAL,IAAkB,CAAlB;;QACA,KAAKI,MAAL,CAAYE,IAAZ,CAAiB,oCAAjB,EACKa,IADL,CACU,CAACC,GAAD,EAAMC,EAAN,KAAa;UACf,MAAMnB,GAAG,GAAGM,CAAC,CAACa,EAAD,CAAb;UACAnB,GAAG,CAACoB,IAAJ,CAAS,iBAAT,EAA4BF,GAA5B;;UACA,KAAKN,qBAAL,CAA2BZ,GAA3B,EAAgCkB,GAAhC;QACH,CALL;;QAMAZ,CAAC,CAAE,eAAc,KAAKZ,UAAW,aAAhC,CAAD,CACKa,GADL,CACS,KAAKT,SADd;MAEH,CAXD,MAWO;QACH,MAAM+B,aAAa,GAAG,KAAKpB,mBAAL,CAAyB,CAAzB,CAAtB;;QACAE,MAAM,CAACmB,WAAP,CAAmBD,aAAnB;MACH;IACJ;;EA7J6C,CAArB,CAA7B;AAiKC,CArLD"}