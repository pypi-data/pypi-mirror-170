{"version":3,"file":"pagesView.js","names":["Djblets","Config","PagesView","Backbone","View","extend","initialize","router","Router","routes","listenTo","_onPageChanged","_$activeNav","_$activePage","_preserveMessages","render","_$pageNavs","$","_$pages","eq","addClass","history","start","root","window","location","pathname","pageID","removeClass","length","navigate","find","attr","substr","trigger","replace","filter","remove"],"sources":["../../../../../../static/djblets/js/configForms/views/pagesView.es6.js"],"sourcesContent":["/**\n * Manages a collection of configuration pages.\n *\n * The primary job of this view is to handle sub-page navigation.\n * The actual page will contain several \"pages\" that are shown or hidden\n * depending on what the user has clicked on the sidebar.\n */\nDjblets.Config.PagesView = Backbone.View.extend({\n    /**\n     * Initialize the view.\n     *\n     * This will set up the router for handling page navigation.\n     */\n    initialize() {\n        this.router = new Backbone.Router({\n            routes: {\n                ':pageID': 'page'\n            }\n        });\n        this.listenTo(this.router, 'route:page', this._onPageChanged);\n\n        this._$activeNav = null;\n        this._$activePage = null;\n        this._preserveMessages = true;\n    },\n\n    /**\n     * Render the view.\n     *\n     * This will set the default page to be shown, and instruct Backbone\n     * to begin handling the routing.\n     *\n     * Returns:\n     *     Djblets.Config.PageView:\n     *     This view.\n     */\n    render() {\n        this._$pageNavs = this.$('.djblets-c-config-forms-page-nav__item');\n        this._$pages = this.$('.djblets-c-config-forms-subpage');\n\n        this._$activeNav = this._$pageNavs.eq(0).addClass('-is-active');\n        this._$activePage = this._$pages.eq(0).addClass('-is-active');\n\n        Backbone.history.start({\n            root: window.location.pathname,\n        });\n\n        return this;\n    },\n\n    /**\n     * Handle when the page changes.\n     *\n     * The sidebar will be updated to reflect the current active page,\n     * and the page will be shown.\n     *\n     * If navigating pages manually, any messages provided by the backend\n     * form will be removed. We don't do this the first time there's a\n     * navigation, as this will be called when first rendering the view.\n     *\n     * Args:\n     *     pageID (string):\n     *         The ID of the page that is becoming active.\n     */\n    _onPageChanged(pageID) {\n        this._$activeNav.removeClass('-is-active');\n        this._$activePage.removeClass('-is-active');\n\n        this._$activePage = $(`#page_${pageID}`);\n\n        if (this._$activePage.length === 0) {\n            /*\n             * If the requested page doesn't exist (for example, it might be\n             * hidden, or just typoed), load the first page instead.\n             */\n            this.router.navigate(\n                this._$pageNavs.find('a').attr('href').substr(1),\n                {\n                    trigger: true,\n                    replace: true\n                });\n        } else {\n            this._$activeNav =\n                this._$pageNavs\n                    .filter(`:has(a[href=\"#${pageID}\"])`)\n                    .addClass('-is-active');\n\n            this._$activePage.addClass('-is-active');\n\n            if (!this._preserveMessages) {\n                $('#messages').remove();\n            }\n\n            this._preserveMessages = false;\n        }\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,OAAO,CAACC,MAAR,CAAeC,SAAf,GAA2BC,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqB;EAC5C;AACJ;AACA;AACA;AACA;EACIC,UAAU,GAAG;IACT,KAAKC,MAAL,GAAc,IAAIJ,QAAQ,CAACK,MAAb,CAAoB;MAC9BC,MAAM,EAAE;QACJ,WAAW;MADP;IADsB,CAApB,CAAd;IAKA,KAAKC,QAAL,CAAc,KAAKH,MAAnB,EAA2B,YAA3B,EAAyC,KAAKI,cAA9C;IAEA,KAAKC,WAAL,GAAmB,IAAnB;IACA,KAAKC,YAAL,GAAoB,IAApB;IACA,KAAKC,iBAAL,GAAyB,IAAzB;EACH,CAjB2C;;EAmB5C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,MAAM,GAAG;IACL,KAAKC,UAAL,GAAkB,KAAKC,CAAL,CAAO,wCAAP,CAAlB;IACA,KAAKC,OAAL,GAAe,KAAKD,CAAL,CAAO,iCAAP,CAAf;IAEA,KAAKL,WAAL,GAAmB,KAAKI,UAAL,CAAgBG,EAAhB,CAAmB,CAAnB,EAAsBC,QAAtB,CAA+B,YAA/B,CAAnB;IACA,KAAKP,YAAL,GAAoB,KAAKK,OAAL,CAAaC,EAAb,CAAgB,CAAhB,EAAmBC,QAAnB,CAA4B,YAA5B,CAApB;IAEAjB,QAAQ,CAACkB,OAAT,CAAiBC,KAAjB,CAAuB;MACnBC,IAAI,EAAEC,MAAM,CAACC,QAAP,CAAgBC;IADH,CAAvB;IAIA,OAAO,IAAP;EACH,CAzC2C;;EA2C5C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIf,cAAc,CAACgB,MAAD,EAAS;IACnB,KAAKf,WAAL,CAAiBgB,WAAjB,CAA6B,YAA7B;;IACA,KAAKf,YAAL,CAAkBe,WAAlB,CAA8B,YAA9B;;IAEA,KAAKf,YAAL,GAAoBI,CAAC,CAAE,SAAQU,MAAO,EAAjB,CAArB;;IAEA,IAAI,KAAKd,YAAL,CAAkBgB,MAAlB,KAA6B,CAAjC,EAAoC;MAChC;AACZ;AACA;AACA;MACY,KAAKtB,MAAL,CAAYuB,QAAZ,CACI,KAAKd,UAAL,CAAgBe,IAAhB,CAAqB,GAArB,EAA0BC,IAA1B,CAA+B,MAA/B,EAAuCC,MAAvC,CAA8C,CAA9C,CADJ,EAEI;QACIC,OAAO,EAAE,IADb;QAEIC,OAAO,EAAE;MAFb,CAFJ;IAMH,CAXD,MAWO;MACH,KAAKvB,WAAL,GACI,KAAKI,UAAL,CACKoB,MADL,CACa,iBAAgBT,MAAO,KADpC,EAEKP,QAFL,CAEc,YAFd,CADJ;;MAKA,KAAKP,YAAL,CAAkBO,QAAlB,CAA2B,YAA3B;;MAEA,IAAI,CAAC,KAAKN,iBAAV,EAA6B;QACzBG,CAAC,CAAC,WAAD,CAAD,CAAeoB,MAAf;MACH;;MAED,KAAKvB,iBAAL,GAAyB,KAAzB;IACH;EACJ;;AAxF2C,CAArB,CAA3B"}