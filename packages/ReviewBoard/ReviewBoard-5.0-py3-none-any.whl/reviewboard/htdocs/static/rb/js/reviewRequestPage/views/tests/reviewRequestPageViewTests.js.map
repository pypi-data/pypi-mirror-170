{"version":3,"file":"reviewRequestPageViewTests.js","names":["suite","template","page","pageView","entry1","entry2","beforeEach","$el","$","html","appendTo","$testsScratch","RB","DnDUploader","instance","spyOn","HeaderView","prototype","ReviewRequestPage","checkForUpdates","reviewRequestData","editorData","fileAttachments","mutableByUser","showSendEmail","parse","ReviewRequestPageView","el","model","IssueSummaryTableView","reviewRequest","get","addEntryView","ReviewEntryView","ReviewEntry","review","createReview","shipIt","public","bodyTop","bodyBottom","reviewRequestEditor","find","render","expect","_entryViews","length","toBe","afterEach","describe","it","$el1","$el2","hasClass","click","addClass","ReviewReplyEditorView","and","callThrough","openCommentEditor","getReviewReplyEditorView","toHaveBeenCalled","not"],"sources":["../../../../../../../static/rb/js/reviewRequestPage/views/tests/reviewRequestPageViewTests.es6.js"],"sourcesContent":["suite('rb/reviewRequestPage/views/ReviewRequestPageView', function() {\n    const template = dedent`\n        <div id=\"review-banner\"></div>\n        <a id=\"collapse-all\"></a>\n        <a id=\"expand-all\"></a>\n        <div>\n         <div class=\"review review-request-page-entry\" id=\"review123\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <div class=\"comment-section\" data-context-id=\"123\"\n                 data-context-type=\"diff_comments\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n         </div>\n         <div class=\"review review-request-page-entry\" id=\"review124\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n          </div>\n         </div>\n        </div>\n    `;\n\n    let page;\n    let pageView;\n    let entry1;\n    let entry2;\n\n    beforeEach(function() {\n        const $el = $('<div/>')\n            .html(template)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n        spyOn(RB.HeaderView.prototype, '_ensureSingleton');\n\n        page = new RB.ReviewRequestPage.ReviewRequestPage({\n            checkForUpdates: false,\n            reviewRequestData: {},\n            editorData: {\n                fileAttachments: [],\n                mutableByUser: true,\n                showSendEmail: false,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewRequestPage.ReviewRequestPageView({\n            el: $el,\n            model: page,\n        });\n\n        // Stub this out.\n        spyOn(RB.ReviewRequestPage.IssueSummaryTableView.prototype,\n              'render');\n\n        const reviewRequest = page.get('reviewRequest');\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(123, {\n                    shipIt: true,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review123'),\n        }));\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(124, {\n                    shipIt: false,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review124'),\n        }));\n\n        pageView.render();\n\n        expect(pageView._entryViews.length).toBe(2);\n        entry1 = pageView._entryViews[0];\n        entry2 = pageView._entryViews[1];\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n    });\n\n    describe('Actions', function() {\n        it('Collapse all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n\n            pageView.$('#collapse-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(true);\n            expect($el2.hasClass('collapsed')).toBe(true);\n        });\n\n        it('Expand all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            $el1.addClass('collapsed');\n            $el2.addClass('collapsed');\n\n            pageView.$('#expand-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Methods', function() {\n        describe('openCommentEditor', function() {\n            beforeEach(function() {\n                spyOn(RB.ReviewRequestPage.ReviewReplyEditorView.prototype,\n                      'openCommentEditor');\n                spyOn(entry1, 'getReviewReplyEditorView').and.callThrough();\n                spyOn(entry2, 'getReviewReplyEditorView').and.callThrough();\n            });\n\n            it('With body_top', function() {\n                pageView.openCommentEditor('body_top');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With body_bottom', function() {\n                pageView.openCommentEditor('body_bottom');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With comments', function() {\n                pageView.openCommentEditor('diff_comments', 123);\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n        });\n    });\n});\n"],"mappings":"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"}