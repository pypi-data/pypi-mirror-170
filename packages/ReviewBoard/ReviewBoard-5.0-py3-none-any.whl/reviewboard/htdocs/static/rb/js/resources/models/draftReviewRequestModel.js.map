{"version":3,"file":"draftReviewRequestModel.js","names":["RB","DraftReviewRequest","BaseResource","extend","_","defaults","branch","bugsClosed","changeDescription","changeDescriptionRichText","dependsOn","description","descriptionRichText","rawTextFields","submitter","summary","targetGroups","targetPeople","testingDone","testingDoneRichText","prototype","rspNamespace","listKey","supportsExtraData","expandedFields","extraQueryArgs","attrToJsonMap","deserializedAttrs","url","get","draft","href","createFileAttachment","attributes","DraftFileAttachment","parentObject","publish","options","context","undefined","isFunction","success","error","complete","console","warn","promiseToCallbacks","newOptions","ready","validationError","validate","publishing","BackboneError","errorText","save","data","trivial","parseResourceData","rsp","raw_text_fields","call","links","changedescription_text_type","description_text_type","testing_done_text_type","DraftResourceModelMixin"],"sources":["../../../../../../static/rb/js/resources/models/draftReviewRequestModel.es6.js"],"sourcesContent":["/**\n * The draft of a review request.\n *\n * This provides editing capabilities for a review request draft, as well\n * as the ability to publish and discard (destroy) a draft.\n */\nRB.DraftReviewRequest = RB.BaseResource.extend(_.defaults({\n    defaults() {\n        return _.defaults({\n            branch: null,\n            bugsClosed: null,\n            changeDescription: null,\n            changeDescriptionRichText: false,\n            dependsOn: [],\n            description: null,\n            descriptionRichText: false,\n            'public': null,\n            rawTextFields: null,\n            submitter: null,\n            summary: null,\n            targetGroups: [],\n            targetPeople: [],\n            testingDone: null,\n            testingDoneRichText: false\n        }, RB.BaseResource.prototype.defaults());\n    },\n\n    rspNamespace: 'draft',\n    listKey: 'draft',\n    supportsExtraData: true,\n\n    expandedFields: ['depends_on', 'target_people', 'target_groups'],\n\n    extraQueryArgs: {\n        'force-text-type': 'html',\n        'include-text-types': 'raw'\n    },\n\n    attrToJsonMap: {\n        bugsClosed: 'bugs_closed',\n        changeDescription: 'changedescription',\n        changeDescriptionRichText: 'changedescription_text_type',\n        dependsOn: 'depends_on',\n        descriptionRichText: 'description_text_type',\n        targetGroups: 'target_groups',\n        targetPeople: 'target_people',\n        testingDone: 'testing_done',\n        testingDoneRichText: 'testing_done_text_type'\n    },\n\n    deserializedAttrs: [\n        'branch',\n        'bugsClosed',\n        'changeDescription',\n        'dependsOn',\n        'description',\n        'public',\n        'summary',\n        'targetGroups',\n        'targetPeople',\n        'testingDone'\n    ],\n\n    /**\n     * Return the URL to use when syncing the model.\n     *\n     * Returns:\n     *     string:\n     *     The URL to sync.\n     */\n    url() {\n        return this.get('parentObject').get('links').draft.href;\n    },\n\n    /**\n     * Create a FileAttachment object for this draft.\n     *\n     * Args:\n     *     attributes (object):\n     *         Attributes for the file attachment model.\n     *\n     * Returns:\n     *     RB.DraftFileAttachment:\n     *     The new file attachment object.\n     */\n    createFileAttachment(attributes) {\n        return new RB.DraftFileAttachment(_.defaults({\n            parentObject: this\n        }, attributes));\n    },\n\n    /**\n     * Publish the draft.\n     *\n     * The contents of the draft will be validated before being sent to the\n     * server in order to ensure that the appropriate fields are all there.\n     *\n     * Version Changed:\n     *     5.0:\n     *     Deprecated the callbacks and added a promise return value.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the operation, including callbacks.\n     *\n     *     context (object, optional):\n     *         Context to bind when calling callbacks.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise which resolves when the operation is complete.\n     */\n    async publish(options={}, context=undefined) {\n        if (_.isFunction(options.success) ||\n            _.isFunction(options.error) ||\n            _.isFunction(options.complete)) {\n            console.warn('RB.DraftReview.publish was called using callbacks. ' +\n                         'Callers should be updated to use promises instead.');\n            return RB.promiseToCallbacks(\n                options, context, newOptions => this.publish(newOptions));\n        }\n\n        await this.ready();\n\n        const validationError = this.validate(this.attributes, {\n            publishing: true,\n        });\n\n        if (validationError) {\n            throw new BackboneError(\n                this, { errorText: validationError }, options);\n        }\n\n        await this.save(_.defaults({\n            data: {\n                'public': 1,\n                trivial: options.trivial ? 1 : 0\n            }\n        }, options));\n    },\n\n    parseResourceData(rsp) {\n        const rawTextFields = rsp.raw_text_fields || rsp;\n        const data = RB.BaseResource.prototype.parseResourceData.call(\n            this, rsp);\n\n        data.submitter = rsp.links.submitter;\n        data.changeDescriptionRichText =\n            (rawTextFields.changedescription_text_type === 'markdown');\n        data.descriptionRichText =\n            (rawTextFields.description_text_type === 'markdown');\n        data.testingDoneRichText =\n            (rawTextFields.testing_done_text_type === 'markdown');\n        data.rawTextFields = rawTextFields || null;\n\n        return data;\n    }\n}, RB.DraftResourceModelMixin));\n"],"mappings":"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"}