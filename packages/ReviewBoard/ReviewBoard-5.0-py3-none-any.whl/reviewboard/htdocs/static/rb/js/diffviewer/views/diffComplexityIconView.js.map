{"version":3,"file":"diffComplexityIconView.js","names":["RB","DiffComplexityIconView","Backbone","View","extend","ICON_SIZE","initialize","options","numInserts","numDeletes","numReplaces","totalLines","render","numTotal","numInsertsPct","numDeletesPct","numReplacesPct","minValue","innerRadius","iconColors","getIconColors","$el","width","height","plot","color","insertColor","data","_clampValue","deleteColor","replaceColor","series","pie","show","radius","val","Math","max","_iconColors","$iconColor","$","hide","appendTo","document","body","className","css","remove"],"sources":["../../../../../../static/rb/js/diffviewer/views/diffComplexityIconView.es6.js"],"sourcesContent":["/**\n * Renders an icon showing the general complexity of a diff.\n *\n * This icon is a pie graph showing the percentage of inserts vs deletes\n * vs replaces. The size of the white inner radius is a relative indicator\n * of how large the change is for the file, representing the unchanged lines.\n * Smaller inner radiuses indicate much larger changes, whereas larger\n * radiuses represent smaller changes.\n *\n * Callers are not required to supply the total number of lines or the number\n * of replaces, allowing this to be used when only the most basic insert and\n * delete counts are available.\n */\nRB.DiffComplexityIconView = Backbone.View.extend({\n    ICON_SIZE: 20,\n\n    /**\n     * Initialize the view.\n     *\n     * Each of the provided values will be normalized to something\n     * the view expects.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     numInserts (number, optional):\n     *         The number of inserts in the diff file.\n     *\n     *     numDeletes (number, optional):\n     *         The number of deletes in the diff file.\n     *\n     *     numReplaces (number, optional):\n     *         The number of replaces in the diff file.\n     *\n     *     totalLines (number, optional):\n     *         The total number of lines in the file.\n     */\n    initialize(options) {\n        this.numInserts = options.numInserts || 0;\n        this.numDeletes = options.numDeletes || 0;\n        this.numReplaces = options.numReplaces || 0;\n        this.totalLines = options.totalLines || null;\n    },\n\n    /**\n     * Render the icon.\n     *\n     * Returns:\n     *     RB.DiffComplexityIconView:\n     *     This object, for chaining.\n     */\n    render() {\n        const numTotal = this.numInserts + this.numDeletes + this.numReplaces;\n        const numInsertsPct = this.numInserts / numTotal;\n        const numDeletesPct = this.numDeletes / numTotal;\n        const numReplacesPct = this.numReplaces / numTotal;\n        const minValue = 360 * 0.15;\n        const innerRadius = (\n            0.5 * (this.totalLines === null\n                   ? 1\n                   : (this.totalLines - numTotal) / this.totalLines));\n        const iconColors = RB.DiffComplexityIconView.getIconColors();\n\n        this.$el\n            .width(this.ICON_SIZE)\n            .height(this.ICON_SIZE)\n            .plot(\n                [\n                    {\n                        color: iconColors.insertColor,\n                        data: this._clampValue(numInsertsPct * 360, minValue)\n                    },\n                    {\n                        color: iconColors.deleteColor,\n                        data: this._clampValue(numDeletesPct * 360, minValue)\n                    },\n                    {\n                        color: iconColors.replaceColor,\n                        data: this._clampValue(numReplacesPct * 360, minValue)\n                    },\n                ],\n                {\n                    series: {\n                        pie: {\n                            show: true,\n                            innerRadius: innerRadius,\n                            radius: 0.8,\n                        },\n                    },\n                }\n            );\n\n        return this;\n    },\n\n    /**\n     * Clamp the number to be, at minimum, minValue, unless it is 0.\n     *\n     * Args:\n     *     val (number):\n     *         The number to clamp.\n     *\n     *     minValue (number):\n     *         The minimum to clamp ``val`` to.\n     *\n     * Returns:\n     *     number:\n     *     The clamped number.\n     */\n    _clampValue(val, minValue) {\n        return val === 0 ? 0 : Math.max(val, minValue);\n    },\n}, {\n    _iconColors: null,\n\n    /**\n     * Return the colors used for the complexity icons.\n     *\n     * This will create a temporary icon on the DOM and apply the CSS\n     * styles for each type of change the icon can show. It will then\n     * copy these colors, caching them for all future icons, and return\n     * them.\n     *\n     * Returns:\n     *     object:\n     *     An object containing the colors to use for the icon.\n     */\n    getIconColors() {\n        if (!this._iconColors) {\n            this._iconColors = {};\n\n            const $iconColor = $('<div/>')\n                .hide()\n                .appendTo(document.body);\n\n            $iconColor[0].className = 'diff-changes-icon-insert';\n            this._iconColors.insertColor = $iconColor.css('color');\n\n            $iconColor[0].className = 'diff-changes-icon-replace';\n            this._iconColors.replaceColor = $iconColor.css('color');\n\n            $iconColor[0].className = 'diff-changes-icon-delete';\n            this._iconColors.deleteColor = $iconColor.css('color');\n\n            $iconColor.remove();\n        }\n\n        return this._iconColors;\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,sBAAH,GAA4BC,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqB;EAC7CC,SAAS,EAAE,EADkC;;EAG7C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,UAAU,CAACC,OAAD,EAAU;IAChB,KAAKC,UAAL,GAAkBD,OAAO,CAACC,UAAR,IAAsB,CAAxC;IACA,KAAKC,UAAL,GAAkBF,OAAO,CAACE,UAAR,IAAsB,CAAxC;IACA,KAAKC,WAAL,GAAmBH,OAAO,CAACG,WAAR,IAAuB,CAA1C;IACA,KAAKC,UAAL,GAAkBJ,OAAO,CAACI,UAAR,IAAsB,IAAxC;EACH,CA/B4C;;EAiC7C;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,MAAM,GAAG;IACL,MAAMC,QAAQ,GAAG,KAAKL,UAAL,GAAkB,KAAKC,UAAvB,GAAoC,KAAKC,WAA1D;IACA,MAAMI,aAAa,GAAG,KAAKN,UAAL,GAAkBK,QAAxC;IACA,MAAME,aAAa,GAAG,KAAKN,UAAL,GAAkBI,QAAxC;IACA,MAAMG,cAAc,GAAG,KAAKN,WAAL,GAAmBG,QAA1C;IACA,MAAMI,QAAQ,GAAG,MAAM,IAAvB;IACA,MAAMC,WAAW,GACb,OAAO,KAAKP,UAAL,KAAoB,IAApB,GACE,CADF,GAEE,CAAC,KAAKA,UAAL,GAAkBE,QAAnB,IAA+B,KAAKF,UAF7C,CADJ;IAIA,MAAMQ,UAAU,GAAGnB,EAAE,CAACC,sBAAH,CAA0BmB,aAA1B,EAAnB;IAEA,KAAKC,GAAL,CACKC,KADL,CACW,KAAKjB,SADhB,EAEKkB,MAFL,CAEY,KAAKlB,SAFjB,EAGKmB,IAHL,CAIQ,CACI;MACIC,KAAK,EAAEN,UAAU,CAACO,WADtB;MAEIC,IAAI,EAAE,KAAKC,WAAL,CAAiBd,aAAa,GAAG,GAAjC,EAAsCG,QAAtC;IAFV,CADJ,EAKI;MACIQ,KAAK,EAAEN,UAAU,CAACU,WADtB;MAEIF,IAAI,EAAE,KAAKC,WAAL,CAAiBb,aAAa,GAAG,GAAjC,EAAsCE,QAAtC;IAFV,CALJ,EASI;MACIQ,KAAK,EAAEN,UAAU,CAACW,YADtB;MAEIH,IAAI,EAAE,KAAKC,WAAL,CAAiBZ,cAAc,GAAG,GAAlC,EAAuCC,QAAvC;IAFV,CATJ,CAJR,EAkBQ;MACIc,MAAM,EAAE;QACJC,GAAG,EAAE;UACDC,IAAI,EAAE,IADL;UAEDf,WAAW,EAAEA,WAFZ;UAGDgB,MAAM,EAAE;QAHP;MADD;IADZ,CAlBR;IA6BA,OAAO,IAAP;EACH,CAlF4C;;EAoF7C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIN,WAAW,CAACO,GAAD,EAAMlB,QAAN,EAAgB;IACvB,OAAOkB,GAAG,KAAK,CAAR,GAAY,CAAZ,GAAgBC,IAAI,CAACC,GAAL,CAASF,GAAT,EAAclB,QAAd,CAAvB;EACH;;AApG4C,CAArB,EAqGzB;EACCqB,WAAW,EAAE,IADd;;EAGC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIlB,aAAa,GAAG;IACZ,IAAI,CAAC,KAAKkB,WAAV,EAAuB;MACnB,KAAKA,WAAL,GAAmB,EAAnB;MAEA,MAAMC,UAAU,GAAGC,CAAC,CAAC,QAAD,CAAD,CACdC,IADc,GAEdC,QAFc,CAELC,QAAQ,CAACC,IAFJ,CAAnB;MAIAL,UAAU,CAAC,CAAD,CAAV,CAAcM,SAAd,GAA0B,0BAA1B;MACA,KAAKP,WAAL,CAAiBZ,WAAjB,GAA+Ba,UAAU,CAACO,GAAX,CAAe,OAAf,CAA/B;MAEAP,UAAU,CAAC,CAAD,CAAV,CAAcM,SAAd,GAA0B,2BAA1B;MACA,KAAKP,WAAL,CAAiBR,YAAjB,GAAgCS,UAAU,CAACO,GAAX,CAAe,OAAf,CAAhC;MAEAP,UAAU,CAAC,CAAD,CAAV,CAAcM,SAAd,GAA0B,0BAA1B;MACA,KAAKP,WAAL,CAAiBT,WAAjB,GAA+BU,UAAU,CAACO,GAAX,CAAe,OAAf,CAA/B;MAEAP,UAAU,CAACQ,MAAX;IACH;;IAED,OAAO,KAAKT,WAAZ;EACH;;AApCF,CArGyB,CAA5B"}