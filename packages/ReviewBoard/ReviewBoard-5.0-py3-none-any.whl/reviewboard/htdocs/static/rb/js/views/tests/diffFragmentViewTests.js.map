{"version":3,"file":"diffFragmentViewTests.js","names":["suite","fragmentTemplate","_","template","view","loadDiff","beforeEach","jasmine","createSpy","RB","DiffFragmentView","collapsible","$el","html","$testsScratch","append","spyOn","and","callFake","cb","describe","it","render","expect","hasClass","toBe","_$table","_$thead","css","not","each","_$diffHeaders","headerEl","$","hide","_collapsible","eq","click","toHaveBeenCalled","calls","mostRecent","args","linesOfContext","sel","trigger","isHovering"],"sources":["../../../../../../static/rb/js/views/tests/diffFragmentViewTests.es6.js"],"sourcesContent":["suite('rb/views/DiffFragmentView', function() {\n    const fragmentTemplate = _.template(dedent`\n        <table>\n         <thead>\n         </thead>\n         <tbody class=\"diff-header diff-header-above\">\n          <tr>\n           <td>\n            <div>\n             <a href=\"#\" class=\"diff-expand-btn\"\n                data-lines-of-context=\"20,0\"></a>\n            </div>\n           </td>\n          </tr>\n         </tbody>\n         <tbody class=\"insert\"></tbody>\n         <tbody class=\"insert\">\n          <tr>\n           <td>\n            <div class=\"diff-collapse-btn\" data-lines-of-context=\"0,0\"></div>\n           </td>\n          </tr>\n         </tbody>\n         <tbody class=\"diff-header diff-header-below\">\n          <tr>\n           <td>\n            <div>\n             <a href=\"#\" class=\"diff-expand-btn\"\n                data-lines-of-context=\"0,20\"></a>\n            </div>\n           </td>\n          </tr>\n         </tbody>\n        </table>\n    `);\n\n    let view;\n    let loadDiff;\n\n    beforeEach(function() {\n        loadDiff = jasmine.createSpy('loadDiff');\n\n        view = new RB.DiffFragmentView({\n            loadDiff: loadDiff,\n            collapsible: true,\n        });\n        view.$el.html(fragmentTemplate());\n        $testsScratch.append(view.$el);\n\n        /* Make all the deferred/delayed functions run immediately. */\n        spyOn(_, 'defer').and.callFake(cb => cb());\n        spyOn(_, 'delay').and.callFake(cb => cb());\n    });\n\n    describe('render', function() {\n        it('With visible and collapsible === true', function() {\n            view.render();\n\n            expect(view.$el.hasClass('allow-transitions')).toBe(true);\n            expect(view._$table.hasClass('expanded')).toBe(false);\n            expect(view._$table.hasClass('collapsed')).toBe(true);\n\n            /*\n             * Ideally we'd check for the proper transform values we're setting\n             * (or part of them anyway), but browsers may turn those into\n             * \"matrix(...)\" values. So this is better than nothing.\n             */\n            expect(view._$thead.css('transform')).not.toBe('none');\n\n            _.each(view._$diffHeaders, headerEl => {\n                expect($(headerEl).css('transform')).not.toBe('none');\n            });\n        });\n\n        it('With hidden and collapsible === true', function() {\n            view.$el.hide();\n            view.render();\n\n            expect(view.$el.hasClass('allow-transitions')).toBe(true);\n            expect(view._$table.hasClass('expanded')).toBe(true);\n            expect(view._$table.hasClass('collapsed')).toBe(false);\n\n            /*\n             * Ideally we'd check for the proper transform values we're setting\n             * (or part of them anyway), but browsers may turn those into\n             * \"matrix(...)\" values. So this is better than nothing.\n             */\n            expect(view._$thead.css('transform')).toBe('none');\n\n            _.each(view._$diffHeaders, headerEl => {\n                expect($(headerEl).css('transform')).toBe('none');\n            });\n        });\n\n        it('With collapsible === false', function() {\n            view._collapsible = false;\n            view.render();\n\n            expect(view.$el.hasClass('allow-transitions')).toBe(false);\n            expect(view._$table.hasClass('expanded')).toBe(true);\n            expect(view._$table.hasClass('collapsed')).toBe(false);\n\n            /*\n             * Ideally we'd check for the proper transform values we're setting\n             * (or part of them anyway), but browsers may turn those into\n             * \"matrix(...)\" values. So this is better than nothing.\n             */\n            expect(view._$thead.css('transform')).toBe('none');\n\n            _.each(view._$diffHeaders, headerEl => {\n                expect($(headerEl).css('transform')).toBe('none');\n            });\n        });\n    });\n\n    describe('Events', function() {\n        it('click expansion button', function() {\n            view.render();\n            view.$('.diff-expand-btn').eq(0).click();\n\n            expect(loadDiff).toHaveBeenCalled();\n            expect(loadDiff.calls.mostRecent().args[0].linesOfContext)\n                .toBe('20,0');\n        });\n\n        it('click collapse button', function() {\n            view.render();\n            view.$('.diff-collapse-btn').eq(0).click();\n\n            expect(loadDiff).toHaveBeenCalled();\n            expect(loadDiff.calls.mostRecent().args[0].linesOfContext)\n                .toBe('0,0');\n        });\n\n        describe('mouseenter', function() {\n            it('With collapsible === true', function() {\n                view.render();\n\n                spyOn(view.$el, 'is').and.callFake(sel => {\n                    expect(sel).toBe(':hover');\n\n                    return true;\n                });\n                view.$el.trigger('mouseenter');\n\n                expect(view._$table.hasClass('collapsed')).toBe(false);\n                expect(view._$table.hasClass('expanded')).toBe(true);\n                expect(view._$thead.css('transform')).toBe('none');\n\n                _.each(view._$diffHeaders, headerEl => {\n                    expect($(headerEl).css('transform')).toBe('none');\n                });\n            });\n\n            it('With collapsible === false', function() {\n                view._collapsible = false;\n                view.render();\n\n                spyOn(view.$el, 'is').and.callFake(sel => {\n                    expect(sel).toBe(':hover');\n\n                    return true;\n                });\n                view.$el.trigger('mouseenter');\n\n                expect(view._$table.hasClass('collapsed')).toBe(false);\n                expect(view._$table.hasClass('expanded')).toBe(true);\n                expect(view._$thead.css('transform')).toBe('none');\n\n                _.each(view._$diffHeaders, headerEl => {\n                    expect($(headerEl).css('transform')).toBe('none');\n                });\n            });\n        });\n\n        describe('mouseleave', function() {\n            it('With collapsible === true', function() {\n                let isHovering = true;\n\n                view.render();\n\n                /* First, trigger a mouseenter. */\n                spyOn(view.$el, 'is').and.callFake(sel => {\n                    expect(sel).toBe(':hover');\n\n                    return isHovering;\n                });\n                view.$el.trigger('mouseenter');\n\n                /* Now the mouse leave. */\n                isHovering = false;\n                view.$el.trigger('mouseleave');\n\n                expect(view._$table.hasClass('collapsed')).toBe(true);\n                expect(view._$table.hasClass('expanded')).toBe(false);\n                expect(view._$thead.css('transform')).not.toBe('none');\n\n                _.each(view._$diffHeaders, headerEl => {\n                    expect($(headerEl).css('transform')).not.toBe('none');\n                });\n            });\n\n            it('With collapsible === false', function() {\n                let isHovering = true;\n\n                view._collapsible = false;\n                view.render();\n\n                /* First, trigger a mouseenter. */\n                spyOn(view.$el, 'is').and.callFake(sel => {\n                    expect(sel).toBe(':hover');\n\n                    return isHovering;\n                });\n                view.$el.trigger('mouseenter');\n\n                /* Now the mouse leave. */\n                isHovering = false;\n                view.$el.trigger('mouseleave');\n\n                expect(view._$table.hasClass('collapsed')).toBe(false);\n                expect(view._$table.hasClass('expanded')).toBe(true);\n                expect(view._$thead.css('transform')).toBe('none');\n\n                _.each(view._$diffHeaders, headerEl => {\n                    expect($(headerEl).css('transform')).toBe('none');\n                });\n            });\n        });\n    });\n});\n"],"mappings":"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"}