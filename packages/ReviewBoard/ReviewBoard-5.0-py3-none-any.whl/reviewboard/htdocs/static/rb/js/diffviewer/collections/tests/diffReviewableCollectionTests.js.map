{"version":3,"file":"diffReviewableCollectionTests.js","names":["suite","describe","it","reviewRequest","RB","ReviewRequest","collection","DiffReviewableCollection","expect","toBe","files","beforeEach","DiffFileCollection","spyOn","watchFiles","_populateFromFiles","toHaveBeenCalled","reset","DiffFile","filediff","id","revision","index","interfilediff","commentCounts","baseFileDiffID","forceInterdiff","forceInterdiffRevision","trigger","toHaveBeenCalledWith","length","diffReviewable","at","get","toEqual"],"sources":["../../../../../../../static/rb/js/diffviewer/collections/tests/diffReviewableCollectionTests.es6.js"],"sourcesContent":["suite('rb/diffviewer/collections/DiffReviewableCollection', function() {\n    describe('Construction', function() {\n        it('Sets reviewRequest', function() {\n            const reviewRequest = new RB.ReviewRequest();\n            const collection = new RB.DiffReviewableCollection([], {\n                reviewRequest: reviewRequest,\n            });\n\n            expect(collection.reviewRequest).toBe(reviewRequest);\n        });\n    });\n\n    describe('watchFiles', function() {\n        let collection;\n        let files;\n\n        beforeEach(function() {\n            collection = new RB.DiffReviewableCollection([], {\n                reviewRequest: new RB.ReviewRequest(),\n            });\n            files = new RB.DiffFileCollection();\n        });\n\n        it('Initially populates', function() {\n            spyOn(collection, '_populateFromFiles');\n\n            collection.watchFiles(files);\n\n            expect(collection._populateFromFiles).toHaveBeenCalled();\n        });\n\n        it('Populates on files.reset', function() {\n            spyOn(collection, 'trigger');\n            spyOn(collection, 'reset');\n\n            collection.watchFiles(files);\n\n            files.reset([\n                new RB.DiffFile({\n                    filediff: {\n                        id: 300,\n                        revision: 1,\n                    },\n                    index: 1,\n                    id: 100,\n                }),\n                new RB.DiffFile({\n                    filediff: {\n                        id: 301,\n                        revision: 1,\n                    },\n                    interfilediff: {\n                        id: 400,\n                        revision: 2,\n                    },\n                    index: 2,\n                    id: 101,\n                    commentCounts: [1],\n                }),\n                new RB.DiffFile({\n                    baseFileDiffID: 123,\n                    filediff: {\n                        id: 302,\n                        revision: 2,\n                    },\n                    forceInterdiff: true,\n                    forceInterdiffRevision: 1,\n                    index: 3,\n                    id: 102,\n                }),\n            ]);\n\n            expect(collection.reset).toHaveBeenCalled();\n            expect(collection.trigger).toHaveBeenCalledWith('populating');\n            expect(collection.trigger).toHaveBeenCalledWith('populated');\n            expect(collection.length).toBe(3);\n\n            let diffReviewable = collection.at(0);\n            expect(diffReviewable.get('baseFileDiffID')).toBe(null);\n            expect(diffReviewable.get('file').id).toBe(100);\n            expect(diffReviewable.get('reviewRequest'))\n                .toBe(collection.reviewRequest);\n            expect(diffReviewable.get('fileDiffID')).toBe(300);\n            expect(diffReviewable.get('interFileDiffID')).toBe(null);\n            expect(diffReviewable.get('revision')).toBe(1);\n            expect(diffReviewable.get('interdiffRevision')).toBe(null);\n\n            diffReviewable = collection.at(1);\n            expect(diffReviewable.get('baseFileDiffID')).toBe(null);\n            expect(diffReviewable.get('file').id).toBe(101);\n            expect(diffReviewable.get('reviewRequest'))\n                .toBe(collection.reviewRequest);\n            expect(diffReviewable.get('fileDiffID')).toBe(301);\n            expect(diffReviewable.get('interFileDiffID')).toBe(400);\n            expect(diffReviewable.get('revision')).toBe(1);\n            expect(diffReviewable.get('interdiffRevision')).toBe(2);\n            expect(diffReviewable.get('serializedCommentBlocks')).toEqual([1]);\n\n            diffReviewable = collection.at(2);\n            expect(diffReviewable.get('baseFileDiffID')).toBe(123);\n            expect(diffReviewable.get('file').id).toBe(102);\n            expect(diffReviewable.get('reviewRequest'))\n                .toBe(collection.reviewRequest);\n            expect(diffReviewable.get('fileDiffID')).toBe(302);\n            expect(diffReviewable.get('interFileDiffID')).toBe(null);\n            expect(diffReviewable.get('revision')).toBe(2);\n            expect(diffReviewable.get('interdiffRevision')).toBe(1);\n        });\n    });\n});\n"],"mappings":"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"}