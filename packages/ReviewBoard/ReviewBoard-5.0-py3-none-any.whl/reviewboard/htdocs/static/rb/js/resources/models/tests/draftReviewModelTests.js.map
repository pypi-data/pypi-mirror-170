{"version":3,"file":"draftReviewModelTests.js","names":["suite","model","parentObject","beforeEach","RB","BaseResource","links","reviews","href","DraftReview","rspNamespace","describe","spyOn","Backbone","Model","prototype","and","callFake","options","_","isFunction","success","resolveTo","it","expect","isNew","toBe","get","ready","toHaveBeenCalled","_retrieveDraft","set","id","not","done","console","warn","error","fail","publish","trigger","toHaveBeenCalledWith"],"sources":["../../../../../../../static/rb/js/resources/models/tests/draftReviewModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/DraftReview', function() {\n    let model;\n    let parentObject;\n\n    beforeEach(function() {\n        parentObject = new RB.BaseResource({\n            links: {\n                reviews: {\n                    href: '/api/foos/'\n                },\n            },\n        });\n\n        model = new RB.DraftReview({\n            parentObject: parentObject,\n        });\n        model.rspNamespace = 'foo';\n    });\n\n    describe('Methods', function() {\n        describe('ready', function() {\n            beforeEach(function() {\n                spyOn(Backbone.Model.prototype, 'fetch')\n                    .and.callFake(options => {\n                        if (options && _.isFunction(options.success)) {\n                            options.success();\n                        }\n                    });\n                spyOn(parentObject, 'ready').and.resolveTo();\n                spyOn(model, '_retrieveDraft').and.resolveTo();\n            });\n\n            it('With isNew=true', async function() {\n                expect(model.isNew()).toBe(true);\n                expect(model.get('loaded')).toBe(false);\n\n                await model.ready();\n\n                expect(parentObject.ready).toHaveBeenCalled();\n                expect(model._retrieveDraft).toHaveBeenCalled();\n            });\n\n            it('With isNew=false', async function() {\n                model.set({\n                    id: 123,\n                });\n\n                await model.ready();\n\n                expect(parentObject.ready).toHaveBeenCalled();\n                expect(model._retrieveDraft).not.toHaveBeenCalled();\n            });\n\n            it('With callbacks', function(done) {\n                expect(model.isNew()).toBe(true);\n                expect(model.get('loaded')).toBe(false);\n\n                spyOn(console, 'warn');\n\n                model.ready({\n                    success: () => {\n                        expect(parentObject.ready).toHaveBeenCalled();\n                        expect(model._retrieveDraft).toHaveBeenCalled();\n                        expect(console.warn).toHaveBeenCalled();\n\n                        done();\n                    },\n                    error: () => done.fail(),\n                });\n            });\n        });\n\n        describe('publish', function() {\n            beforeEach(function() {\n                spyOn(model, 'save').and.resolveTo();\n                spyOn(model, 'ready').and.resolveTo();\n            });\n\n            it('Triggers \"publishing\" event before publish', async function() {\n                spyOn(model, 'trigger');\n\n                await model.publish();\n                expect(model.trigger).toHaveBeenCalledWith('publishing');\n            });\n\n            it('Triggers \"published\" event after publish', async function() {\n                spyOn(model, 'trigger');\n\n                await model.publish();\n                expect(model.trigger).toHaveBeenCalledWith('published');\n            });\n\n            it('Sets \"public\" to true', async function() {\n                expect(model.get('public')).toBe(false);\n\n                await model.publish();\n                expect(model.get('public')).toBe(true);\n            });\n        });\n    });\n});\n"],"mappings":"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"}