{"version":3,"file":"fileAttachmentThumbnailViewTests.js","names":["suite","reviewRequest","model","view","beforeEach","RB","ReviewRequest","FileAttachment","downloadURL","filename","spyOn","and","callThrough","describe","expectElements","expect","$","length","toBe","options","canEdit","get","expectAttributeMatches","attr","text","it","$el","addClass","FileAttachmentThumbnail","prototype","className","html","template","_","defaults","caption","captionClass","attributes","set","renderThumbnail","el","$testsScratch","append","render","is","children","id","url","_captionEditorView","startEdit","trigger","toHaveBeenCalledWith","cancel","done","callFake","save","toHaveBeenCalled","val","triggerHandler","submit","success","ajax","destroy","calls","argsFor","fadeOut","click"],"sources":["../../../../../../static/rb/js/views/tests/fileAttachmentThumbnailViewTests.es6.js"],"sourcesContent":["suite('rb/views/FileAttachmentThumbnail', function() {\n    let reviewRequest;\n    let model;\n    let view;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest();\n        model = new RB.FileAttachment({\n            downloadURL: 'http://example.com/file.png',\n            filename: 'file.png',\n        });\n\n        spyOn(model, 'trigger').and.callThrough();\n    });\n\n    describe('Rendering', function() {\n        function expectElements() {\n            expect(view.$('a.edit').length).toBe(1);\n            expect(view.$('.file-caption').length).toBe(1);\n            expect(view.$('.file-actions').length).toBe(1);\n            expect(view.$('.file-delete').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n            expect(view.$('.file-update').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n        }\n\n        function expectAttributeMatches() {\n            expect(view.$('.file-download').attr('href')).toBe(\n                model.get('downloadURL'));\n            expect(view.$('.file-caption .edit').text()).toBe(\n                model.get('caption'));\n        }\n\n        it('Using existing elements', function() {\n            const $el = $('<div/>')\n                .addClass(RB.FileAttachmentThumbnail.prototype.className)\n                .html(RB.FileAttachmentThumbnail.prototype.template(\n                    _.defaults({\n                        caption: 'No caption',\n                        captionClass: 'edit empty-caption',\n                    }, model.attributes)));\n\n            model.set('loaded', true);\n\n            view = new RB.FileAttachmentThumbnail({\n                renderThumbnail: true,\n                reviewRequest: reviewRequest,\n                el: $el,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').is(':visible')).toBe(true);\n            expect(view.$('.fa-spinner').length).toBe(0);\n        });\n\n        it('Rendered thumbnail with unloaded model', function() {\n            view = new RB.FileAttachmentThumbnail({\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').children().length).toBe(0);\n            expect(view.$('.fa-spinner').length).toBe(1);\n        });\n\n        describe('Rendered thumbnail with loaded model', function() {\n            beforeEach(function() {\n                model.id = 123;\n                model.attributes.id = 123;\n                model.set('caption', 'My Caption');\n                model.set('loaded', true);\n                model.url = '/api/file-attachments/123/';\n            });\n\n            it('With review UI', function() {\n                model.set('reviewURL', '/review/');\n\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(1);\n                expect(view.$('.file-add-comment').length).toBe(0);\n            });\n\n            it('No review UI', function() {\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(0);\n                expect(view.$('.file-add-comment').length).toBe(1);\n            });\n        });\n    });\n\n    describe('Actions', function() {\n        beforeEach(function() {\n            model.id = 123;\n            model.attributes.id = 123;\n            model.set('loaded', true);\n            model.url = '/api/file-attachments/123/';\n\n            view = new RB.FileAttachmentThumbnail({\n                canEdit: true,\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            spyOn(view, 'trigger').and.callThrough();\n        });\n\n        it('Begin caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n        });\n\n        it('Cancel caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view._captionEditorView.cancel();\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n        });\n\n        it('Save caption', function(done) {\n            spyOn(model, 'save').and.callFake(() => {\n                expect(view.trigger).toHaveBeenCalledWith('endEdit');\n                expect(model.get('caption')).toBe('Foo');\n                expect(model.save).toHaveBeenCalled();\n\n                done();\n            });\n\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view.$('input')\n                .val('Foo')\n                .triggerHandler('keyup');\n\n            view._captionEditorView.submit();\n        });\n\n        it('Delete', function(done) {\n            spyOn(model, 'destroy').and.callThrough();\n            spyOn($, 'ajax').and.callFake(options => options.success());\n            spyOn(view.$el, 'fadeOut').and.callFake(done => done());\n            spyOn(view, 'remove').and.callFake(() => {\n                expect($.ajax).toHaveBeenCalled();\n                expect(model.destroy).toHaveBeenCalled();\n                expect(model.trigger.calls.argsFor(2)[0]).toBe('destroying');\n                expect(view.$el.fadeOut).toHaveBeenCalled();\n\n                done();\n            });\n\n            view.$('.file-delete').click();\n        });\n    });\n});\n"],"mappings":"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"}