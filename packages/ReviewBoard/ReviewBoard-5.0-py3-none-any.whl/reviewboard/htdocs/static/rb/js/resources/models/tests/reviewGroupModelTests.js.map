{"version":3,"file":"reviewGroupModelTests.js","names":["suite","describe","url","group","session","beforeEach","RB","UserSession","instance","create","username","watchedReviewGroupsURL","ReviewGroup","id","spyOn","watchedGroups","and","callThrough","it","$","callFake","request","expect","type","toBe","success","stat","setStarred","addImmediately","toHaveBeenCalled","apiCall","ajax","removeImmediately","done","console","warn","error","fail","name","data","addUser","set","isNew","expectAsync","toBeRejectedWith","Error","not","removeUser"],"sources":["../../../../../../../static/rb/js/resources/models/tests/reviewGroupModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/ReviewGroup', function() {\n    describe('setStarred', function() {\n        const url = '/api/users/testuser/watched/groups/';\n        let group;\n        let session;\n\n        beforeEach(function() {\n            RB.UserSession.instance = null;\n            session = RB.UserSession.create({\n                username: 'testuser',\n                watchedReviewGroupsURL: url,\n            });\n\n            group = new RB.ReviewGroup({\n                id: 1,\n            });\n\n            spyOn(session.watchedGroups, 'addImmediately').and.callThrough();\n            spyOn(session.watchedGroups, 'removeImmediately').and.callThrough();\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('true', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.setStarred(true);\n\n            expect(session.watchedGroups.addImmediately)\n                .toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('false', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n                expect(request.url).toBe(url + '1/');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.setStarred(false);\n\n            expect(session.watchedGroups.removeImmediately)\n                .toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n            spyOn(console, 'warn');\n\n            group.setStarred(true, {\n                success: () => {\n                    expect(session.watchedGroups.addImmediately)\n                        .toHaveBeenCalled();\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n    });\n\n    describe('addUser', function() {\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('Loaded group', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.addUser('my-user');\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n            spyOn(console, 'warn');\n\n            group.addUser('my-user', {\n                success: () => {\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n\n        it('Unloaded group', async function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            await expectAsync(group.addUser('my-user')).toBeRejectedWith(\n                Error('Unable to add to the group.'));\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n        });\n    });\n\n    describe('removeUser', function() {\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('Loaded group', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n\n            await group.removeUser('my-user');\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n            spyOn(console, 'warn');\n\n            group.removeUser('my-user', {\n                success: () => {\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n\n        it('Unloaded group', async function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            expectAsync(group.removeUser('my-user')).toBeRejectedWith(\n                Error('Unable to remove from the group.'));\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n        });\n    });\n});\n"],"mappings":"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"}