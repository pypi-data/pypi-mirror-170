{"version":3,"file":"reviewEntryViewTests.js","names":["suite","template","view","reviewView","reviewReply","beforeEach","reviewRequest","RB","ReviewRequest","editor","ReviewRequestEditor","review","createReview","loaded","links","replies","href","model","ReviewRequestPage","ReviewEntry","reviewRequestEditor","$el","$","appendTo","$testsScratch","createReply","ReviewEntryView","el","render","_reviewView","spyOn","and","callThrough","_setupNewReply","describe","it","$box","$collapseButton","click","expect","hasClass","toBe","_replyEditorViews","_showReplyDraftBanner","calls","reset","get","not","toHaveBeenCalled","set","collapse","addClass","expand","editorView","getReviewReplyEditorView","undefined"],"sources":["../../../../../../../static/rb/js/reviewRequestPage/views/tests/reviewEntryViewTests.es6.js"],"sourcesContent":["suite('rb/reviewRequestPage/views/ReviewEntryView', function() {\n    const template = dedent`\n        <div class=\"review review-request-page-entry\">\n         <div class=\"review-request-page-entry-contents\">\n          <div class=\"collapse-button\"></div>\n          <div class=\"banners\">\n           <input type=\"button\" value=\"Publish\" />\n           <input type=\"button\" value=\"Discard\" />\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_top\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\">\n            <li class=\"draft\" data-comment-id=\"456\">\n             <pre class=\"reviewtext\"></pre>\n            </li>\n           </ul>\n          </div>\n          <div class=\"comment-section\" data-context-id=\"123\"\n               data-context-type=\"diff_comments\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_bottom\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n         </div>\n        </div>\n    `;\n    let view;\n    let reviewView;\n    let reviewReply;\n\n    beforeEach(function() {\n        const reviewRequest = new RB.ReviewRequest();\n        const editor = new RB.ReviewRequestEditor({\n            reviewRequest: reviewRequest\n        });\n        const review = reviewRequest.createReview({\n            loaded: true,\n            links: {\n                replies: {\n                    href: '/api/review/123/replies/',\n                },\n            },\n        });\n        const model = new RB.ReviewRequestPage.ReviewEntry({\n            review: review,\n            reviewRequest: reviewRequest,\n            reviewRequestEditor: editor,\n        });\n        const $el = $(template).appendTo($testsScratch);\n\n        reviewReply = review.createReply();\n\n        view = new RB.ReviewRequestPage.ReviewEntryView({\n            el: $el,\n            model: model,\n        });\n\n        view.render();\n\n        reviewView = view._reviewView;\n\n        /* Don't allow the draft banner to show. */\n        spyOn(reviewView, '_showReplyDraftBanner');\n        spyOn(reviewView, 'trigger').and.callThrough();\n\n        reviewView._setupNewReply(reviewReply);\n    });\n\n    describe('Actions', function() {\n        it('Toggle collapse', function() {\n            const $box = view.$('.review-request-page-entry-contents');\n            const $collapseButton = view.$('.collapse-button');\n\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(true);\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Draft banner', function() {\n        describe('Visibility', function() {\n            it('Shown on hasDraft', function() {\n                const editor = reviewView._replyEditorViews[1].model;\n\n                reviewView._showReplyDraftBanner.calls.reset();\n\n                expect(editor.get('hasDraft')).toBe(false);\n                expect(reviewView._showReplyDraftBanner).not.toHaveBeenCalled();\n\n                editor.set('hasDraft', true);\n                expect(reviewView._showReplyDraftBanner).toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Methods', function() {\n        it('collapse', function() {\n            view.collapse();\n            expect(\n                view.$('.review-request-page-entry-contents')\n                    .hasClass('collapsed'))\n                .toBe(true);\n        });\n\n        it('expand', function() {\n            const $box = view.$('.review-request-page-entry-contents')\n                .addClass('collapsed');\n            view.expand();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n\n        describe('getReviewReplyEditorView', function() {\n            it('With body_top', function() {\n                const editorView = view.getReviewReplyEditorView('body_top');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[0]);\n            });\n\n            it('With body_bottom', function() {\n                const editorView = view.getReviewReplyEditorView('body_bottom');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[2]);\n            });\n\n            it('With comments', function() {\n                const editorView = view.getReviewReplyEditorView('diff_comments',\n                                                                 123);\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[1]);\n            });\n        });\n    });\n});\n"],"mappings":"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"}