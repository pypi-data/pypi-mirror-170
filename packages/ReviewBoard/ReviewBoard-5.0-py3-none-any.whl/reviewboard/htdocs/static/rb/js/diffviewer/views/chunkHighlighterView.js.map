{"version":3,"file":"chunkHighlighterView.js","names":["RB","ChunkHighlighterView","Backbone","View","extend","className","initialize","_chunkEl","_chunkContainerEl","_$pageContainer","_$window","$","window","_prevWindowWidth","_prevTop","_prevHeight","_","bindAll","render","on","cid","windowWidth","width","updateLayout","remove","prototype","call","off","highlight","$chunk","parents","chunkEl","changed","css","top","Math","floor","offsetTop","height","clientHeight","padding","getExtents","left","right","$el"],"sources":["../../../../../../static/rb/js/diffviewer/views/chunkHighlighterView.es6.js"],"sourcesContent":["/**\n * Highlights a chunk of the diff.\n *\n * This will create and move four border elements around the chunk. We use\n * these border elements instead of setting a border since few browsers\n * render borders on <tbody> tags the same, and give us few options for\n * styling.\n *\n * In practice, there's only ever one highlighter on a page at a time.\n */\nRB.ChunkHighlighterView = Backbone.View.extend({\n    className: 'diff-highlight',\n\n    /**\n     * Initialize the highlighter.\n     */\n    initialize() {\n        this._chunkEl = null;\n        this._chunkContainerEl = null;\n        this._$pageContainer = null;\n        this._$window = $(window);\n        this._prevWindowWidth = null;\n        this._prevTop = null;\n        this._prevHeight = null;\n\n        _.bindAll(this, 'updateLayout');\n    },\n\n    /**\n     * Render the highlighter to the page.\n     *\n     * This will create all the border elements and compute any variables\n     * we want to keep around for further rendering.\n     *\n     * Returns:\n     *     RB.ChunkHighlighterView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._$window.on('resize.' + this.cid, () => {\n            const windowWidth = this._$window.width();\n\n            if (windowWidth !== this._prevWindowWidth) {\n                this._prevWindowWidth = windowWidth;\n\n                this.updateLayout();\n            }\n        });\n\n        this._$pageContainer = $('#page-container');\n\n        this.updateLayout();\n\n        return this;\n    },\n\n    /**\n     * Remove the highlighter from the page and disconnects all events.\n     */\n    remove() {\n        Backbone.View.prototype.remove.call(this);\n\n        this._$window.off(this.cid);\n    },\n\n    /**\n     * Highlight a new chunk element.\n     *\n     * The borders will surround the chunk element and track its position\n     * and size as the page updates.\n     *\n     * Args:\n     *     $chunk (jQuery):\n     *         The chunk element to highlight.\n     */\n    highlight($chunk) {\n        this._chunkEl = $chunk[0];\n        this._chunkContainerEl = $chunk.parents('.diff-container')[0];\n\n        this.updateLayout();\n    },\n\n    /**\n     * Update of the position of the highlighter.\n     */\n    updateLayout() {\n        const chunkEl = this._chunkEl;\n\n        if (!chunkEl) {\n            return;\n        }\n\n        let changed = false;\n        const css = {};\n\n        /*\n         * NOTE: We're hard-coding the border widths (1px) so we don't have to\n         *       look them up. The borders aren't directly on the chunk (and\n         *       may not even be on a child of this chunk), and it's a bit\n         *       slow to look these up.\n         */\n        const top = Math.floor(chunkEl.offsetTop +\n                               this._chunkContainerEl.offsetTop + 1);\n        const height = chunkEl.clientHeight + 1;\n\n        if (top !== this._prevTop) {\n            css.top = top;\n            this._prevTop = top;\n            changed = true;\n        }\n\n        if (height !== this._prevHeight) {\n            css.height = height;\n            this._prevHeight = height;\n            changed = true;\n        }\n\n        if (changed) {\n            /*\n             * If the positions of the chunk changed, then it's possible the\n             * page container's padding has also changed (zooming in/out), so\n             * be safe and recompute.\n             *\n             * Technically we should compute separately for the left and right\n             * sides, but in practice we apply even spacing. Save a\n             * calculation, since this happens in resize events.\n             */\n            const padding = this._$pageContainer.getExtents('p', 'l');\n            css.left = -padding;\n            css.right = -padding;\n\n            this.$el.css(css);\n        }\n    },\n});\n"],"mappings":"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"}