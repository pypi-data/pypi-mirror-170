{"version":3,"file":"uploadAttachmentViewTests.js","names":["suite","reviewRequest","beforeEach","RB","ReviewRequest","summary","reviewURL","describe","dialog","afterEach","hide","UploadAttachmentView","$button","show","$buttonsMap","cancel","expect","length","toBe","it","is","spyOn","$","fn","and","callThrough","delegateEvents","click","modalBox","toHaveBeenCalledWith","$path","upload","_$path","attr","val","trigger","updateUploadButtonEnabledState","toHaveBeenCalledTimes","toHaveBeenCalled","send","attachmentHistoryID","presetCaption","$caption","$attachmentHistory"],"sources":["../../../../../../static/rb/js/views/tests/uploadAttachmentViewTests.es6.js"],"sourcesContent":["suite('rb/views/UploadAttachmentView', function() {\n    let reviewRequest;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest({\n            summary: 'My Review Request',\n            reviewURL: '/r/1/',\n        });\n    });\n\n    describe('Instances', function() {\n        let dialog;\n\n        afterEach(function() {\n            if (dialog) {\n                dialog.hide();\n                dialog = null;\n            }\n        });\n\n        describe('Buttons', function() {\n            beforeEach(function() {\n                dialog = new RB.UploadAttachmentView({\n                    reviewRequest: reviewRequest,\n                });\n            });\n\n            describe('Cancel', function() {\n                let $button;\n\n                beforeEach(function() {\n                    dialog.show();\n                    $button = dialog.$buttonsMap.cancel;\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Enabled by default', function() {\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Closes dialog when clicked', function() {\n                    spyOn($.fn, 'modalBox').and.callThrough();\n                    dialog.delegateEvents();\n\n                    $button.click();\n                    expect($.fn.modalBox).toHaveBeenCalledWith('destroy');\n                });\n            });\n\n            describe('Upload', function() {\n                let $button;\n                let $path;\n\n                beforeEach(function() {\n                    spyOn(dialog, 'send');\n\n                    dialog.show();\n                    $button = dialog.$buttonsMap.upload;\n                    $path = dialog._$path;\n\n                    /*\n                     * Allows the value of the input to be changed\n                     * programmatically without security issues.\n                     */\n                    $path.attr('type', 'text');\n\n                    spyOn(dialog, 'updateUploadButtonEnabledState')\n                        .and.callThrough();\n                    dialog.delegateEvents();\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Disabled by default until a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Enabled when a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(1);\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Disabled when an uploaded file is removed', function() {\n                    $path\n                        .val('fakefile')\n                        .trigger('change')\n                        .val('')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(2);\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Uploads the file attachment', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState).toHaveBeenCalled();\n                    expect($button.is(':disabled')).toBe(false);\n\n                    $button.click();\n                    expect(dialog.send).toHaveBeenCalled();\n                });\n            });\n        });\n\n        it('Dialog for updating an existing file attachment', function() {\n            dialog = new RB.UploadAttachmentView({\n                attachmentHistoryID: 14,\n                presetCaption: 'fakecaption',\n                reviewRequest: reviewRequest,\n            });\n\n            dialog.show();\n            const $caption = dialog.$('[name=\"caption\"]');\n            const $attachmentHistory = dialog.$('[name=\"attachment_history\"]');\n\n            expect($caption.length).toBe(1);\n            expect($caption.val()).toBe('fakecaption');\n\n            expect($attachmentHistory.length).toBe(1);\n            expect($attachmentHistory.val()).toBe('14');\n        });\n    });\n});\n"],"mappings":"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"}