{"version":3,"file":"newsWidgetView.js","names":["RB","Admin","NewsWidgetView","WidgetView","extend","canReload","reloadTitle","itemsTemplate","_","template","renderWidget","model","addFooterAction","id","el","$","text","attr","get","subscribeURL","cssClasses","listenTo","setReloading","_onNewsItemsChanged","loadNews","reloadContent","items","length","$content","html","$error","interpolate","empty","append","trigger"],"sources":["../../../../../../static/rb/js/admin/views/newsWidgetView.es6.js"],"sourcesContent":["/**\n * A widget for displaying news items from an RSS feed.\n */\nRB.Admin.NewsWidgetView = RB.Admin.WidgetView.extend({\n    canReload: true,\n    reloadTitle: gettext('Reload news posts'),\n\n    itemsTemplate: _.template(dedent`\n        <% _.each(items, function(item) { %>\n         <a href=\"<%- item.url %>\" class=\"rb-c-admin-news-widget__item\"\n            target=\"_blank\">\n          <span class=\"rb-c-admin-news-widget__item-date\">\n           <%- item.date.format('MMM DD') %>\n          </span>\n          <span class=\"rb-c-admin-news-widget__item-title\">\n           <%- item.title %>\n          </span>\n         </a>\n        <% }) %>\n    `),\n\n    /**\n     * Render the widget.\n     *\n     * This will set up the actions and begin loading the news.\n     */\n    renderWidget() {\n        const model = this.model;\n\n        this.addFooterAction({\n            id: 'more-news',\n            el: $('<a href=\"#\" target=\"_blank\">')\n                .text(gettext('More News'))\n                .attr('href', model.get('newsURL')),\n        });\n\n        const subscribeURL = this.model.get('subscribeURL');\n\n        if (subscribeURL) {\n            this.addFooterAction({\n                id: 'subscribe',\n                cssClasses: '-is-right',\n                el: $('<a href=\"#\" target=\"_blank\">')\n                    .text(gettext('Subscribe'))\n                    .attr('href', subscribeURL),\n            });\n        }\n\n        this.listenTo(model, 'loadingNews',\n                      () => this.setReloading(true));\n        this.listenTo(model, 'change:newsItems', this._onNewsItemsChanged);\n\n        model.loadNews();\n    },\n\n    /**\n     * Reload the news posts.\n     *\n     * This is called in response to a user clicking the Reload action.\n     */\n    reloadContent() {\n        this.model.loadNews();\n    },\n\n    /**\n     * Handle changes to the list of loaded news items.\n     *\n     * If the list is empty, this will present an error pointing to the news\n     * feed. Otherwise, it will render each of the news items.\n     */\n    _onNewsItemsChanged() {\n        const items = this.model.get('newsItems');\n\n        this.setReloading(false);\n\n        if (items.length > 0) {\n            this.$content.html(this.itemsTemplate({\n                items: items,\n            }));\n        } else {\n            const $error = $('<p class=\"rb-c-admin-news-widget__error\">')\n                .html(interpolate(\n                    gettext('There was an error loading the news. Please <a href=\"%s\">visit the news page</a> directly, or try again later.'),\n                    [this.model.get('newsURL')]));\n\n            this.$content\n                .empty()\n                .append($error);\n        }\n\n        this.trigger('sizeChanged');\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACAA,EAAE,CAACC,KAAH,CAASC,cAAT,GAA0BF,EAAE,CAACC,KAAH,CAASE,UAAT,CAAoBC,MAApB,CAA2B;EACjDC,SAAS,EAAE,IADsC;EAEjDC,WAAW,8BAFsC;EAIjDC,aAAa,EAAEC,CAAC,CAACC,QAAF,CAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAVmB,CAJkC;;EAkBjD;AACJ;AACA;AACA;AACA;EACIC,YAAY,GAAG;IACX,MAAMC,KAAK,GAAG,KAAKA,KAAnB;IAEA,KAAKC,eAAL,CAAqB;MACjBC,EAAE,EAAE,WADa;MAEjBC,EAAE,EAAEC,CAAC,CAAC,8BAAD,CAAD,CACCC,IADD,uBAECC,IAFD,CAEM,MAFN,EAEcN,KAAK,CAACO,GAAN,CAAU,SAAV,CAFd;IAFa,CAArB;IAOA,MAAMC,YAAY,GAAG,KAAKR,KAAL,CAAWO,GAAX,CAAe,cAAf,CAArB;;IAEA,IAAIC,YAAJ,EAAkB;MACd,KAAKP,eAAL,CAAqB;QACjBC,EAAE,EAAE,WADa;QAEjBO,UAAU,EAAE,WAFK;QAGjBN,EAAE,EAAEC,CAAC,CAAC,8BAAD,CAAD,CACCC,IADD,uBAECC,IAFD,CAEM,MAFN,EAEcE,YAFd;MAHa,CAArB;IAOH;;IAED,KAAKE,QAAL,CAAcV,KAAd,EAAqB,aAArB,EACc,MAAM,KAAKW,YAAL,CAAkB,IAAlB,CADpB;IAEA,KAAKD,QAAL,CAAcV,KAAd,EAAqB,kBAArB,EAAyC,KAAKY,mBAA9C;IAEAZ,KAAK,CAACa,QAAN;EACH,CAlDgD;;EAoDjD;AACJ;AACA;AACA;AACA;EACIC,aAAa,GAAG;IACZ,KAAKd,KAAL,CAAWa,QAAX;EACH,CA3DgD;;EA6DjD;AACJ;AACA;AACA;AACA;AACA;EACID,mBAAmB,GAAG;IAClB,MAAMG,KAAK,GAAG,KAAKf,KAAL,CAAWO,GAAX,CAAe,WAAf,CAAd;IAEA,KAAKI,YAAL,CAAkB,KAAlB;;IAEA,IAAII,KAAK,CAACC,MAAN,GAAe,CAAnB,EAAsB;MAClB,KAAKC,QAAL,CAAcC,IAAd,CAAmB,KAAKtB,aAAL,CAAmB;QAClCmB,KAAK,EAAEA;MAD2B,CAAnB,CAAnB;IAGH,CAJD,MAIO;MACH,MAAMI,MAAM,GAAGf,CAAC,CAAC,2CAAD,CAAD,CACVc,IADU,CACLE,WAAW,8HAEb,CAAC,KAAKpB,KAAL,CAAWO,GAAX,CAAe,SAAf,CAAD,CAFa,CADN,CAAf;MAKA,KAAKU,QAAL,CACKI,KADL,GAEKC,MAFL,CAEYH,MAFZ;IAGH;;IAED,KAAKI,OAAL,CAAa,aAAb;EACH;;AAxFgD,CAA3B,CAA1B"}