{"version":3,"file":"formViewTests.js","names":["suite","template","view","$subforms","beforeEach","RB","FormView","el","$","render","$el","appendTo","$testsScratch","_$subforms","checkSubformVisibility","index","visible","$subform","eq","expect","prop","toBe","describe","it","$fieldset","hasClass","find","click","text","length","_","keys","_subformsByGroup","toEqual","group1","group2","subform1","subform2","subform3","subform4","children","val","triggerHandler","setSubformVisibility","group","subformID","hideOthers"],"sources":["../../../../../../../static/rb/js/ui/views/tests/formViewTests.es6.js"],"sourcesContent":["suite('rb/ui/views/FormView', function() {\n    const template = dedent`\n        <form class=\"rb-c-form\">\n         <select id=\"subform1-selector\"\n                 data-subform-group=\"group1\">\n          <option value=\"subform1\">subform1</option>\n          <option value=\"subform2\">subform2</option>\n         </select>\n\n         <fieldset class=\"rb-c-form-fieldset\">\n          <legend class=\"rb-c-form-fieldset__name\">\n           Title\n           <a href=\"#\" class=\"rb-c-form-fieldset__toggle\">(Hide)</a>\n          </legend>\n          <div class=\"rb-c-form-fieldset__content\"></div>\n         </fieldset>\n         <fieldset class=\"rb-c-form-fieldset -is-collapsed\">\n          <legend class=\"rb-c-form-fieldset__name\">\n           Title\n           <a href=\"#\" class=\"rb-c-form-fieldset__toggle\">(Show)</a>\n          </legend>\n          <div class=\"rb-c-form-fieldset__content\"></div>\n         </fieldset>\n\n         <fieldset class=\"rb-c-form-fieldset -is-subform\"\n                   data-subform-controller=\"subform1-selector\"\n                   data-subform-id=\"subform1\">\n         </fieldset>\n         <fieldset class=\"rb-c-form-fieldset -is-subform\"\n                   data-subform-controller=\"subform1-selector\"\n                   data-subform-id=\"subform2\">\n         </fieldset>\n\n         <fieldset class=\"rb-c-form-fieldset -is-subform\"\n                   data-subform-group=\"group2\"\n                   data-subform-id=\"subform3\">\n         </fieldset>\n         <fieldset class=\"rb-c-form-fieldset -is-subform\"\n                   data-subform-group=\"group2\"\n                   data-subform-id=\"subform4\"\n                   disabled hidden>\n         </fieldset>\n        </form>\n    `;\n\n    let view;\n    let $subforms;\n\n    beforeEach(function() {\n        view = new RB.FormView({\n            el: $(template),\n        });\n        view.render().$el.appendTo($testsScratch);\n\n        $subforms = view._$subforms;\n    });\n\n    function checkSubformVisibility(index, visible) {\n        const $subform = $subforms.eq(index);\n\n        expect($subform.prop('disabled')).toBe(!visible);\n        expect($subform.prop('hidden')).toBe(!visible);\n    }\n\n    describe('Fieldsets', function() {\n        it('Collapsing', function() {\n            const $fieldset = view.$('.rb-c-form-fieldset').eq(0);\n\n            expect($fieldset.hasClass('-is-collapsed')).toBe(false);\n\n            $fieldset.find('.rb-c-form-fieldset__toggle').click();\n\n            expect($fieldset.hasClass('-is-collapsed')).toBe(true);\n            expect($fieldset.find('.rb-c-form-fieldset__toggle').text())\n                .toBe('(Show)');\n        });\n\n        it('Expanding', function() {\n            const $fieldset = view.$('.rb-c-form-fieldset').eq(1);\n\n            expect($fieldset.hasClass('-is-collapsed')).toBe(true);\n\n            $fieldset.find('.rb-c-form-fieldset__toggle').click();\n\n            expect($fieldset.hasClass('-is-collapsed')).toBe(false);\n            expect($fieldset.find('.rb-c-form-fieldset__toggle').text())\n                .toBe('(Hide)');\n        });\n    });\n\n    describe('Subforms', function() {\n        it('Loaded state', function() {\n            expect($subforms.length).toBe(4);\n            expect(_.keys(view._subformsByGroup))\n                .toEqual(['group1', 'group2']);\n            expect(_.keys(view._subformsByGroup.group1))\n                .toEqual(['subform1', 'subform2']);\n            expect(_.keys(view._subformsByGroup.group2))\n                .toEqual(['subform3', 'subform4']);\n            expect(view._subformsByGroup.group1.subform1[0])\n                .toBe($subforms[0]);\n            expect(view._subformsByGroup.group1.subform2[0])\n                .toBe($subforms[1]);\n            expect(view._subformsByGroup.group2.subform3[0])\n                .toBe($subforms[2]);\n            expect(view._subformsByGroup.group2.subform4[0])\n                .toBe($subforms[3]);\n\n            checkSubformVisibility(0, true);\n            checkSubformVisibility(1, false);\n            checkSubformVisibility(2, true);\n            checkSubformVisibility(3, false);\n        });\n\n        it('Controller value changed', function() {\n            view.$el.children('select')\n                .val('subform2')\n                .triggerHandler('change');\n\n            checkSubformVisibility(0, false);\n            checkSubformVisibility(1, true);\n            checkSubformVisibility(2, true);\n            checkSubformVisibility(3, false);\n        });\n    });\n\n    describe('Methods', function() {\n        describe('setSubformVisibility', function() {\n            it('With group', function() {\n                view.setSubformVisibility({\n                    group: 'group2',\n                });\n\n                checkSubformVisibility(2, false);\n                checkSubformVisibility(3, false);\n            });\n\n            it('With group, visible', function() {\n                view.setSubformVisibility({\n                    group: 'group2',\n                    visible: true,\n                });\n\n                checkSubformVisibility(2, true);\n                checkSubformVisibility(3, true);\n\n                view.setSubformVisibility({\n                    group: 'group2',\n                    visible: false,\n                });\n\n                checkSubformVisibility(2, false);\n                checkSubformVisibility(3, false);\n            });\n\n            it('With group, subformID, visible', function() {\n                checkSubformVisibility(2, true);\n\n                view.setSubformVisibility({\n                    group: 'group2',\n                    subformID: 'subform3',\n                    visible: false,\n                });\n\n                checkSubformVisibility(2, false);\n                checkSubformVisibility(3, false);\n\n                view.setSubformVisibility({\n                    group: 'group2',\n                    subformID: 'subform4',\n                    visible: true,\n                });\n\n                checkSubformVisibility(3, true);\n            });\n\n            it('With group, subformID, visible, hideOthers', function() {\n                view.setSubformVisibility({\n                    group: 'group1',\n                    subformID: 'subform2',\n                    visible: true,\n                    hideOthers: true,\n                });\n\n                checkSubformVisibility(0, false);\n                checkSubformVisibility(1, true);\n\n                view.setSubformVisibility({\n                    group: 'group1',\n                    subformID: 'subform1',\n                    visible: true,\n                    hideOthers: true,\n                });\n\n                checkSubformVisibility(0, true);\n                checkSubformVisibility(1, false);\n            });\n        });\n    });\n});\n"],"mappings":"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"}