{"version":3,"file":"scrollManagerViewTests.js","names":["suite","makeElement","dimensions","scratchOffset","$testsScratch","offset","$","css","position","left","top","width","height","appendTo","scrollManager","beforeEach","RB","ScrollManagerView","window","pageXOffset","pageYOffset","scrollTo","x","y","requestAnimationFrame","cb","describe","it","scrollToPosition","expect","Math","round","toBe","scrollYOffset","$el","scrollToElement","_oldScrollY","markForUpdate","pendingElement","_pendingElements","get","oldHeight","toEqual","oldOffset","spyOn","parseInt","markUpdated","el","undefined","element","_elements","newHeight","newOffset","toHaveBeenCalled","$el1","$el2","$el3","_updateScrollPos"],"sources":["../../../../../../../static/rb/js/ui/views/tests/scrollManagerViewTests.es6.js"],"sourcesContent":["suite('rb/ui/views/ScrollManagerView', function() {\n    function makeElement(dimensions={}) {\n        const scratchOffset = $testsScratch.offset();\n\n        return $('<div/>')\n            .css({\n                position: 'absolute',\n                left: -scratchOffset.left + (dimensions.left || 0),\n                top: -scratchOffset.top + (dimensions.top || 0),\n                width: dimensions.width || 20,\n                height: dimensions.height || 20,\n            })\n            .appendTo($testsScratch);\n    }\n\n    let scrollManager;\n\n    beforeEach(function() {\n        scrollManager = new RB.ScrollManagerView();\n        scrollManager.window = {\n            pageXOffset: 0,\n            pageYOffset: 0,\n\n            scrollTo(x, y) {\n                this.pageXOffset = x;\n                this.pageYOffset = y;\n            },\n\n            requestAnimationFrame(cb) {\n                cb();\n            },\n        };\n    });\n\n    describe('scrollToPosition', function() {\n        it('Without scroll offset', function() {\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(100);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(60);\n        });\n    });\n\n    describe('scrollToElement', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Without scroll offset', function() {\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(50);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(10);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('First in a batch', function() {\n            scrollManager.window.pageYOffset = 100;\n\n            expect(scrollManager._oldScrollY).toBe(null);\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n\n        it('Subsequent entries', function() {\n            scrollManager._oldScrollY = 100;\n            scrollManager.window.pageYOffset = 200;\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Stores correct state', function() {\n            /* Disable the actual updates for this test. */\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.markForUpdate($el);\n            $el.height(40);\n            $el.css('top', parseInt($el.css('top'), 10) - 10);\n            scrollManager.markUpdated($el);\n\n            const el = $el[0];\n\n            expect(scrollManager._pendingElements.get(el)).toBe(undefined);\n\n            const element = scrollManager._elements.get(el);\n            expect(Math.round(element.oldHeight)).toEqual(20);\n            expect(Math.round(element.oldOffset.top)).toEqual(50);\n            expect(Math.round(element.oldOffset.left)).toEqual(0);\n            expect(Math.round(element.newHeight)).toEqual(40);\n            expect(Math.round(element.newOffset.top)).toEqual(40);\n            expect(Math.round(element.newOffset.left)).toEqual(0);\n\n            expect(scrollManager.window.requestAnimationFrame)\n                .toHaveBeenCalled();\n        });\n    });\n\n    describe('Scroll updates', function() {\n        beforeEach(function() {\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.window.pageYOffset = 200;\n        });\n\n        it('Includes updates before scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: 60});\n            const $el3 = makeElement({top: 70});\n\n            /* Grow by 50px. */\n            scrollManager.markForUpdate($el1);\n            $el1.height(70);\n            scrollManager.markUpdated($el1);\n\n            /* Shrink by 10px. */\n            scrollManager.markForUpdate($el2);\n            $el2.height(10);\n            scrollManager.markUpdated($el2);\n\n            /* Move up 5px. */\n            scrollManager.markForUpdate($el3);\n            $el3.css('top', parseInt($el3.css('top'), 10) - 5);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(235);\n        });\n\n        it('Ignores updates after scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: scrollManager.window.pageYOffset});\n            const $el3 = makeElement({top: 500});\n\n            scrollManager.markForUpdate($el1);\n            $el1.height(30);\n            scrollManager.markUpdated($el1);\n\n            scrollManager.markForUpdate($el2);\n            $el2.height(90);\n            scrollManager.markUpdated($el2);\n\n            scrollManager.markForUpdate($el3);\n            $el3.height(1000);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(scrollManager.window.pageYOffset).toBe(210);\n        });\n    });\n});\n"],"mappings":"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"}