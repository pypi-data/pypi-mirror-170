{"version":3,"file":"newsWidgetModel.js","names":["RB","Admin","NewsWidget","Widget","extend","defaults","_","maxItems","newsItems","newsURL","rssURL","subscribeURL","prototype","loadNews","trigger","$","ajax","get","accepts","xml","dataType","success","data","$items","find","set","map","item","$item","date","moment","text","title","url","error"],"sources":["../../../../../../static/rb/js/admin/models/newsWidgetModel.es6.js"],"sourcesContent":["/**\n * State and operations for the administration UI's news widget.\n *\n * Model Attributes:\n *     maxItems (number):\n *         The maximum number of items to parse from the feed.\n *\n *     newsItems (Array of object):\n *         The list of news items to render. Each entry represents a news item,\n *         and is an object with the following keys:\n *\n *         ``date`` (:js:class:`Moment`):\n *             The parsed date.\n *\n *          ``title`` (string):\n *              The title of the news entry.\n *\n *          ``url`` (string):\n *              The URL to the news page for the item.\n *\n *     newsURL (string):\n *         The URL to the news page, for linking in the browser.\n *\n *     rssURL (string):\n *         The URL to the news RSS feed.\n *\n *     subscribeURL (string):\n *         The URL to a subscription page for the news feed or newsletter.\n */\nRB.Admin.NewsWidget = RB.Admin.Widget.extend({\n    defaults: _.defaults({\n        maxItems: 5,\n        newsItems: null,\n        newsURL: null,\n        rssURL: null,\n        subscribeURL: null,\n    }, RB.Admin.Widget.prototype.defaults),\n\n    /**\n     * Load the latest news from the server.\n     *\n     * This will attempt to load the news feed and populate the ``newsItems``\n     * attribute with the results. If there's an error when loading,\n     * ``newsItems`` will be set to an empty array.\n     *\n     * Before attempting to load the news, this will trigger the\n     * ``loadingNews`` event.\n     */\n    loadNews() {\n        this.trigger('loadingNews');\n\n        $.ajax(this.get('rssURL'), {\n            accepts: {\n                xml: 'application/rss+xml',\n            },\n            dataType: 'xml',\n            success: data => {\n                const maxItems = this.get('maxItems');\n                const $items = $(data).find(`item:lt(${maxItems})`);\n\n                this.set('newsItems', _.map($items, item => {\n                    const $item = $(item);\n\n                    return {\n                        date: moment($item.find('pubDate').text(),\n                                     'ddd, DD MMM YYYY HH:mm:ss ZZ'),\n                        title: $item.find('title').text(),\n                        url: $item.find('link').text(),\n                    };\n                }));\n            },\n            error: () => {\n                this.set('newsItems', []);\n            },\n        });\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,KAAH,CAASC,UAAT,GAAsBF,EAAE,CAACC,KAAH,CAASE,MAAT,CAAgBC,MAAhB,CAAuB;EACzCC,QAAQ,EAAEC,CAAC,CAACD,QAAF,CAAW;IACjBE,QAAQ,EAAE,CADO;IAEjBC,SAAS,EAAE,IAFM;IAGjBC,OAAO,EAAE,IAHQ;IAIjBC,MAAM,EAAE,IAJS;IAKjBC,YAAY,EAAE;EALG,CAAX,EAMPX,EAAE,CAACC,KAAH,CAASE,MAAT,CAAgBS,SAAhB,CAA0BP,QANnB,CAD+B;;EASzC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIQ,QAAQ,GAAG;IACP,KAAKC,OAAL,CAAa,aAAb;IAEAC,CAAC,CAACC,IAAF,CAAO,KAAKC,GAAL,CAAS,QAAT,CAAP,EAA2B;MACvBC,OAAO,EAAE;QACLC,GAAG,EAAE;MADA,CADc;MAIvBC,QAAQ,EAAE,KAJa;MAKvBC,OAAO,EAAEC,IAAI,IAAI;QACb,MAAMf,QAAQ,GAAG,KAAKU,GAAL,CAAS,UAAT,CAAjB;QACA,MAAMM,MAAM,GAAGR,CAAC,CAACO,IAAD,CAAD,CAAQE,IAAR,CAAc,WAAUjB,QAAS,GAAjC,CAAf;QAEA,KAAKkB,GAAL,CAAS,WAAT,EAAsBnB,CAAC,CAACoB,GAAF,CAAMH,MAAN,EAAcI,IAAI,IAAI;UACxC,MAAMC,KAAK,GAAGb,CAAC,CAACY,IAAD,CAAf;UAEA,OAAO;YACHE,IAAI,EAAEC,MAAM,CAACF,KAAK,CAACJ,IAAN,CAAW,SAAX,EAAsBO,IAAtB,EAAD,EACC,8BADD,CADT;YAGHC,KAAK,EAAEJ,KAAK,CAACJ,IAAN,CAAW,OAAX,EAAoBO,IAApB,EAHJ;YAIHE,GAAG,EAAEL,KAAK,CAACJ,IAAN,CAAW,MAAX,EAAmBO,IAAnB;UAJF,CAAP;QAMH,CATqB,CAAtB;MAUH,CAnBsB;MAoBvBG,KAAK,EAAE,MAAM;QACT,KAAKT,GAAL,CAAS,WAAT,EAAsB,EAAtB;MACH;IAtBsB,CAA3B;EAwBH;;AA9CwC,CAAvB,CAAtB"}