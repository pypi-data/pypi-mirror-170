{"version":3,"file":"basePageView.js","names":["RB","PageView","Backbone","View","extend","windowResizeThrottleMS","initialize","options","$window","$","window","$pageContainer","$pageContent","$mainSidebar","_$pageSidebar","_$mainSidebarPane","hasSidebar","isFullPage","inMobileMode","isPageRendered","drawer","headerView","remove","off","prototype","call","render","$body","document","body","$pageSidebar","_$pageSidebarPanes","children","HeaderView","el","$headerBar","hasClass","renderPage","show","on","_","throttle","_updateSize","listenTo","_onMobileModeChanged","setDrawer","console","assert","_reparentDrawer","resizeElementForFullHeight","$el","$parent","undefined","outerHeight","height","position","top","onResize","onMobileModeChanged","windowHeight","pageContainerHeight","sidebarHeight","offset","isVisible","css","detach","insertBefore","appendTo","trigger"],"sources":["../../../../../../static/rb/js/pages/views/basePageView.es6.js"],"sourcesContent":["/**\n * Base class for the views for pages.\n *\n * This is responsible for setting up and handling the page's UI, including\n * the page header, mobile mode handling, and sidebars. It also provides some\n * utilities for setting up common UI elements.\n *\n * The page will respect the ``-has-sidebar`` and ``-is-content-full-page``\n * CSS classes on the document ``<body>``. These will control the behavior\n * and layout of the page.\n *\n * This is intended for use by page views that are set by\n * :js:class:`RB.PageManager`.\n */\nRB.PageView = Backbone.View.extend({\n    /**\n     * The maximum frequency at which resize events should be handled.\n     *\n     * Subclasses can override this if they need to respond to window\n     * resizes at a faster or slower rate.\n     */\n    windowResizeThrottleMS: 100,\n\n    /**\n     * Initialize the page.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the page.\n     *\n     * Option Args:\n     *     $body (jQuery, optional):\n     *         The body element. This is useful for unit tests.\n     *\n     *     $headerBar (jQuery, optional):\n     *         The header bar element. This is useful for unit tests.\n     *\n     *     $pageContainer (jQuery, optional):\n     *         The page container element. This is useful for unit tests.\n     *\n     *     $pageContent (jQuery, optional):\n     *         The page content element. This is useful for unit tests.\n     *\n     *     $pageSidebar (jQuery, optional):\n     *         The page sidebar element. This is useful for unit tests.\n     */\n    initialize(options={}) {\n        this.options = options;\n\n        this.$window = $(window);\n        this.$pageContainer = null;\n        this.$pageContent = null;\n        this.$mainSidebar = null;\n        this._$pageSidebar = null;\n        this._$mainSidebarPane = null;\n\n        this.hasSidebar = null;\n        this.isFullPage = null;\n        this.inMobileMode = null;\n        this.isPageRendered = false;\n\n        this.drawer = null;\n        this.headerView = null;\n    },\n\n    /**\n     * Remove the page from the DOM and disable event handling.\n     */\n    remove() {\n        if (this.$window) {\n            this.$window.off('resize.rbPageView');\n        }\n\n        if (this.headerView) {\n            this.headerView.remove();\n        }\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Render the page.\n     *\n     * Subclasses should not override this. Instead, they should override\n     * :js:func:`RB.PageView.renderPage``.\n     *\n     * Returns:\n     *     RB.PageView:\n     *     This object, for chaining.\n     */\n    render() {\n        const options = this.options;\n        const $body = options.$body || $(document.body);\n\n        this.$pageContainer = options.$pageContainer || $('#page-container');\n        this.$pageContent = options.$pageContent || $('#content');\n        this._$pageSidebar = options.$pageSidebar || $('#page-sidebar');\n        this._$pageSidebarPanes = this._$pageSidebar.children(\n            '.rb-c-page-sidebar__panes');\n        this._$mainSidebarPane = this._$pageSidebarPanes.children(\n            '.rb-c-page-sidebar__pane.-is-shown');\n        this.$mainSidebar = this._$mainSidebarPane.children(\n            '.rb-c-page-sidebar__pane-content');\n\n        this.headerView = new RB.HeaderView({\n            el: options.$headerBar || $('#headerbar'),\n            $body: $body,\n            $pageSidebar: this._$pageSidebar,\n        });\n        this.headerView.render();\n\n        this.hasSidebar = $body.hasClass('-has-sidebar') ||\n                          $body.hasClass('has-sidebar');\n        this.isFullPage = $body.hasClass('-is-content-full-page') ||\n                          $body.hasClass('full-page-content');\n        this.inMobileMode = this.headerView.inMobileMode;\n\n        this.renderPage();\n\n        if (this.isFullPage) {\n            /*\n             * On full-size pages, we hide the content and sidebar initially\n             * (via CSS), so that we can properly position them before they're\n             * first shown. Now that we've done that, make them visible.\n             */\n            this._$mainSidebarPane.show();\n            this.$pageContainer.show();\n        }\n\n        this.$window.on('resize.rbPageView',\n                        _.throttle(() => this._updateSize(),\n                                   this.windowResizeThrottleMS));\n        this.listenTo(this.headerView, 'mobileModeChanged',\n                      this._onMobileModeChanged);\n        this._onMobileModeChanged(this.inMobileMode);\n\n        this.isPageRendered = true;\n\n        return this;\n    },\n\n    /**\n     * Set a drawer that can be shown over the sidebar.\n     *\n     * This is used by a page to set a drawer that should be displayed.\n     * Drawers are shown over the sidebar area in desktop mode, or docked to\n     * the bottom of the screen in mobile mode.\n     *\n     * Only one drawer can be set per page. Drawers also require a page with\n     * sidebars enabled.\n     *\n     * Callers must instantiate the drawer but should not render it or\n     * add it to the DOM.\n     *\n     * Args:\n     *     drawer (RB.Drawer):\n     *         The drawer to set.\n     */\n    setDrawer(drawer) {\n        console.assert(\n            this.drawer === null,\n            'A drawer has already been set up for this page.');\n        console.assert(\n            this.hasSidebar,\n            'Drawers can only be set up on pages with a sidebar.');\n\n        this.drawer = drawer;\n        drawer.render();\n        this._reparentDrawer();\n\n        this.listenTo(drawer, 'visibilityChanged', this._updateSize);\n    },\n\n    /**\n     * Render the page contents.\n     *\n     * This should be implemented by subclasses that need to render any\n     * UI elements.\n     */\n    renderPage() {\n    },\n\n    /**\n     * Resize an element to take the full height of a parent container.\n     *\n     * By default, this will size the element to the height of the main\n     * page container. A specific parent can be specified for more specific\n     * use cases.\n     *\n     * Args:\n     *     $el (jQuery):\n     *         The jQuery-wrapped element to resize.\n     *\n     *     $parent (jQuery, optional):\n     *         The specific jQuery-wrapped parent element to base the size on.\n     */\n    resizeElementForFullHeight($el, $parent) {\n        if ($parent === undefined) {\n            $parent = this.$pageContainer;\n        }\n\n        $el.outerHeight($parent.height() - $el.position().top);\n    },\n\n    /**\n     * Handle page resizes.\n     *\n     * This will be called whenever the page's size (or the window size)\n     * has changed, allowing subclasses to adjust any UI elements as\n     * appropriate.\n     *\n     * In the case of window sizes, calls to this function will be throttled,\n     * called no more frequently than the configured\n     * :js:attr:`windowResizeThrottleMS`.\n     */\n    onResize() {\n    },\n\n    /**\n     * Handle mobile mode changes.\n     *\n     * This will be called whenever the page goes between mobile/desktop\n     * mode, allowing subclasses to adjust any UI elements as appropriate.\n     *\n     * Args:\n     *     inMobileMode (bool):\n     *         Whether the UI is now in mobile mode. This will be the same\n     *         value as :js:attr:`inMobileMode`, and is just provided for\n     *         convenience.\n     */\n    onMobileModeChanged(inMobileMode) {\n    },\n\n    /**\n     * Update the size of the page.\n     *\n     * This will be called in response to window resizes and certain other\n     * events. It will calculate the appropriate size for the sidebar (if\n     * on the page) and the page container (if in full-page content mode),\n     * update any elements as appropriate, and then call\n     * :js:func:`RB.PageView.onResize` so that subclasses can update their\n     * elements.\n     */\n    _updateSize() {\n        const windowHeight = this.$window.height();\n        let pageContainerHeight = null;\n        let sidebarHeight = null;\n\n        if (this.isFullPage) {\n            pageContainerHeight = windowHeight -\n                                  this.$pageContainer.offset().top;\n        }\n\n        if (this.inMobileMode) {\n            if (pageContainerHeight !== null &&\n                this.drawer !== null &&\n                this.drawer.isVisible) {\n                /*\n                 * If we're constraining the page container's height, and\n                 * there's a drawer present, reduce the page container's\n                 * height by the drawer size, so we don't make some content\n                 * inaccessible due to an overlap.\n                 */\n                pageContainerHeight -= this.drawer.$el.outerHeight();\n            }\n        } else {\n            if (pageContainerHeight !== null) {\n                /*\n                 * If we're constraining the page container's height,\n                 * constrain the sidebar's as well.\n                 */\n                sidebarHeight = windowHeight - this._$pageSidebar.offset().top;\n            }\n        }\n\n        if (pageContainerHeight === null) {\n            this.$pageContainer.css('height', '');\n        } else {\n            this.$pageContainer.outerHeight(pageContainerHeight);\n        }\n\n        if (sidebarHeight === null) {\n            this._$pageSidebar.css('height', '');\n        } else {\n            this._$pageSidebar.outerHeight(sidebarHeight);\n        }\n\n        this.onResize();\n    },\n\n    /**\n     * Set the new parent for the drawer.\n     *\n     * In mobile mode, this will place the drawer within the main\n     * ``#container``, right before the sidebar, allowing it to appear docked\n     * along the bottom of the page.\n     *\n     * In desktop mode, this will place the drawer within the sidebar area,\n     * ensuring that it overlaps it properly.\n     */\n    _reparentDrawer() {\n        const $el = this.drawer.$el\n            .detach();\n\n        if (this.inMobileMode) {\n            $el.insertBefore(this._$pageSidebar);\n        } else {\n            $el.appendTo(this._$pageSidebarPanes);\n        }\n    },\n\n    /**\n     * Handle a transition between mobile and desktop mode.\n     *\n     * This will set the :js:attr:`inMobileMode` flag and trigger the\n     * ``inMobileModeChanged`` event, so that pages can listen and update\n     * their layout as appropriate.\n     *\n     * It will also update the size and reparent the drawer.\n     *\n     * Args:\n     *     inMobileMode (boolean):\n     *         Whether the page shell is in mobile mode.\n     */\n    _onMobileModeChanged(inMobileMode) {\n        this.inMobileMode = inMobileMode;\n\n        this._updateSize();\n\n        if (this.drawer !== null) {\n            this._reparentDrawer();\n        }\n\n        this.onMobileModeChanged(this.inMobileMode);\n        this.trigger('inMobileModeChanged', this.inMobileMode);\n    },\n});\n"],"mappings":"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"}