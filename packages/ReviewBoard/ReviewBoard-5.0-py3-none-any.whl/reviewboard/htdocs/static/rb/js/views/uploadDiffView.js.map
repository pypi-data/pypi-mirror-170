{"version":3,"file":"uploadDiffView.js","names":["RB","UploadDiffView","Backbone","View","extend","events","initialize","listenTo","model","_onStateChanged","_onErrorChanged","render","selectDiffText","selectParentDiffText","_canDragDrop","$el","html","template","pendingChangeHeader","tipHeader","tip","selectDiff","selectParentDiff","baseDir","changeNum","startOver","ok","_$fileInput","$","hide","appendTo","change","handleFiles","get","files","_$diffRevisionError","_$error","_$errorContents","_$processingDiff","_$promptForBasedir","_$promptForChangeNumber","_$promptForDiff","_$promptForParentDiff","_$uploading","el","navigator","userAgent","match","error","errorHTML","innerHeight","height","outerHeight","css","top","Math","floor","state","setVisible","State","PROMPT_FOR_DIFF","PROMPT_FOR_PARENT_DIFF","PROMPT_FOR_BASEDIR","PROCESSING_DIFF","PROMPT_FOR_CHANGE_NUMBER","UPLOADING","ERROR","_onDragEnter","event","stopPropagation","preventDefault","addClass","_onDragOver","dt","originalEvent","dataTransfer","dropEffect","_onDragLeave","removeClass","_onDrop","_onBasedirSubmit","basedir","val","set","_onChangenumSubmit","changenum","_onStartOverClicked","$input","clone","replaceWith","_onSelectFileClicked","click"],"sources":["../../../../../static/rb/js/views/uploadDiffView.es6.js"],"sourcesContent":["/**\n * An abstract view for uploading diffs.\n *\n * This is extended by the PreCommitView (for creating new review requests)\n * and UpdateDiffView (for updating the diff on existing review requests).\n */\nRB.UploadDiffView = Backbone.View.extend({\n    events: {\n        'dragenter .dnd': '_onDragEnter',\n        'dragover .dnd': '_onDragOver',\n        'dragleave .dnd': '_onDragLeave',\n        'drop .dnd': '_onDrop',\n        'submit #basedir-form': '_onBasedirSubmit',\n        'submit #changenum-form': '_onChangenumSubmit',\n        'click .startover': '_onStartOverClicked',\n        'click #select-diff-file': '_onSelectFileClicked',\n        'click #select-parent-diff-file': '_onSelectFileClicked',\n    },\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this.listenTo(this.model, 'change:state', this._onStateChanged);\n        this.listenTo(this.model, 'change:error', this._onErrorChanged);\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.UploadDiffView:\n     *     This object, for chaining.\n     */\n    render() {\n        let selectDiffText;\n        let selectParentDiffText;\n\n        if (this._canDragDrop()) {\n            selectDiffText = gettext('<input type=\"button\" id=\"select-diff-file\" value=\"Select\"> or drag and drop a diff file to begin');\n            selectParentDiffText = gettext('<input type=\"button\" id=\"select-parent-diff-file\" value=\"Select\"> or drag and drop a parent diff file if you have one');\n        } else {\n            selectDiffText = gettext('<input type=\"button\" id=\"select-diff-file\" value=\"Select\"> a file to begin');\n            selectParentDiffText = gettext('<input type=\"button\" id=\"select-parent-diff-file\" value=\"Select\"> a parent diff file if you have one');\n        }\n\n        this.$el.html(this.template({\n            pendingChangeHeader: gettext('Create from a local change'),\n            tipHeader: gettext('Tip:'),\n            tip: gettext('Use <tt>rbt post</tt> from <a href=\"https://www.reviewboard.org/downloads/rbtools/\">RBTools</a> to more easily create and update review requests.'),\n            selectDiff: selectDiffText,\n            selectParentDiff: selectParentDiffText,\n            baseDir: gettext('What is the base directory for this diff?'),\n            changeNum: gettext('What is the change number for this diff?'),\n            startOver: gettext('Start Over'),\n            ok: gettext('OK'),\n        }));\n\n        this._$fileInput = $('<input type=\"file\">')\n            .hide()\n            .appendTo(this.$el)\n            .change(() => this.model.handleFiles(this._$fileInput.get(0).files));\n        this._$diffRevisionError = this.$('#parent-diff-error-contents');\n        this._$error = this.$('#error-indicator')\n            .hide();\n        this._$errorContents = this.$('#error-contents');\n        this._$processingDiff = this.$('#processing-diff')\n            .hide();\n        this._$promptForBasedir = this.$('#prompt-for-basedir')\n            .hide();\n        this._$promptForChangeNumber = this.$('#prompt-for-change-number')\n            .hide();\n        this._$promptForDiff = this.$('#prompt-for-diff')\n            .hide();\n        this._$promptForParentDiff = this.$('#prompt-for-parent-diff')\n            .hide();\n        this._$uploading = this.$('#uploading-diffs')\n            .hide();\n\n        this._onStateChanged(this.model, this.model.get('state'));\n\n        return this;\n    },\n\n    /**\n     * Return whether drag-and-drop is supported on this browser.\n     *\n     * We check if the DOM has the appropriate support for file drag-and-drop,\n     * which will give us the right answer on most browsers. We also need to\n     * check iOS specifically, as Safari lies about the support.\n     *\n     * Returns:\n     *     boolean:\n     *     Whether the user's browser supports drag-and-drop of files.\n     */\n    _canDragDrop() {\n        return ('draggable' in this.el ||\n                ('ondragstart' in this.el && 'ondrop' in this.el)) &&\n               !navigator.userAgent.match('iPhone OS') &&\n               !navigator.userAgent.match('iPad');\n    },\n\n    /**\n     * Callback for when the model's error attribute changes.\n     *\n     * Updates the text and position of error indicators in the various pages.\n     *\n     * Args:\n     *     model (RB.UploadDiffModel):\n     *         The model which handles uploading the diff.\n     *\n     *     error (string):\n     *         The text of the error.\n     */\n    _onErrorChanged(model, error) {\n        const errorHTML = `<div class=\"rb-icon rb-icon-warning\"></div> ${error}`;\n\n        this._$errorContents.html(errorHTML);\n        this._$diffRevisionError.html(errorHTML);\n\n        const innerHeight = this._$errorContents.height();\n        const outerHeight = this._$error.height();\n\n        this._$errorContents.css({\n            top: Math.floor((outerHeight - innerHeight) / 2) + 'px',\n        });\n    },\n\n    /**\n     * Callback for when the model's state attribute changes.\n     *\n     * Sets the corresponding element visible and all others invisible.\n     *\n     * Args:\n     *     model (RB.UploadDiffModel):\n     *         The model which handles uploading the diff.\n     *\n     *     state (number):\n     *         The current state of the upload process.\n     */\n    _onStateChanged(model, state) {\n        this._$promptForDiff.setVisible(\n            state === this.model.State.PROMPT_FOR_DIFF);\n        this._$promptForParentDiff.setVisible(\n            state === this.model.State.PROMPT_FOR_PARENT_DIFF);\n        this._$promptForBasedir.setVisible(\n            state === this.model.State.PROMPT_FOR_BASEDIR);\n        this._$processingDiff.setVisible(\n            state === this.model.State.PROCESSING_DIFF);\n        this._$promptForChangeNumber.setVisible(\n            state === this.model.State.PROMPT_FOR_CHANGE_NUMBER);\n        this._$uploading.setVisible(state === this.model.State.UPLOADING);\n        this._$error.setVisible(state === this.model.State.ERROR);\n    },\n\n    /**\n     * Event handler for a dragenter event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragenter event.\n     */\n    _onDragEnter(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        this.$('.dnd').addClass('drag-hover');\n    },\n\n    /**\n     * Event handler for a dragover event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragover event.\n     */\n    _onDragOver(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const dt = event.originalEvent.dataTransfer;\n\n        if (dt) {\n            dt.dropEffect = 'copy';\n        }\n    },\n\n    /**\n     * Event handler for a dragleave event.\n     *\n     * Args:\n     *     event (Event):\n     *         The dragleave event.\n     */\n    _onDragLeave(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        this.$('.dnd').removeClass('drag-hover');\n\n        const dt = event.originalEvent.dataTransfer;\n\n        if (dt) {\n            dt.dropEffect = \"none\";\n        }\n    },\n\n    /**\n     * Event handler for a drop event.\n     *\n     * Args:\n     *     event (Event):\n     *         The drop event.\n     */\n    _onDrop(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const  dt = event.originalEvent.dataTransfer;\n        const files = dt && dt.files;\n\n        if (files) {\n            this.model.handleFiles(files);\n        }\n    },\n\n    /**\n     * Handle when the user inputs a base directory.\n     *\n     * Args:\n     *     event (Event):\n     *         The form submit event.\n     */\n    _onBasedirSubmit(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        const basedir = this.$('#basedir-input').val();\n\n        if (basedir) {\n            this.model.set('basedir', basedir);\n        }\n    },\n\n    /**\n     * Handle when the user inputs a change number.\n     */\n    _onChangenumSubmit() {\n        const changenum = this.$('#changenum-input').val();\n\n        if (changenum) {\n            this.model.set('changeNumber', changenum);\n        }\n    },\n\n    /**\n     * Callback when \"start over\" is clicked.\n     */\n    _onStartOverClicked() {\n        const $input = this._$fileInput.clone(true);\n\n        this._$fileInput.replaceWith($input);\n        this._$fileInput = $input;\n\n        this.model.startOver();\n    },\n\n    /**\n     * Callback when \"Select [diff file]\" is clicked.\n     */\n    _onSelectFileClicked() {\n        this._$fileInput.click();\n    },\n});\n"],"mappings":"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"}