{"version":3,"file":"newsWidgetViewTests.js","names":["suite","template","model","view","beforeEach","RB","Admin","NewsWidget","newsURL","NewsWidgetView","el","$","spyOn","describe","it","render","$actions","$footerActions","children","expect","length","toBe","$action","eq","hasClass","toBeTrue","attr","set","$headerActions","toBeFalse","trigger","setReloading","date","moment","Date","UTC","title","url","$items","$content","$item","find","text","strip","$els","$error","html"],"sources":["../../../../../../../static/rb/js/admin/views/tests/newsWidgetViewTests.es6.js"],"sourcesContent":["suite('rb/admin/views/NewsWidgetView', function() {\n    const template = dedent`\n        <div class=\"rb-c-admin-widget rb-c-news-admin-widget\">\n         <header class=\"rb-c-admin-widget__header\">\n          <ul class=\"rb-c-admin-widget__actions\"></ul>\n         </header>\n         <div class=\"rb-c-admin-widget__content\"></div>\n         <footer class=\"rb-c-admin-widget__footer\">\n          <ul class=\"rb-c-admin-widget__actions\"></ul>\n         </footer>\n        </div>\n    `;\n\n    let model;\n    let view;\n\n    beforeEach(function() {\n        model = new RB.Admin.NewsWidget({\n            newsURL: 'http://example.com/news/',\n        });\n\n        view = new RB.Admin.NewsWidgetView({\n            el: $(template),\n            model: model,\n        });\n\n        spyOn(model, 'loadNews');\n    });\n\n    describe('Rendering', function() {\n        describe('Actions', function() {\n            it('More News', function() {\n                view.render();\n\n                const $actions = view.$footerActions.children();\n                expect($actions.length).toBe(1);\n\n                const $action = $actions.eq(0);\n                expect($action.hasClass('js-action-more-news')).toBeTrue();\n                expect($action.children('a').attr('href'))\n                    .toBe('http://example.com/news/');\n            });\n\n            it('Subscribe', function() {\n                model.set('subscribeURL', 'http://example.com/news/subscribe/');\n                view.render();\n\n                const $actions = view.$footerActions.children();\n                expect($actions.length).toBe(2);\n\n                const $action = $actions.eq(1);\n                expect($action.hasClass('js-action-subscribe')).toBeTrue();\n                expect($action.children('a').attr('href'))\n                    .toBe('http://example.com/news/subscribe/');\n            });\n\n            describe('Reload', function() {\n                it('On loadingNews event', function() {\n                    view.render();\n\n                    const $action = view.$headerActions.children(\n                        '.js-action-reload');\n                    expect($action.hasClass('fa-spin')).toBeFalse();\n\n                    model.trigger('loadingNews');\n                    expect($action.hasClass('fa-spin')).toBeTrue();\n                });\n\n                it('On change:newsItems event', function() {\n                    view.render();\n\n                    const $action = view.$headerActions.children(\n                        '.js-action-reload');\n\n                    view.setReloading(true);\n                    expect($action.hasClass('fa-spin')).toBeTrue();\n\n                    model.set('newsItems', []);\n                    expect($action.hasClass('fa-spin')).toBeFalse();\n                });\n            });\n        });\n\n        it('News items', function() {\n            view.render();\n\n            model.set('newsItems', [\n                {\n                    date: moment(Date.UTC(2019, 9, 21, 0, 26, 32)),\n                    title: 'Headline 6',\n                    url: 'http://example.com/news/post6',\n                },\n                {\n                    date: moment(Date.UTC(2019, 9, 1, 20, 29, 0)),\n                    title: 'Headline 5',\n                    url: 'http://example.com/news/post5',\n                },\n                {\n                    date: moment(Date.UTC(2019, 8, 27, 2, 29, 33)),\n                    title: 'Headline 4',\n                    url: 'http://example.com/news/post4',\n                },\n            ]);\n\n            const $items = view.$content.children();\n            expect($items.length).toBe(3);\n\n            let $item = $items.eq(0);\n            expect($item.attr('href')).toBe('http://example.com/news/post6');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-date').text().strip()\n            ).toBe('Oct 20');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-title').text().strip()\n            ).toBe('Headline 6');\n\n            $item = $items.eq(1);\n            expect($item.attr('href')).toBe('http://example.com/news/post5');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-date')\n                .text().strip()\n            ).toBe('Oct 01');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-title')\n                .text().strip()\n            ).toBe('Headline 5');\n\n            $item = $items.eq(2);\n            expect($item.attr('href')).toBe('http://example.com/news/post4');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-date')\n                .text().strip()\n            ).toBe('Sep 26');\n            expect(\n                $item.find('.rb-c-admin-news-widget__item-title')\n                .text().strip()\n            ).toBe('Headline 4');\n        });\n\n        it('Load errors', function() {\n            view.render();\n\n            model.set('newsItems', []);\n\n            const $els = view.$content.children();\n            expect($els.length).toBe(1);\n\n            const $error = $els.eq(0);\n            expect($error.hasClass('rb-c-admin-news-widget__error'))\n                .toBeTrue();\n            expect($error.html().strip()).toBe(\n                'There was an error loading the news. Please ' +\n                '<a href=\"http://example.com/news/\">visit the news page</a> ' +\n                'directly, or try again later.');\n        });\n    });\n});\n"],"mappings":"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"}