{"version":3,"file":"diffCommentModel.js","names":["RB","DiffComment","BaseComment","extend","defaults","_","beginLineNum","endLineNum","fileDiff","fileDiffID","interFileDiff","interFileDiffID","baseFileDiffID","prototype","rspNamespace","expandedFields","attrToJsonMap","numLines","serializedAttrs","concat","deserializedAttrs","serializers","JSONSerializers","onlyIfUnloaded","onlyIfUnloadedAndValue","getNumLines","get","parseResourceData","rsp","result","call","num_lines","FileDiff","filediff","parse","interfilediff","validate","attrs","isNew","has","strings","INVALID_FILEDIFF_ID","hasBeginLineNum","BEGINLINENUM_GTE_0","hasEndLineNum","ENDLINENUM_GTE_0","BEGINLINENUM_LTE_ENDLINENUM","apply","arguments"],"sources":["../../../../../../static/rb/js/resources/models/diffCommentModel.es6.js"],"sourcesContent":["/**\n * Provides commenting functionality for diffs.\n *\n * A DiffComment represents a comment on a range of lines on either a\n * FileDiff or an interdiff consisting of two FileDiffs.\n *\n * Model Attributes:\n *     beginLineNum (number):\n *         The first line number in the range (0-indexed).\n *\n *     endLineNum (number):\n *         The last line number in the range (0-indexed).\n *\n *     fileDiff (RB.FileDiff):\n *         The FileDiff that the comment applies to.\n *\n *     fileDiffID (number):\n *         The ID of the FileDiff that the comment applies to.\n *\n *     interFileDiff (RB.FileDiff):\n *         The FileDiff at the end of an interdiff range that the comment\n *         applies to, if appropriate.\n *\n *         This attribute is mutually exclusive with ``baseFileDiffID``.\n *\n *     interFileDiffID (number):\n *         The ID of the FileDiff at the end of an interdiff range that the\n *         comment applies to.\n *\n *         This attribute is mutually exclusive with ``baseFileDiffID``.\n *\n *     baseFileDiffID (number):\n *         The ID of the base FileDiff in the cumulative diff that the\n *         comment is on.\n *\n *         This attribute is mutually exclusive with ``interFileDiffID``.\n */\nRB.DiffComment = RB.BaseComment.extend({\n    defaults: _.defaults({\n        beginLineNum: 0,\n        endLineNum: 0,\n        fileDiff: null,\n        fileDiffID: null,\n        interFileDiff: null,\n        interFileDiffID: null,\n        baseFileDiffID: null,\n    }, RB.BaseComment.prototype.defaults()),\n\n    rspNamespace: 'diff_comment',\n    expandedFields: ['filediff', 'interfilediff'],\n\n    attrToJsonMap: _.defaults({\n        baseFileDiffID: 'base_filediff_id',\n        beginLineNum: 'first_line',\n        fileDiffID: 'filediff_id',\n        interFileDiffID: 'interfilediff_id',\n        numLines: 'num_lines',\n    }, RB.BaseComment.prototype.attrToJsonMap),\n\n    serializedAttrs: [\n        'baseFileDiffID',\n        'beginLineNum',\n        'fileDiffID',\n        'interFileDiffID',\n        'numLines',\n    ].concat(RB.BaseComment.prototype.serializedAttrs),\n\n    deserializedAttrs: [\n        'beginLineNum',\n        'endLineNum'\n    ].concat(RB.BaseComment.prototype.deserializedAttrs),\n\n    serializers: _.defaults({\n        fileDiffID: RB.JSONSerializers.onlyIfUnloaded,\n        interFileDiffID: RB.JSONSerializers.onlyIfUnloadedAndValue,\n        baseFileDiffID: RB.JSONSerializers.onlyIfUnloadedAndValue,\n        numLines: function() {\n            return this.getNumLines();\n        }\n    }, RB.BaseComment.prototype.serializers),\n\n    /**\n     * Return the total number of lines the comment spans.\n     *\n     * Returns:\n     *     number:\n     *     The total number of lines for the comment.\n     */\n    getNumLines() {\n        return this.get('endLineNum') - this.get('beginLineNum') + 1;\n    },\n\n    /**\n     * Deserialize comment data from an API payload.\n     *\n     * Args:\n     *     rsp (object):\n     *         The data from the server.\n     *\n     * Returns:\n     *     object:\n     *     The model attributes to assign.\n     */\n    parseResourceData(rsp) {\n        const result = RB.BaseComment.prototype.parseResourceData.call(\n            this, rsp);\n\n        result.endLineNum = rsp.num_lines + result.beginLineNum - 1;\n\n        result.fileDiff = new RB.FileDiff(rsp.filediff, {\n            parse: true\n        });\n\n        if (rsp.interfilediff) {\n            result.interFileDiff = new RB.FileDiff(rsp.interfilediff, {\n                parse: true\n            });\n        }\n        return result;\n    },\n\n    /**\n     * Perform validation on the attributes of the model.\n     *\n     * This will check the range of line numbers to make sure they're\n     * a valid ordered range, along with the default comment validation.\n     *\n     * Args:\n     *     attrs (object):\n     *         The set of attributes to validate.\n     *\n     * Returns:\n     *     string:\n     *     An error string, if appropriate.\n     */\n    validate(attrs) {\n        /*\n         * XXX: Existing diff comments won't have the \"fileDiffID\" attribute\n         * populated when we load the object from the API. Since we don't do\n         * anything that needs that attribute unless we're trying to create a\n         * new diff comment, only check it if isNew().\n         */\n        if (this.isNew() && _.has(attrs, 'fileDiffID') && !attrs.fileDiffID) {\n            return RB.DiffComment.strings.INVALID_FILEDIFF_ID;\n        }\n\n        const hasBeginLineNum = _.has(attrs, 'beginLineNum');\n\n        if (hasBeginLineNum && attrs.beginLineNum < 0) {\n            return RB.DiffComment.strings.BEGINLINENUM_GTE_0;\n        }\n\n        const hasEndLineNum = _.has(attrs, 'endLineNum');\n\n        if (hasEndLineNum && attrs.endLineNum < 0) {\n            return RB.DiffComment.strings.ENDLINENUM_GTE_0;\n        }\n\n        if (hasBeginLineNum && hasEndLineNum &&\n            attrs.beginLineNum > attrs.endLineNum) {\n            return RB.DiffComment.strings.BEGINLINENUM_LTE_ENDLINENUM;\n        }\n\n        return RB.BaseComment.prototype.validate.apply(this, arguments);\n    }\n}, {\n    strings: {\n        INVALID_FILEDIFF_ID: 'fileDiffID must be a valid ID',\n        BEGINLINENUM_GTE_0: 'beginLineNum must be >= 0',\n        ENDLINENUM_GTE_0: 'endLineNum must be >= 0',\n        BEGINLINENUM_LTE_ENDLINENUM: 'beginLineNum must be <= endLineNum'\n    }\n});\n"],"mappings":"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"}