{"version":3,"file":"extraDataMixin.js","names":["RB","ExtraDataMixin","_setupExtraData","extraData","ExtraData","attributes","listenTo","_onExtraDataChanged","set","key","value","options","attrs","_","isObject","useExtraData","has","clone","Backbone","Model","prototype","call","trigger","getExtraData","get","setExtraData"],"sources":["../../../../../static/rb/js/models/extraDataMixin.es6.js"],"sourcesContent":["/**\n * A mixin to add a new extra data API to a model.\n *\n * The model this is attached to gains an extraData property that is backed by\n * the extraData key of the model's attributes object. This new API also\n * enhances the model such that extraData object can be interacted with on in a\n * key-value manner instead of dealing with the whole object.\n *\n * Any class that inherits this mixin should call _setupExtraData in its\n * initialize function to ensure that the mixin will work properly. This will\n * set up the property and event listeners.\n */\nRB.ExtraDataMixin = {\n    /**\n     * Set up the resource to add the new extra data API.\n     *\n     * This function should be called in the model's initialize function.\n     *\n     * This adds an extraData attribute that is backed by the model's\n     * attribute.extraData. This new model.extraData can be used directly in a\n     * model.extraData.get/set fashion to get or set individual keys in the\n     * extra data, instead of getting and setting the extra data all at once.\n     *\n     * This will also set up event listeners so that changes to extraData\n     * through the RB.ExtraData instance will trigger changed events on the\n     * model itself\n     */\n    _setupExtraData() {\n        this.extraData = new RB.ExtraData();\n        this.extraData.attributes = this.attributes.extraData;\n\n        this.listenTo(this.extraData, 'change', this._onExtraDataChanged);\n    },\n\n    /**\n     * Set the key to the value with the given options.\n     *\n     * This is a special case of Backbone.Model's set which does some extra\n     * work when dealing with a extraData member. It ensures that extraData is\n     * only ever set to an instance of RB.ExtraData and sets up a listener\n     * to fire change events when the extraData fires a change event.\n     *\n     * Args:\n     *     key (string):\n     *         The key to set.\n     *\n     *     value (*):\n     *         The value to set.\n     *\n     *     options (object):\n     *         Options for the set operation.\n     *\n     * Returns:\n     *     RB.ExtraDataMixin:\n     *     This object, for chaining.\n     */\n    set(key, value, options) {\n        let attrs;\n\n        if (_.isObject(key)) {\n            attrs = key;\n            options = value;\n        } else {\n            attrs = {};\n            attrs[key] = value;\n        }\n\n        const useExtraData = (_.has(attrs, 'extraData') &&\n                              _.has(this, 'extraData'));\n\n        if (useExtraData) {\n            if (attrs.extraData instanceof RB.ExtraData) {\n                /*\n                 * We don't want to assign an RB.ExtraData instance to the\n                 * model's extraData attribute because it expects a plain\n                 * JavaScript object.\n                 */\n                attrs.extraData = _.clone(attrs.extraData.attributes);\n            }\n        }\n\n        Backbone.Model.prototype.set.call(this, attrs, options);\n\n        if (useExtraData) {\n            this.extraData.attributes = this.attributes.extraData;\n        }\n\n        return this;\n    },\n\n    /**\n     * Handle a change event fired from the model's extra data.\n     *\n     * This fires both the change and change:extraData for this model.\n     *\n     * Args:\n     *     extraData (object):\n     *         The key:value mapping for the extra data.\n     *\n     *     options (object):\n     *         Options to pass along to event handlers.\n     */\n    _onExtraDataChanged(extraData, options) {\n        this.trigger('change:extraData', this, extraData, options);\n        this.trigger('change', this, options);\n    },\n\n    /**\n     * Get the key from the model's extra data.\n     *\n     * This should only be used when the model has an extraData attribute.\n     *\n     * Args:\n     *     key (string):\n     *         The key to fetch.\n     *\n     * Returns:\n     *     *:\n     *     The value of the data.\n     */\n    getExtraData(key) {\n        return this.extraData.get(key);\n    },\n\n    /**\n     * Set the key in the model's extra data to the value.\n     *\n     * This should only be used when the model has an extraData attribute.\n     *\n     * Args:\n     *     key (string):\n     *         The key to set.\n     *\n     *     value (*):\n     *         The value to set.\n     */\n    setExtraData(key, value) {\n        this.extraData.set(key, value);\n    },\n};\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,cAAH,GAAoB;EAChB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,eAAe,GAAG;IACd,KAAKC,SAAL,GAAiB,IAAIH,EAAE,CAACI,SAAP,EAAjB;IACA,KAAKD,SAAL,CAAeE,UAAf,GAA4B,KAAKA,UAAL,CAAgBF,SAA5C;IAEA,KAAKG,QAAL,CAAc,KAAKH,SAAnB,EAA8B,QAA9B,EAAwC,KAAKI,mBAA7C;EACH,CApBe;;EAsBhB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,GAAG,CAACC,GAAD,EAAMC,KAAN,EAAaC,OAAb,EAAsB;IACrB,IAAIC,KAAJ;;IAEA,IAAIC,CAAC,CAACC,QAAF,CAAWL,GAAX,CAAJ,EAAqB;MACjBG,KAAK,GAAGH,GAAR;MACAE,OAAO,GAAGD,KAAV;IACH,CAHD,MAGO;MACHE,KAAK,GAAG,EAAR;MACAA,KAAK,CAACH,GAAD,CAAL,GAAaC,KAAb;IACH;;IAED,MAAMK,YAAY,GAAIF,CAAC,CAACG,GAAF,CAAMJ,KAAN,EAAa,WAAb,KACAC,CAAC,CAACG,GAAF,CAAM,IAAN,EAAY,WAAZ,CADtB;;IAGA,IAAID,YAAJ,EAAkB;MACd,IAAIH,KAAK,CAACT,SAAN,YAA2BH,EAAE,CAACI,SAAlC,EAA6C;QACzC;AAChB;AACA;AACA;AACA;QACgBQ,KAAK,CAACT,SAAN,GAAkBU,CAAC,CAACI,KAAF,CAAQL,KAAK,CAACT,SAAN,CAAgBE,UAAxB,CAAlB;MACH;IACJ;;IAEDa,QAAQ,CAACC,KAAT,CAAeC,SAAf,CAAyBZ,GAAzB,CAA6Ba,IAA7B,CAAkC,IAAlC,EAAwCT,KAAxC,EAA+CD,OAA/C;;IAEA,IAAII,YAAJ,EAAkB;MACd,KAAKZ,SAAL,CAAeE,UAAf,GAA4B,KAAKA,UAAL,CAAgBF,SAA5C;IACH;;IAED,OAAO,IAAP;EACH,CA5Ee;;EA8EhB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACII,mBAAmB,CAACJ,SAAD,EAAYQ,OAAZ,EAAqB;IACpC,KAAKW,OAAL,CAAa,kBAAb,EAAiC,IAAjC,EAAuCnB,SAAvC,EAAkDQ,OAAlD;IACA,KAAKW,OAAL,CAAa,QAAb,EAAuB,IAAvB,EAA6BX,OAA7B;EACH,CA7Fe;;EA+FhB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIY,YAAY,CAACd,GAAD,EAAM;IACd,OAAO,KAAKN,SAAL,CAAeqB,GAAf,CAAmBf,GAAnB,CAAP;EACH,CA9Ge;;EAgHhB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIgB,YAAY,CAAChB,GAAD,EAAMC,KAAN,EAAa;IACrB,KAAKP,SAAL,CAAeK,GAAf,CAAmBC,GAAnB,EAAwBC,KAAxB;EACH;;AA9He,CAApB"}