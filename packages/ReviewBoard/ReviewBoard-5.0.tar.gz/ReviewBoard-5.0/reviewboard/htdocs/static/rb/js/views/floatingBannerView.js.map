{"version":3,"file":"floatingBannerView.js","names":["RB","FloatingBannerView","Backbone","View","extend","initialize","options","_$floatSpacer","_","bindAll","render","$","window","scroll","_updateFloatPosition","resize","_updateSize","defer","remove","prototype","call","$el","hasClass","rect","parent","getBoundingClientRect","width","Math","ceil","getExtents","length","wrap","$container","$floatContainer","containerTop","offset","top","containerHeight","outerHeight","containerBottom","windowTop","scrollTop","topOffset","wasFloating","noFloatContainerClass","height","css","addClass","removeClass","position"],"sources":["../../../../../static/rb/js/views/floatingBannerView.es6.js"],"sourcesContent":["/**\n * Floats a banner on screen within a container.\n *\n * The banner will appear at the top of the container, or the screen,\n * whichever is visible, until the container is no longer on-screen.\n *\n * The banner will keep a spacer in its original location at the top\n * of the container in order to reserve space for it to anchor to.\n * This ensures that the page doesn't jump too horribly.\n */\nRB.FloatingBannerView = Backbone.View.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     $floatContainer (jQuery):\n     *         The container to use when the banner is floating.\n     *\n     *     noFloatContainerClass (string):\n     *         The class name used when the banner should not be floating.\n     */\n    initialize(options) {\n        this.options = options;\n        this._$floatSpacer = null;\n\n        _.bindAll(this, '_updateFloatPosition', '_updateSize');\n    },\n\n    /**\n     * Render the banner and listens for scroll and resize updates.\n     *\n     * Returns:\n     *     RB.FloatingBannerView:\n     *     This object, for chaining.\n     */\n    render() {\n        $(window)\n            .scroll(this._updateFloatPosition)\n            .resize(this._updateSize);\n        _.defer(this._updateFloatPosition);\n\n        return this;\n    },\n\n    /**\n     * Remove the view from the DOM.\n     *\n     * This will remove both the banner and the floating spacer (if currently\n     * in the DOM).\n     */\n    remove() {\n        if (this._$floatSpacer !== null) {\n            this._$floatSpacer.remove();\n        }\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Update the size of the banner to match the spacer.\n     */\n    _updateSize() {\n        if (this._$floatSpacer !== null) {\n            if (this.$el.hasClass('floating')) {\n                const rect =\n                    this._$floatSpacer.parent()[0].getBoundingClientRect();\n\n                this.$el.width(\n                    Math.ceil(rect.width) -\n                    this.$el.getExtents('bpm', 'lr'));\n            } else {\n                this.$el.width('auto');\n            }\n        }\n    },\n\n    /**\n     * Update the position of the banner.\n     *\n     * This will factor in how much of the container is visible, based on\n     * its size, position, and the scroll offset. It will then attempt\n     * to position the banner to the top of the visible portion of the\n     * container.\n     */\n    _updateFloatPosition() {\n        if (this.$el.parent().length === 0) {\n            return;\n        }\n\n        if (this._$floatSpacer === null) {\n            this._$floatSpacer = this.$el.wrap($('<div/>')).parent();\n            this._updateSize();\n        }\n\n        const $container = this.options.$floatContainer;\n        const containerTop = $container.offset().top;\n        const containerHeight = $container.outerHeight();\n        const containerBottom = containerTop + containerHeight;\n        const windowTop = $(window).scrollTop();\n        const topOffset = this._$floatSpacer.offset().top - windowTop;\n        const outerHeight = this.$el.outerHeight(true);\n\n        const wasFloating = this.$el.hasClass('floating');\n\n        if (!$container.hasClass(this.options.noFloatContainerClass) &&\n            topOffset < 0 &&\n            containerTop < windowTop &&\n            windowTop < containerBottom) {\n            /*\n             * We're floating! If we just entered this state, set the\n             * appropriate styles on the element.\n             *\n             * We'll then want to set the top to 0, unless the user is\n             * scrolling the banner out of view. In that case, figure out how\n             * much to show, and set the appropriate offset.\n             */\n            if (!wasFloating) {\n                /*\n                 * Set the spacer to be the dimensions of the docked banner,\n                 * so that the container doesn't change sizes when we go into\n                 * float mode.\n                 */\n                this._$floatSpacer\n                    .height(this.$el.outerHeight())\n                    .css({\n                        'margin-top': this.$el.css('margin-top'),\n                        'margin-bottom': this.$el.css('margin-bottom'),\n                    });\n\n                this.$el\n                    .addClass('floating')\n                    .css('position', 'fixed');\n            }\n\n            this.$el.css('top',\n                         windowTop > containerBottom - outerHeight\n                         ? containerBottom - outerHeight - windowTop\n                         : 0);\n\n            this._updateSize();\n        } else if (wasFloating) {\n            /*\n             * We're now longer floating. Unset the styles on the banner and\n             * on the spacer (in order to prevent the spacer from taking up\n             * any additional room.\n             */\n            this.$el\n                .removeClass('floating')\n                .css({\n                    top: '',\n                    position: '',\n                });\n            this._$floatSpacer\n                .height('auto')\n                .css('margin', 0);\n        }\n    },\n});\n"],"mappings":"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"}