{"version":3,"file":"supportBannerView.js","names":["RB","SupportBannerView","Backbone","View","extend","_loadingHTML","_","template","titleText","_errorHTML","bodyText","fileText","initialize","options","now","Date","console","assert","instance","bindAll","window","addEventListener","_onError","_script","$","attr","supportURL","param","supportData","callback","valueOf","get","document","body","appendChild","e","target","render","html","className","removeEventListener","$el","empty","receive","supportLevel"],"sources":["../../../../../../static/rb/js/admin/views/supportBannerView.es6.js"],"sourcesContent":["/**\n * Show the current support status for the Review Board install.\n */\nRB.SupportBannerView = Backbone.View.extend({\n    _loadingHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><span class=\"fa fa-spin fa-spinner\"></span></p>\n    `)({\n        titleText: gettext('Retrieving support information...'),\n    }),\n\n    _errorHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><%- bodyText %></p>\n        <p><%= fileText %></p>\n    `)({\n        titleText: gettext('Failed to retrieve support information'),\n        bodyText: gettext('We could not communicate with the Beanbag, Inc. server to retrieve your support information. You may be behind a firewall or have no Internet access.'),\n        fileText: gettext('You may file an issue on our <a href=\"https://reviewboard.googlegroups.com\">community support tracker.</a>'),\n    }),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options passed to the view.\n     *\n     * Option Args:\n     *     supportData (string):\n     *         An encoded payload containing information used to look up\n     *         information on an active support contract for the server.\n     */\n    initialize(options) {\n        const now = new Date();\n\n        console.assert(RB.SupportBannerView.instance === null);\n        RB.SupportBannerView.instance = this;\n\n        _.bindAll(this, '_onError');\n\n        window.addEventListener('error', this._onError, true);\n\n        this._script = $('<script />')\n            .attr('src', RB.SupportBannerView.supportURL + '?' + $.param({\n                'support-data': options.supportData,\n                callback: 'RB.SupportBannerView.instance.receive',\n                _: now.valueOf(),  // Cache bust.\n            }))\n            .get(0);\n\n        /*\n         * If we use jQuery's appendTo, we end up with two <script> tags being\n         * added to the document.\n         */\n        document.body.appendChild(this._script);\n\n    },\n\n    /**\n     * Handle a DOM error.\n     *\n     * If the specified error targets the script tag (e.g., if it could not\n     * be loaded), then an error will be displayed in the banner\n     *\n     * Args:\n     *     e (Event):\n     *         The event that triggered this function.\n     */\n    _onError(e) {\n        if (e.target === this._script) {\n            this.render({\n                html: this._errorHTML,\n                className: 'error',\n            });\n\n            window.removeEventListener('error', this._onError, true);\n        }\n    },\n\n    /**\n     * Render the view\n     *\n     * Args:\n     *     options (object):\n     *         The rendering options.\n     *\n     * Option Args:\n     *     html (string)\n     *         The html to render in the banner.\n     *\n     *     className (string):\n     *         The name of the class to add to the banner.\n     */\n    render(options) {\n        options = _.extend({\n            className: 'loading',\n            html: this._loadingHTML,\n        }, options);\n\n        this.$el\n            .empty()\n            .html(options.html)\n            .attr('class', options.className);\n\n        return this;\n    },\n\n    /**\n     * Receive the data from the server.\n     *\n     * This is invoked via a JSONP callback.\n     *\n     * Args:\n     *     options (object):\n     *         The options received from the server.\n     *\n     * Option Args:\n     *     supportLevel (string):\n     *         The level of support the server has.\n     *\n     *     html (string):\n     *         The HTML to render in the banner.\n     */\n    receive(options) {\n        window.removeEventListener('error', this._onError, true);\n\n        this.render({\n            className: options.supportLevel + '-support',\n            html: options.html,\n        });\n    },\n}, {\n    instance: null,\n    supportURL: 'https://www.beanbaginc.com/support/reviewboard/_status/',\n});\n"],"mappings":"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"}