{"version":3,"file":"inlineFormView.js","names":["RB","Admin","InlineFormView","Backbone","View","extend","events","initialize","_$removeButton","_$title","render","$","listenTo","model","_onIndexChanged","index","get","prefix","idRegex","RegExp","newPrefix","_updateElements","el","id","replace","name","htmlFor","node","firstChild","nextSibling","text","_onDeleteClicked","e","preventDefault","stopPropagation","confirm","destroy"],"sources":["../../../../../../static/rb/js/admin/views/inlineFormView.es6.js"],"sourcesContent":["/**\n * A view managing inline forms, for related objects for models.\n *\n * This allows for providing form data for a database object that relates to\n * some primary object, or deleting the object. It's managed by\n * :js:class:`RB.Admin.InlineFormGroupView`.\n */\nRB.Admin.InlineFormView = Backbone.View.extend({\n    events: {\n        'click .rb-c-admin-form-inline__delete-action': '_onDeleteClicked',\n    },\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this._$removeButton = null;\n        this._$title = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.Admin.InlineFormView:\n     *     This view, for chaining.\n     */\n    render() {\n        this._$removeButton = this.$('.rb-c-admin-form-inline__delete-action');\n        this._$title = this.$('.rb-c-admin-form-inline__title-index');\n\n        this.listenTo(this.model, 'change:index', this._onIndexChanged);\n\n        return this;\n    },\n\n    /**\n     * Handle a change to the inline's index in the group.\n     *\n     * This will update the ID and title for this view, and the IDs, names,\n     * and references across all elements in the form.\n     */\n    _onIndexChanged() {\n        const index = this.model.get('index');\n        const prefix = this.model.get('prefix');\n        const idRegex = new RegExp(`(${prefix}-(\\\\d+|__prefix__))`);\n        const newPrefix = `${prefix}-${index}`;\n\n        function _updateElements(el) {\n            if (el.id) {\n                el.id = el.id.replace(idRegex, newPrefix);\n            }\n\n            if (el.name) {\n                el.name = el.name.replace(idRegex, newPrefix);\n            }\n\n            if (el.htmlFor) {\n                el.htmlFor = el.htmlFor.replace(idRegex, newPrefix);\n            }\n\n            for (let node = el.firstChild;\n                 node !== null;\n                 node = node.nextSibling) {\n                _updateElements(node);\n            }\n        }\n\n        this.el.id = newPrefix;\n        this._$title.text(`#${index + 1}`);\n\n        _updateElements(this.el);\n    },\n\n    /**\n     * Handle a click event on the Delete button for the inline.\n     *\n     * This will trigger the ``deleteClicked`` event, allowing the parent\n     * :js:class:`RB.Admin.InlineFormGroupView` to handle it.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onDeleteClicked(e) {\n        if (this.model.get('isInitial')) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (confirm(gettext('Are you sure you want to delete this? This cannot be undone.'))) {\n            this.model.destroy();\n        }\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,KAAH,CAASC,cAAT,GAA0BC,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqB;EAC3CC,MAAM,EAAE;IACJ,gDAAgD;EAD5C,CADmC;;EAK3C;AACJ;AACA;EACIC,UAAU,GAAG;IACT,KAAKC,cAAL,GAAsB,IAAtB;IACA,KAAKC,OAAL,GAAe,IAAf;EACH,CAX0C;;EAa3C;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,MAAM,GAAG;IACL,KAAKF,cAAL,GAAsB,KAAKG,CAAL,CAAO,wCAAP,CAAtB;IACA,KAAKF,OAAL,GAAe,KAAKE,CAAL,CAAO,sCAAP,CAAf;IAEA,KAAKC,QAAL,CAAc,KAAKC,KAAnB,EAA0B,cAA1B,EAA0C,KAAKC,eAA/C;IAEA,OAAO,IAAP;EACH,CA3B0C;;EA6B3C;AACJ;AACA;AACA;AACA;AACA;EACIA,eAAe,GAAG;IACd,MAAMC,KAAK,GAAG,KAAKF,KAAL,CAAWG,GAAX,CAAe,OAAf,CAAd;IACA,MAAMC,MAAM,GAAG,KAAKJ,KAAL,CAAWG,GAAX,CAAe,QAAf,CAAf;IACA,MAAME,OAAO,GAAG,IAAIC,MAAJ,CAAY,IAAGF,MAAO,qBAAtB,CAAhB;IACA,MAAMG,SAAS,GAAI,GAAEH,MAAO,IAAGF,KAAM,EAArC;;IAEA,SAASM,eAAT,CAAyBC,EAAzB,EAA6B;MACzB,IAAIA,EAAE,CAACC,EAAP,EAAW;QACPD,EAAE,CAACC,EAAH,GAAQD,EAAE,CAACC,EAAH,CAAMC,OAAN,CAAcN,OAAd,EAAuBE,SAAvB,CAAR;MACH;;MAED,IAAIE,EAAE,CAACG,IAAP,EAAa;QACTH,EAAE,CAACG,IAAH,GAAUH,EAAE,CAACG,IAAH,CAAQD,OAAR,CAAgBN,OAAhB,EAAyBE,SAAzB,CAAV;MACH;;MAED,IAAIE,EAAE,CAACI,OAAP,EAAgB;QACZJ,EAAE,CAACI,OAAH,GAAaJ,EAAE,CAACI,OAAH,CAAWF,OAAX,CAAmBN,OAAnB,EAA4BE,SAA5B,CAAb;MACH;;MAED,KAAK,IAAIO,IAAI,GAAGL,EAAE,CAACM,UAAnB,EACKD,IAAI,KAAK,IADd,EAEKA,IAAI,GAAGA,IAAI,CAACE,WAFjB,EAE8B;QAC1BR,eAAe,CAACM,IAAD,CAAf;MACH;IACJ;;IAED,KAAKL,EAAL,CAAQC,EAAR,GAAaH,SAAb;;IACA,KAAKX,OAAL,CAAaqB,IAAb,CAAmB,IAAGf,KAAK,GAAG,CAAE,EAAhC;;IAEAM,eAAe,CAAC,KAAKC,EAAN,CAAf;EACH,CAjE0C;;EAmE3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIS,gBAAgB,CAACC,CAAD,EAAI;IAChB,IAAI,KAAKnB,KAAL,CAAWG,GAAX,CAAe,WAAf,CAAJ,EAAiC;MAC7B;IACH;;IAEDgB,CAAC,CAACC,cAAF;IACAD,CAAC,CAACE,eAAF;;IAEA,IAAIC,OAAO,yEAAX,EAAsF;MAClF,KAAKtB,KAAL,CAAWuB,OAAX;IACH;EACJ;;AAxF0C,CAArB,CAA1B"}