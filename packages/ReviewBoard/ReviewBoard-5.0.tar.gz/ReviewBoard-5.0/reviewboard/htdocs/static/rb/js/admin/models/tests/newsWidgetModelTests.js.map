{"version":3,"file":"newsWidgetModelTests.js","names":["suite","model","beforeEach","RB","Admin","NewsWidget","rssURL","describe","it","_loadNews","url","options","expect","toBe","payload","parser","DOMParser","success","parseFromString","loadingNewsEventHandler","jasmine","createSpy","spyOn","$","and","callFake","on","loadNews","toHaveBeenCalled","ajax","newsItems","get","length","newsItem","date","isSame","Date","UTC","toBeTrue","title","error"],"sources":["../../../../../../../static/rb/js/admin/models/tests/newsWidgetModelTests.es6.js"],"sourcesContent":["suite('rb/admin/models/NewsWidget', function() {\n    let model;\n\n    beforeEach(function() {\n        model = new RB.Admin.NewsWidget({\n            rssURL: 'http://example.com/news/rss',\n        });\n    });\n\n    describe('Methods', function() {\n        describe('loadNews', function() {\n            it('Success', function() {\n                function _loadNews(url, options) {\n                    expect(url).toBe('http://example.com/news/rss');\n\n                    const payload = dedent`\n                        <?xml version=\"1.0\" encoding=\"utf-8\"?>\n\n                        <rss xmlns:atom=\"http://www.w3.org/2005/Atom\"\n                             version=\"2.0\">\n                         <channel>\n                          <title>Channel Name</title>\n                          <link>http://example.com/news/</link>\n                          <description>Channel description...</description>\n                          <atom:link href=\"http://example.com/news/rss\"\n                                     rel=\"self\"></atom:link>\n                          <language>en-us</language>\n                          <lastBuildDate>Sun, 20 Oct 2019 17:26:32 -0700</lastBuildDate>\n                          <item>\n                           <title>Headline 6</title>\n                           <pubDate>Sun, 20 Oct 2019 17:26:32 -0700</pubDate>\n                           <link>http://example.com/news/post6</link>\n                           <description>Brief summary of 6</description>\n                           <author>user1@example.com</author>\n                           <guid>http://example.com/news/post6</guid>\n                          </item>\n                          <item>\n                           <title>Headline 5</title>\n                           <pubDate>Tue, 01 Oct 2019 13:29:00 -0700</pubDate>\n                           <link>http://example.com/news/post5</link>\n                           <description>Brief summary of 5</description>\n                           <author>user2@example.com</author>\n                           <guid>http://example.com/news/post5</guid>\n                          </item>\n                          <item>\n                           <title>Headline 4</title>\n                           <pubDate>Thu, 26 Sep 2019 19:29:33 -0700</pubDate>\n                           <link>http://example.com/news/post4</link>\n                           <description>Brief summary of 4</description>\n                           <author>user1@example.com</author>\n                           <guid>http://example.com/news/post4</guid>\n                          </item>\n                          <item>\n                           <title>Headline 3</title>\n                           <pubDate>Sun, 08 Sep 2019 11:27:05 -0700</pubDate>\n                           <link>http://example.com/news/post3</link>\n                           <description>Brief summary of 3</description>\n                           <author>user2@example.com</author>\n                           <guid>http://example.com/news/post3</guid>\n                          </item>\n                          <item>\n                           <title>Headline 2</title>\n                           <pubDate>Fri, 30 Aug 2019 23:15:01 -0700</pubDate>\n                           <link>http://example.com/news/post2</link>\n                           <description>Brief summary of 2</description>\n                           <author>user1@example.com</author>\n                           <guid>http://example.com/news/post2</guid>\n                          </item>\n                          <item>\n                           <title>Headline 1</title>\n                           <pubDate>Thu, 29 Aug 2019 14:30:00 -0700</pubDate>\n                           <link>http://example.com/news/post1</link>\n                           <description>Brief summary of 1</description>\n                           <author>user2@example.com</author>\n                           <guid>http://example.com/news/post1</guid>\n                          </item>\n                         </channel>\n                        </rss>\n                    `;\n\n                    const parser = new DOMParser();\n                    options.success(parser.parseFromString(payload,\n                                                           'application/xml'));\n                }\n\n                const loadingNewsEventHandler = jasmine.createSpy();\n\n                spyOn($, 'ajax').and.callFake(_loadNews);\n                model.on('loadingNews', loadingNewsEventHandler);\n\n                model.loadNews();\n\n                expect(loadingNewsEventHandler).toHaveBeenCalled();\n                expect($.ajax).toHaveBeenCalled();\n\n                const newsItems = model.get('newsItems');\n                expect(newsItems.length).toBe(5);\n\n                let newsItem = newsItems[0];\n                expect(newsItem.date.isSame(Date.UTC(2019, 9, 21, 0, 26, 32)))\n                    .toBeTrue();\n                expect(newsItem.title).toBe('Headline 6');\n                expect(newsItem.url).toBe('http://example.com/news/post6');\n\n                newsItem = newsItems[1];\n                expect(newsItem.date.isSame(Date.UTC(2019, 9, 1, 20, 29, 0)))\n                    .toBeTrue();\n                expect(newsItem.title).toBe('Headline 5');\n                expect(newsItem.url).toBe('http://example.com/news/post5');\n\n                newsItem = newsItems[2];\n                expect(newsItem.date.isSame(Date.UTC(2019, 8, 27, 2, 29, 33)))\n                    .toBeTrue();\n                expect(newsItem.title).toBe('Headline 4');\n                expect(newsItem.url).toBe('http://example.com/news/post4');\n\n                newsItem = newsItems[3];\n                expect(newsItem.date.isSame(Date.UTC(2019, 8, 8, 18, 27, 5)))\n                    .toBeTrue();\n                expect(newsItem.title).toBe('Headline 3');\n                expect(newsItem.url).toBe('http://example.com/news/post3');\n\n                newsItem = newsItems[4];\n                expect(newsItem.date.isSame(Date.UTC(2019, 7, 31, 6, 15, 1)))\n                    .toBeTrue();\n                expect(newsItem.title).toBe('Headline 2');\n                expect(newsItem.url).toBe('http://example.com/news/post2');\n            });\n\n            it('Error loading feed', function() {\n                function _loadNews(url, options) {\n                    expect(url).toBe('http://example.com/news/rss');\n                    options.error();\n                }\n\n                const loadingNewsEventHandler = jasmine.createSpy();\n\n                spyOn($, 'ajax').and.callFake(_loadNews);\n                model.on('loadingNews', loadingNewsEventHandler);\n\n                model.loadNews();\n\n                expect(loadingNewsEventHandler).toHaveBeenCalled();\n                expect($.ajax).toHaveBeenCalled();\n\n                const newsItems = model.get('newsItems');\n                expect(newsItems.length).toBe(0);\n            });\n        });\n    });\n});\n\n"],"mappings":"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"}