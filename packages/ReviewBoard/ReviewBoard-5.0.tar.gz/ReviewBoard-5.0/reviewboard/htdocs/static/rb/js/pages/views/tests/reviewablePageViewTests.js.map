{"version":3,"file":"reviewablePageViewTests.js","names":["suite","pageTemplate","$editReview","$shipIt","page","pageView","beforeEach","$container","$","html","appendTo","$testsScratch","RB","DnDUploader","instance","find","ReviewablePage","checkForUpdates","reviewRequestData","id","loaded","state","ReviewRequest","PENDING","editorData","mutableByUser","statusMutableByUser","parse","spyOn","HeaderView","prototype","ReviewablePageView","el","model","reviewRequest","get","and","resolveTo","render","afterEach","remove","describe","it","expect","not","toBe","undefined","pendingReview","commentIssueManager","reviewRequestEditor","reviewRequestEditorView","ReviewDialogView","click","create","toHaveBeenCalled","options","calls","argsFor","review","done","window","returnValue","callThrough","draftReviewBanner","callFake","confirm","ready","publish","save","summary","user","url","fullname","username","$bubble","bubbleView","trigger","_updatesBubble","length","$el","is","text","attr","close","toHaveBeenCalledWith","info","NotificationManager","_canNotify","_onReviewRequestUpdated","notify","_showUpdatesBubble"],"sources":["../../../../../../../static/rb/js/pages/views/tests/reviewablePageViewTests.es6.js"],"sourcesContent":["suite('rb/pages/views/ReviewablePageView', function() {\n    const pageTemplate = dedent`\n        <div id=\"review-banner\"></div>\n        <a href=\"#\" id=\"review-action\">Edit Review</a>\n        <a href=\"#\" id=\"ship-it-action\">Ship It</a>\n    `;\n\n    let $editReview;\n    let $shipIt;\n    let page;\n    let pageView;\n\n    beforeEach(function() {\n        const $container = $('<div/>')\n            .html(pageTemplate)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        $editReview = $container.find('#review-action');\n        $shipIt = $container.find('#ship-it-action');\n\n        page = new RB.ReviewablePage({\n            checkForUpdates: false,\n            reviewRequestData: {\n                id: 123,\n                loaded: true,\n                state: RB.ReviewRequest.PENDING,\n            },\n            editorData: {\n                mutableByUser: true,\n                statusMutableByUser: true,\n            },\n        }, {\n            parse: true,\n        });\n\n        spyOn(RB.HeaderView.prototype, '_ensureSingleton');\n\n        pageView = new RB.ReviewablePageView({\n            el: $container,\n            model: page,\n        });\n\n        const reviewRequest = page.get('reviewRequest');\n\n        spyOn(reviewRequest, 'ready').and.resolveTo();\n\n        pageView.render();\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        pageView.remove();\n    });\n\n    describe('Public objects', function() {\n        it('reviewRequest', function() {\n            expect(page.get('reviewRequest')).not.toBe(undefined);\n        });\n\n        it('pendingReview', function() {\n            const pendingReview = page.get('pendingReview');\n\n            expect(pendingReview).not.toBe(undefined);\n            expect(pendingReview.get('parentObject'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('commentIssueManager', function() {\n            expect(page.commentIssueManager).not.toBe(undefined);\n            expect(page.commentIssueManager.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('reviewRequestEditor', function() {\n            const reviewRequestEditor = page.reviewRequestEditor;\n\n            expect(reviewRequestEditor).not.toBe(undefined);\n            expect(reviewRequestEditor.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n            expect(reviewRequestEditor.get('commentIssueManager'))\n                .toBe(page.commentIssueManager);\n            expect(reviewRequestEditor.get('editable')).toBe(true);\n        });\n\n        it('reviewRequestEditorView', function() {\n            expect(pageView.reviewRequestEditorView).not.toBe(undefined);\n            expect(pageView.reviewRequestEditorView.model)\n                .toBe(page.reviewRequestEditor);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Edit Review', function() {\n            spyOn(RB.ReviewDialogView, 'create');\n\n            $editReview.click();\n\n            expect(RB.ReviewDialogView.create).toHaveBeenCalled();\n\n            const options = RB.ReviewDialogView.create.calls.argsFor(0)[0];\n            expect(options.review).toBe(page.get('pendingReview'));\n            expect(options.reviewRequestEditor).toBe(page.reviewRequestEditor);\n        });\n\n        describe('Ship It', function() {\n            let pendingReview;\n\n            beforeEach(function() {\n                pendingReview = page.get('pendingReview');\n            });\n\n            it('Confirmed', function(done) {\n                spyOn(window, 'confirm').and.returnValue(true);\n                spyOn(pendingReview, 'ready').and.resolveTo();\n                spyOn(pendingReview, 'save').and.resolveTo();\n                spyOn(pendingReview, 'publish').and.callThrough();\n                spyOn(pageView.draftReviewBanner, 'hideAndReload')\n                    .and.callFake(() => {\n                        expect(window.confirm).toHaveBeenCalled();\n                        expect(pendingReview.ready).toHaveBeenCalled();\n                        expect(pendingReview.publish).toHaveBeenCalled();\n                        expect(pendingReview.save).toHaveBeenCalled();\n                        expect(pendingReview.get('shipIt')).toBe(true);\n                        expect(pendingReview.get('bodyTop')).toBe('Ship It!');\n\n                        done();\n                    });\n\n                $shipIt.click();\n            });\n\n            it('Canceled', function() {\n                spyOn(window, 'confirm').and.returnValue(false);\n                spyOn(pendingReview, 'ready');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Update bubble', function() {\n        const summary = 'My summary';\n        const user = {\n            url: '/users/foo/',\n            fullname: 'Mr. User',\n            username: 'user',\n        };\n        let $bubble;\n        let bubbleView;\n\n        beforeEach(function() {\n            page.get('reviewRequest').trigger('updated', {\n                summary: summary,\n                user: user,\n            });\n\n            $bubble = $('#updates-bubble');\n            bubbleView = pageView._updatesBubble;\n        });\n\n        it('Displays', function() {\n            expect($bubble.length).toBe(1);\n            expect(bubbleView.$el[0]).toBe($bubble[0]);\n            expect($bubble.is(':visible')).toBe(true);\n            expect($bubble.find('#updates-bubble-summary').text())\n                .toBe(summary);\n            expect($bubble.find('#updates-bubble-user').text())\n                .toBe(user.fullname);\n            expect($bubble.find('#updates-bubble-user').attr('href'))\n                .toBe(user.url);\n        });\n\n        describe('Actions', function() {\n            it('Ignore', function() {\n                spyOn(bubbleView, 'close').and.callThrough();\n                spyOn(bubbleView, 'trigger').and.callThrough();\n                spyOn(bubbleView, 'remove').and.callThrough();\n\n                $bubble.find('.ignore').click();\n\n                expect(bubbleView.close).toHaveBeenCalled();\n                expect(bubbleView.remove).toHaveBeenCalled();\n                expect(bubbleView.trigger).toHaveBeenCalledWith('closed');\n            });\n\n            it('Update Page displays Updates Bubble', function() {\n                spyOn(bubbleView, 'trigger');\n\n                $bubble.find('.update-page').click();\n\n                expect(bubbleView.trigger).toHaveBeenCalledWith('updatePage');\n            });\n\n            it('Update Page calls notify if shouldNotify', function() {\n                const info = {\n                    user: {\n                        fullname: 'Hello',\n                    },\n                };\n\n                RB.NotificationManager.instance._canNotify = true;\n                spyOn(RB.NotificationManager.instance, 'notify');\n                spyOn(RB.NotificationManager.instance,\n                      '_haveNotificationPermissions').and.returnValue(true);\n                spyOn(pageView, '_showUpdatesBubble');\n\n                pageView._onReviewRequestUpdated(info);\n\n                expect(RB.NotificationManager.instance.notify)\n                    .toHaveBeenCalled();\n                expect(pageView._showUpdatesBubble).toHaveBeenCalled();\n            });\n        });\n    });\n});\n"],"mappings":"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"}