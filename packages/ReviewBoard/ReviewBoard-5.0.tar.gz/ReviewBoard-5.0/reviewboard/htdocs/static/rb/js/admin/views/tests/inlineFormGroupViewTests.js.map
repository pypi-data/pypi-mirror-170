{"version":3,"file":"inlineFormGroupViewTests.js","names":["suite","inlineTemplate","_","template","$el","model","view","buildView","options","$","extend","initialForms","maxNumForms","minNumForms","numInlines","totalForms","appendTo","$testsScratch","RB","Admin","InlineFormGroupView","el","render","beforeEach","InlineFormGroup","prefix","describe","it","expect","find","length","toBe","_$inlineTemplate","hasClass","toBeFalse","get","inlines","_inlineViews","inline","at","toBeTrue","$totalForms","$addButton","val","click","destroy","$inlines","id","is","addInlineForm"],"sources":["../../../../../../../static/rb/js/admin/views/tests/inlineFormGroupViewTests.es6.js"],"sourcesContent":["suite('rb/admin/views/InlineFormGroupView', function() {\n    const inlineTemplate = _.template(dedent`\n        <div class=\"rb-c-admin-form-inline <%- classes || '' %>\">\n         <h3 class=\"rb-c-admin-form-inline__title\">\n          <span class=\"rb-c-admin-form-inline__title-prefix\"></span>\n          <span class=\"rb-c-admin-form-inline__title-object\"></span>\n          <span class=\"rb-c-admin-form-inline__title-index\"></span>\n          <span class=\"rb-c-admin-form-inline__actions\">\n           <span class=\"rb-c-admin-form-inline__delete-action\"></span>\n          </span>\n         </h3>\n         <fieldset>\n          <div>\n           <label for=\"myprefix-<%- index %>-foo\"></label>\n           <input id=\"myprefix-<%- index %>-foo\"\n                  name=\"myprefix-<%- index %>-foo\">\n          </div>\n          <div>\n           <label for=\"myprefix-<%- index %>-bar\"></label>\n           <input id=\"myprefix-<%- index %>-bar\"\n                  name=\"myprefix-<%- index %>-bar\">\n          </div>\n         </fieldset>\n        </div>\n    `);\n\n    const template = _.template(dedent`\n        <div class=\"rb-c-admin-form-inline-group\">\n         <h2 class=\"rb-c-admin-form-inline-group__title\"></h2>\n         <div class=\"rb-c-admin-form-inline-group__inlines\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-TOTAL_FORMS\"\n                 name=\"myprefix-TOTAL_FORMS\"\n                 value=\"<%- totalForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-INITIAL_FORMS\"\n                 name=\"myprefix-INITIAL_FORMS\"\n                 value=\"<%- initialForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-MIN_NUM_FORMS\"\n                 name=\"myprefix-MIN_NUM_FORMS\"\n                 value=\"<%- minNumForms %>\">\n          <input type=\"hidden\"\n                 id=\"id_myprefix-MAX_NUM_FORMS\"\n                 name=\"myprefix-MAX_NUM_FORMS\"\n                 value=\"<%- maxNumForms %>\">\n\n          <% for (let i = 0; i < numInlines; i++) { %>\n           <%= inlineTemplate({\n               classes: '',\n               index: i\n           }) %>\n          <% } %>\n          <%= inlineTemplate({\n              classes: '-is-template',\n              index: '__prefix__'\n          }) %>\n         </div>\n         <div class=\"rb-c-admin-form-inline-group__actions\">\n          <a href=\"#\" class=\"rb-c-admin-form-inline-group__add-action\"></a>\n         </div>\n        </div>\n    `);\n\n    let $el;\n    let model;\n    let view;\n\n    function buildView(options) {\n        $el =\n            $(template(_.extend({\n                initialForms: 0,\n                inlineTemplate: inlineTemplate,\n                maxNumForms: '',\n                minNumForms: 0,\n                numInlines: 0,\n                totalForms: 0,\n            }, options)))\n            .appendTo($testsScratch);\n\n        view = new RB.Admin.InlineFormGroupView({\n            el: $el,\n            model: model,\n        });\n        view.render();\n    }\n\n    beforeEach(function() {\n        model = new RB.Admin.InlineFormGroup({\n            prefix: 'myprefix',\n        });\n    });\n\n    describe('State', function() {\n        it('Populated on render', function() {\n            buildView({\n                numInlines: 2,\n                initialForms: 2,\n                minNumForms: 1,\n                maxNumForms: 5,\n                totalForms: 2,\n            });\n\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(2);\n            expect(view._$inlineTemplate.length).toBe(1);\n            expect(view._$inlineTemplate.hasClass('-is-template')).toBeFalse();\n\n            expect(model.get('initialInlines')).toBe(2);\n            expect(model.get('maxInlines')).toBe(5);\n            expect(model.get('minInlines')).toBe(1);\n\n            expect(model.inlines.length).toBe(2);\n            expect(view._inlineViews.length).toBe(2);\n\n            let inline = model.inlines.at(0);\n            expect(inline.get('index')).toBe(0);\n            expect(inline.get('isInitial')).toBeTrue();\n            expect(view._inlineViews[0].model).toBe(inline);\n\n            inline = model.inlines.at(1);\n            expect(inline.get('index')).toBe(1);\n            expect(inline.get('isInitial')).toBeTrue();\n            expect(view._inlineViews[1].model).toBe(inline);\n        });\n\n        it('Updated when inlines added', function() {\n            buildView({\n                numInlines: 1,\n                initialForms: 1,\n                totalForms: 1,\n            });\n\n            const $totalForms = $el.find('#id_myprefix-TOTAL_FORMS');\n            const $addButton =\n                $el.find('.rb-c-admin-form-inline-group__add-action');\n\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(1);\n            expect($totalForms.val()).toBe('1');\n\n            $addButton.click();\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(2);\n            expect($totalForms.val()).toBe('2');\n\n            $addButton.click();\n            expect($el.find('.rb-c-admin-form-inline').length).toBe(3);\n            expect($totalForms.val()).toBe('3');\n        });\n\n        it('Updated when inlines added', function() {\n            buildView({\n                numInlines: 2,\n                initialForms: 2,\n                totalForms: 2,\n            });\n\n            const $totalForms = $el.find('#id_myprefix-TOTAL_FORMS');\n\n            expect(model.inlines.length).toBe(2);\n            expect($totalForms.val()).toBe('2');\n\n            model.inlines.at(0).destroy();\n\n            const $inlines = $el.find('.rb-c-admin-form-inline');\n            expect($inlines.length).toBe(1);\n            expect(model.inlines.length).toBe(1);\n            expect($totalForms.val()).toBe('1');\n            expect($inlines[0].id).toBe('myprefix-0');\n        });\n    });\n\n    describe('UI', function() {\n        describe('Add Button', function() {\n            let $addButton;\n\n            beforeEach(function() {\n                buildView({\n                    numInlines: 1,\n                    initialForms: 1,\n                    minNumForms: 0,\n                    maxNumForms: 3,\n                    totalForms: 1,\n                });\n\n                $addButton =\n                    $el.find('.rb-c-admin-form-inline-group__add-action');\n                expect($addButton.length).toBe(1);\n            });\n\n            it('When under limit', function() {\n                expect($addButton.is(':visible')).toBeTrue();\n\n                view.addInlineForm();\n                expect($addButton.is(':visible')).toBeTrue();\n            });\n\n            it('When limit hit', function() {\n                expect($addButton.is(':visible')).toBeTrue();\n\n                view.addInlineForm();\n                view.addInlineForm();\n                expect($addButton.is(':visible')).toBeFalse();\n            });\n        });\n    });\n});\n"],"mappings":"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"}