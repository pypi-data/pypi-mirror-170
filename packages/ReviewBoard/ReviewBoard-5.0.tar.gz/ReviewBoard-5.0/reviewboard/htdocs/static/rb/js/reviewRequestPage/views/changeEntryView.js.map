{"version":3,"file":"changeEntryView.js","names":["ParentView","RB","ReviewRequestPage","BaseStatusUpdatesEntryView","ChangeEntryView","extend","initialize","options","prototype","apply","arguments","reviewRequestEditor","model","get","reviewRequest","reviewRequestEditorView","_commitListView","_$boxStatus","_$fixItLabel","render","call","$","hide","appendTo","formatText","bugTrackerURL","isHTMLEncoded","_updateLabels","_","each","rowEl","$row","iconView","DiffComplexityIconView","numInserts","data","numDeletes","numReplaces","totalLines","find","empty","append","$el","thumbnailEl","$thumbnail","$caption","draft","createFileAttachment","id","hasClass","set","text","buildFileAttachmentThumbnail","canEdit","commits","DiffCommitListView","el","DiffCommitList","diffHistory","CommitHistoryDiffEntryCollection","setupReviewView","view","listenTo","_reviewViews","some","hasOpenIssues","openIssueCount","reduce","sum","getOpenIssueCount","addClass","interpolate","document","createTextNode","show","css","opacity","left","removeClass"],"sources":["../../../../../../static/rb/js/reviewRequestPage/views/changeEntryView.es6.js"],"sourcesContent":["(function() {\n\n\nconst ParentView = RB.ReviewRequestPage.BaseStatusUpdatesEntryView;\n\n\n/**\n * Displays the \"Review request changed\" entry on the review request page.\n *\n * This handles any rendering needed for special contents in the box,\n * such as the diff complexity icons and the file attachment thumbnails.\n */\nRB.ReviewRequestPage.ChangeEntryView = ParentView.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *          Options for the view.\n     *\n     * Option Args:\n     *     reviewRequestEditorView (RB.ReviewRequestEditorView):\n     *         The review request editor.\n     */\n    initialize(options) {\n        ParentView.prototype.initialize.apply(this, arguments);\n\n        const reviewRequestEditor = this.model.get('reviewRequestEditor');\n\n        this.reviewRequest = reviewRequestEditor.get('reviewRequest');\n        this.reviewRequestEditorView = options.reviewRequestEditorView;\n\n        this._commitListView = null;\n\n        this._$boxStatus = null;\n        this._$fixItLabel = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.ReviewRequestPage.ChangeEntryView:\n     *     This object, for chaining.\n     */\n    render() {\n        ParentView.prototype.render.call(this);\n\n        this._$boxStatus = this.$('.box-status');\n        this._$fixItLabel = $('<label class=\"fix-it-label\">')\n            .hide()\n            .appendTo(this.$('.labels-container'));\n\n        RB.formatText(this.$('.changedesc-text'), {\n            bugTrackerURL: this.reviewRequest.get('bugTrackerURL'),\n            isHTMLEncoded: true,\n        });\n\n        this._updateLabels();\n\n        _.each(this.$('.diff-index tr'), rowEl => {\n            const $row = $(rowEl);\n            const iconView = new RB.DiffComplexityIconView({\n                numInserts: $row.data('insert-count'),\n                numDeletes: $row.data('delete-count'),\n                numReplaces: $row.data('replace-count'),\n                totalLines: $row.data('total-line-count'),\n            });\n\n            $row.find('.diff-file-icon')\n                .empty()\n                .append(iconView.$el);\n\n            iconView.render();\n        });\n\n        _.each(this.$('.file-container'), thumbnailEl => {\n            const $thumbnail = $(thumbnailEl);\n            const $caption = $thumbnail.find('.file-caption .edit');\n            const model = this.reviewRequest.draft.createFileAttachment({\n                id: $thumbnail.data('file-id')\n            });\n\n            if (!$caption.hasClass('empty-caption')) {\n                model.set('caption', $caption.text());\n            }\n\n            this.reviewRequestEditorView.buildFileAttachmentThumbnail(\n                model, null,\n                {\n                    $el: $thumbnail,\n                    canEdit: false,\n                });\n        });\n\n        const commits = this.model.get('commits');\n\n        if (commits) {\n            this._commitListView = new RB.DiffCommitListView({\n                el: this.$('.commit-list-container'),\n                model: new RB.DiffCommitList({\n                    commits: commits,\n                    diffHistory: new RB.CommitHistoryDiffEntryCollection(),\n                }),\n            });\n        }\n\n        return this;\n    },\n\n    /**\n     * Set up a review view.\n     *\n     * This will begin listening for changes to the issue counts and\n     * update the labels on the box.\n     *\n     * Args:\n     *     view (RB.ReviewRequestPage.ReviewView):\n     *         The review view being set up.\n     */\n    setupReviewView(view) {\n        this.listenTo(view, 'openIssuesChanged', this._updateLabels);\n    },\n\n    /**\n     * Update the \"Fix It\" label based on the open issue counts.\n     *\n     * If there are open issues, there will be a \"Fix it!\" label.\n     */\n    _updateLabels() {\n        if (this._reviewViews.some(view => view.hasOpenIssues())) {\n            const openIssueCount = this._reviewViews.reduce(\n                (sum, view) => sum + view.getOpenIssueCount(),\n                0);\n\n            this._$boxStatus.addClass('has-issues');\n            this._$fixItLabel\n                .empty()\n                .append(\n                    $('<span class=\"open-issue-count\">')\n                        .text(interpolate(gettext('%s failed'),\n                                          [openIssueCount]))\n                )\n                .append(document.createTextNode(gettext('Fix it!')))\n                .show()\n                .css({\n                    opacity: 1,\n                    left: 0,\n                });\n        } else {\n            this._$fixItLabel.css({\n                opacity: 0,\n                left: '-100px',\n            });\n            this._$boxStatus.removeClass('has-issues');\n        }\n    }\n});\n\n\n})();\n"],"mappings":"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"}