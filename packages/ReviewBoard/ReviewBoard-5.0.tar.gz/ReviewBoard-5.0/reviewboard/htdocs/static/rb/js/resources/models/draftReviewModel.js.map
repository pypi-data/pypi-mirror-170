{"version":3,"file":"draftReviewModel.js","names":["RB","DraftReview","Review","extend","_","defaults","publishAndArchive","publishToOwnerOnly","prototype","attrToJsonMap","serializedAttrs","concat","serializers","JSONSerializers","onlyIfValue","publish","options","context","undefined","isFunction","success","error","complete","console","warn","promiseToCallbacks","newOptions","trigger","ready","set","save","attrs","err","xhr","errorText","DraftResourceModelMixin"],"sources":["../../../../../../static/rb/js/resources/models/draftReviewModel.es6.js"],"sourcesContent":["/**\n * A draft review.\n *\n * Draft reviews are more complicated than most objects. A draft may already\n * exist on the server, in which case we need to be able to get its ID. A\n * special resource exists at /reviews/draft/ which will redirect to the\n * existing draft if one exists, and return 404 if not.\n */\nRB.DraftReview = RB.Review.extend(_.extend({\n    defaults: _.defaults({\n        publishAndArchive: false,\n        publishToOwnerOnly: false,\n    }, RB.Review.prototype.defaults()),\n\n    attrToJsonMap: _.defaults({\n        publishAndArchive: 'publish_and_archive',\n        publishToOwnerOnly: 'publish_to_owner_only',\n    }, RB.Review.prototype.attrToJsonMap),\n\n    serializedAttrs: [\n        'publishAndArchive',\n        'publishToOwnerOnly',\n    ].concat(RB.Review.prototype.serializedAttrs),\n\n    serializers: _.defaults({\n        publishAndArchive: RB.JSONSerializers.onlyIfValue,\n        publishToOwnerOnly: RB.JSONSerializers.onlyIfValue,\n    }, RB.Review.prototype.serializers),\n\n\n    /**\n     * Publish the review.\n     *\n     * Before publish, the \"publishing\" event will be triggered.\n     *\n     * After the publish has succeeded, the \"published\" event will be\n     * triggered.\n     *\n     * Version Changed:\n     *     5.0:\n     *     Deprecated the callbacks and added a promise return value.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the operation.\n     *\n     *     context (object, optional):\n     *         Context to bind when calling callbacks.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise which resolves when the operation is complete.\n     */\n    async publish(options={}, context=undefined) {\n        if (_.isFunction(options.success) ||\n            _.isFunction(options.error) ||\n            _.isFunction(options.complete)) {\n            console.warn('RB.DraftReview.publish was called using callbacks. ' +\n                         'Callers should be updated to use promises instead.');\n            return RB.promiseToCallbacks(\n                options, context, newOptions => this.publish(newOptions));\n        }\n\n        this.trigger('publishing');\n\n        await this.ready();\n\n        this.set('public', true);\n\n        try {\n            await this.save({ attrs: options.attrs });\n        } catch (err) {\n            this.trigger('publishError', err.xhr.errorText);\n            throw err;\n        }\n\n        this.trigger('published');\n    }\n}, RB.DraftResourceModelMixin));\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,WAAH,GAAiBD,EAAE,CAACE,MAAH,CAAUC,MAAV,CAAiBC,CAAC,CAACD,MAAF,CAAS;EACvCE,QAAQ,EAAED,CAAC,CAACC,QAAF,CAAW;IACjBC,iBAAiB,EAAE,KADF;IAEjBC,kBAAkB,EAAE;EAFH,CAAX,EAGPP,EAAE,CAACE,MAAH,CAAUM,SAAV,CAAoBH,QAApB,EAHO,CAD6B;EAMvCI,aAAa,EAAEL,CAAC,CAACC,QAAF,CAAW;IACtBC,iBAAiB,EAAE,qBADG;IAEtBC,kBAAkB,EAAE;EAFE,CAAX,EAGZP,EAAE,CAACE,MAAH,CAAUM,SAAV,CAAoBC,aAHR,CANwB;EAWvCC,eAAe,EAAE,CACb,mBADa,EAEb,oBAFa,EAGfC,MAHe,CAGRX,EAAE,CAACE,MAAH,CAAUM,SAAV,CAAoBE,eAHZ,CAXsB;EAgBvCE,WAAW,EAAER,CAAC,CAACC,QAAF,CAAW;IACpBC,iBAAiB,EAAEN,EAAE,CAACa,eAAH,CAAmBC,WADlB;IAEpBP,kBAAkB,EAAEP,EAAE,CAACa,eAAH,CAAmBC;EAFnB,CAAX,EAGVd,EAAE,CAACE,MAAH,CAAUM,SAAV,CAAoBI,WAHV,CAhB0B;;EAsBvC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAMG,OAAN,GAA6C;IAAA,IAA/BC,OAA+B,uEAAvB,EAAuB;IAAA,IAAnBC,OAAmB,uEAAXC,SAAW;;IACzC,IAAId,CAAC,CAACe,UAAF,CAAaH,OAAO,CAACI,OAArB,KACAhB,CAAC,CAACe,UAAF,CAAaH,OAAO,CAACK,KAArB,CADA,IAEAjB,CAAC,CAACe,UAAF,CAAaH,OAAO,CAACM,QAArB,CAFJ,EAEoC;MAChCC,OAAO,CAACC,IAAR,CAAa,wDACA,oDADb;MAEA,OAAOxB,EAAE,CAACyB,kBAAH,CACHT,OADG,EACMC,OADN,EACeS,UAAU,IAAI,KAAKX,OAAL,CAAaW,UAAb,CAD7B,CAAP;IAEH;;IAED,KAAKC,OAAL,CAAa,YAAb;IAEA,MAAM,KAAKC,KAAL,EAAN;IAEA,KAAKC,GAAL,CAAS,QAAT,EAAmB,IAAnB;;IAEA,IAAI;MACA,MAAM,KAAKC,IAAL,CAAU;QAAEC,KAAK,EAAEf,OAAO,CAACe;MAAjB,CAAV,CAAN;IACH,CAFD,CAEE,OAAOC,GAAP,EAAY;MACV,KAAKL,OAAL,CAAa,cAAb,EAA6BK,GAAG,CAACC,GAAJ,CAAQC,SAArC;MACA,MAAMF,GAAN;IACH;;IAED,KAAKL,OAAL,CAAa,WAAb;EACH;;AArEsC,CAAT,EAsE/B3B,EAAE,CAACmC,uBAtE4B,CAAjB,CAAjB"}