{"version":3,"file":"dashboardPageView.js","names":["RB","Admin","DashboardPageView","PageView","extend","events","initialize","prototype","apply","arguments","_widgetViews","_widgetWidths","_orderedWidgets","_$dashboardView","_$widgetsContainer","_$widgetsMain","_$widgets","_masonry","renderPage","call","$","find","children","$sizerGutter","$sizerColumn","Masonry","columnWidth","gutter","transitionDuration","initLayout","supportData","model","get","supportBanner","SupportBannerView","el","render","_loadWidgets","on","_onLayoutComplete","bind","css","sortableWidgets","index","loadWidgets","widgetOptions","widgetModel","widgetView","ViewType","_","defaults","domID","viewOptions","$el","addClass","listenTo","_onWidgetSizeChanged","id","widgetEl","width","offsetWidth","push","isFullWidth","hasClass","sort","a","b","items","addItems","pluck","layout","widgets","each","widget","newWidth","updateSize","widgetID","$widget"],"sources":["../../../../../../static/rb/js/admin/views/dashboardPageView.es6.js"],"sourcesContent":["/**\n * The administration UI's main dashboard page.\n *\n * This displays all the widgets rendered on the dashboard, allowing users to\n * see important details about their install from one place.\n */\nRB.Admin.DashboardPageView = RB.Admin.PageView.extend({\n    events: {\n        'click .js-action-remove-widget': '_onRemoveWidgetClicked',\n    },\n\n    /**\n     * Initialize the page.\n     */\n    initialize() {\n        RB.Admin.PageView.prototype.initialize.apply(this, arguments);\n\n        this._widgetViews = {};\n        this._widgetWidths = {};\n        this._orderedWidgets = [];\n        this._$dashboardView = null;\n        this._$widgetsContainer = null;\n        this._$widgetsMain = null;\n        this._$widgets = null;\n        this._masonry = null;\n    },\n\n    /**\n     * Render the page.\n     *\n     * This will set up the support banner and the dashboard widgets.\n     */\n    renderPage() {\n        RB.Admin.PageView.prototype.renderPage.call(this);\n\n        /* Set up the main dashboard widgets area. */\n        this._$dashboardView = this.$('#admin-dashboard');\n        this._$widgetsContainer = this._$dashboardView.find(\n            '.rb-c-admin-widgets');\n        this._$widgetsMain = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__main');\n        this._$widgets = this._$widgetsMain.children('.rb-c-admin-widget');\n\n        const $sizerGutter = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__sizer-gutter');\n        const $sizerColumn = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__sizer-column');\n\n        this._masonry = new Masonry(this._$widgetsMain[0], {\n            columnWidth: $sizerColumn[0],\n            gutter: $sizerGutter[0],\n            transitionDuration: 0,\n            initLayout: false,\n        });\n\n        /* Show a banner detailing the support coverage for the server. */\n        const supportData = this.model.get('supportData');\n\n        if (supportData) {\n            const supportBanner = new RB.SupportBannerView({\n                el: $('#support-banner'),\n                supportData: this.model.get('supportData'),\n            });\n            supportBanner.render();\n        }\n\n        this._loadWidgets();\n\n        this._masonry.on('layoutComplete', this._onLayoutComplete.bind(this));\n\n        /* Now that everything is in place, show the dashboard. */\n        this._$dashboardView.css('visibility', 'visible');\n    },\n\n    /**\n     * Load all widgets for the view.\n     *\n     * The widgets will be loaded based on the data passed to the model,\n     * and will then be added to Masonry in order of largest to smallest\n     * widget.\n     */\n    _loadWidgets() {\n        const sortableWidgets = [];\n        let index = 0;\n\n        /* Render all the widgets. */\n        this.model.loadWidgets(widgetOptions => {\n            const widgetModel = widgetOptions.widgetModel;\n            const widgetView = new widgetOptions.ViewType(_.defaults(\n                {\n                    el: $(`#${widgetOptions.domID}`),\n                    model: widgetModel,\n                },\n                widgetOptions.viewOptions));\n\n            widgetView.$el.addClass('js-masonry-item');\n            widgetView.render();\n\n            this.listenTo(widgetView, 'sizeChanged',\n                          () => this._onWidgetSizeChanged(widgetModel.id,\n                                                          widgetView.$el));\n\n            const widgetEl = widgetView.el;\n            const width = widgetEl.offsetWidth;\n\n            this._widgetViews[widgetModel.id] = widgetView;\n            this._widgetWidths[widgetModel.id] = width;\n            sortableWidgets.push({\n                el: widgetEl,\n                index: index,\n                isFullWidth: widgetView.$el.hasClass('-is-full-size'),\n                width: width,\n            });\n        });\n\n        /*\n         * Force a specific sort order for the widgets to ensure the most\n         * compact layout, ideally keeping everything on screen.\n         *\n         * We require a stable order (widgets of the same size should be in a\n         * predictable order), and we have to account for full-width widgets,\n         * so our comparator is a little bit more complex. We use the\n         * following rules:\n         *\n         * 1) Full-size widgets are positioned at the top.\n         * 2) Column-based widgets are then ordered from largest to smallest.\n         * 3) Any widgets of the same size are sorted according to their\n         *    registration index.\n         */\n        sortableWidgets.sort((a, b) => {\n            if (a.isFullWidth && !b.isFullWidth) {\n                return -1;\n            } else if (!a.isFullWidth && b.isFullWidth) {\n                return 1;\n            } else if (!a.isFullWidth && !b.isFullWidth &&\n                       a.width !== b.width) {\n                if (a.width > b.width) {\n                    return -1;\n                } else if (a.width < b.width) {\n                    return 1;\n                }\n            }\n\n            /* The widths are equal. Keep the widgets in index order. */\n            return a.index - b.index;\n        });\n\n        this._masonry.items = [];\n        this._masonry.addItems(_.pluck(sortableWidgets, 'el'));\n        this._masonry.layout();\n    },\n\n    /**\n     * Handle a completed widget re-layout.\n     *\n     * This will go through all the widgets and determine if any have changed\n     * their sizes (widths). If so, their\n     * :js:func:`RB.Admin.WidgetView.updateSize` method will be called.\n     */\n    _onLayoutComplete() {\n        this.model.widgets.each(widget => {\n            const widgetView = this._widgetViews[widget.id];\n            const newWidth = widgetView.$el.width();\n\n            if (newWidth !== this._widgetWidths[widget.id]) {\n                widgetView.updateSize();\n                this._widgetWidths[widget.id] = newWidth;\n            }\n        });\n    },\n\n    /**\n     * Handle changes to widget sizes.\n     *\n     * This is called in response to the ``sizeChanged`` events on widgets. If\n     * the size of the widget has actually changed, this will record the new\n     * width and then update the positions of widgets accordingly.\n     *\n     * Args:\n     *     widgetID (string):\n     *         The ID of the widget that changed size.\n     *\n     *     $widget (jQuery):\n     *         The widget's jQuery-wrapped element.\n     */\n    _onWidgetSizeChanged(widgetID, $widget) {\n        const newWidth = $widget.width();\n\n        if (newWidth !== this._widgetWidths[widgetID]) {\n            this._widgetWidths[widgetID] = newWidth;\n            this._masonry.layout();\n        }\n    },\n});\n"],"mappings":"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"}