{"version":3,"file":"reviewModel.js","names":["RB","Review","BaseResource","extend","defaults","_","forceTextType","shipIt","bodyTop","bodyTopRichText","bodyBottom","bodyBottomRichText","draftReply","htmlTextFields","includeTextTypes","markdownTextFields","rawTextFields","timestamp","prototype","rspNamespace","attrToJsonMap","serializedAttrs","deserializedAttrs","serializers","JSONSerializers","onlyIfValue","textType","value","undefined","supportsExtraData","parseResourceData","rsp","raw_text_fields","data","call","body_top_text_type","body_bottom_text_type","body_bottom","body_top","markdown_text_fields","html_text_fields","createDiffComment","options","length","console","warn","join","id","fileDiffID","interFileDiffID","beginLineNum","endLineNum","baseFileDiffID","error","DiffComment","parentObject","createScreenshotComment","screenshotID","x","y","width","height","ScreenshotComment","createFileAttachmentComment","fileAttachmentID","diffAgainstFileAttachmentID","FileAttachmentComment","createGeneralComment","issueOpened","GeneralComment","createReply","get","ReviewReply","set","once","reviewRequest","markUpdated"],"sources":["../../../../../../static/rb/js/resources/models/reviewModel.es6.js"],"sourcesContent":["/**\n * A review.\n *\n * This corresponds to a top-level review. Replies are encapsulated in\n * RB.ReviewReply.\n *\n * Model Attributes:\n *     forceTextType (string):\n *         The text format type to request for text in all responses.\n *\n *     shipIt (boolean):\n *         Whether this review has the \"Ship It!\" state.\n *\n *     public (boolean):\n *         Whether this review has been published.\n *\n *     bodyTop (string):\n *         The contents of the header that shows up above all comments in the\n *         review.\n *\n *     bodyTopRichText (boolean):\n *         Whether the ``bodyTop`` field should be rendered as Markdown.\n *\n *     bodyBottom (string):\n *         The contents of the footer that shows up below all comments in the\n *         review.\n *\n *     bodyBottomRichText (boolean):\n *         Whether the ``bodyBottom`` field should be rendered as Markdown.\n *\n *     draftReply (RB.ReviewReply):\n *         The draft reply to this review, if any.\n *\n *     htmlTextFields (object):\n *         The contents of any HTML-rendered text fields, if the caller fetches\n *         or posts with ``includeTextTypes=html``. The keys in this object are\n *         the field names, and the values are the HTML versions of those\n *         attributes.\n *\n *     includeTextTypes (string):\n *         A comma-separated list of text types to include in the payload when\n *         syncing the model.\n *\n *     markdownTextFields (object):\n *         The source contents of any Markdown text fields, if the caller\n *         fetches or posts with ``includeTextTypes=markdown``. The keys in\n *         this object are the field names, and the values are the Markdown\n *         source of those fields.\n *\n *     rawTextFields (object):\n *         The contents of the raw text fields, if the caller fetches or posts\n *         with includeTextTypes=raw. The keys in this object are the field\n *         names, and the values are the raw versions of those attributes.\n *\n *     timestamp (string):\n *         The timestamp of this review.\n */\nRB.Review = RB.BaseResource.extend({\n    defaults() {\n        return _.defaults({\n            forceTextType: null,\n            shipIt: false,\n            'public': false,\n            bodyTop: null,\n            bodyTopRichText: false,\n            bodyBottom: null,\n            bodyBottomRichText: false,\n            draftReply: null,\n            htmlTextFields: {},\n            includeTextTypes: null,\n            markdownTextFields: {},\n            rawTextFields: {},\n            timestamp: null\n        }, RB.BaseResource.prototype.defaults());\n    },\n\n    rspNamespace: 'review',\n\n    attrToJsonMap: {\n        bodyBottom: 'body_bottom',\n        bodyBottomRichText: 'body_bottom_text_type',\n        bodyTop: 'body_top',\n        bodyTopRichText: 'body_top_text_type',\n        forceTextType: 'force_text_type',\n        includeTextTypes: 'include_text_types',\n        shipIt: 'ship_it'\n    },\n\n    serializedAttrs: [\n        'forceTextType',\n        'includeTextTypes',\n        'shipIt',\n        'bodyTop',\n        'bodyTopRichText',\n        'bodyBottom',\n        'bodyBottomRichText',\n        'public'\n    ],\n\n    deserializedAttrs: [\n        'shipIt',\n        'bodyTop',\n        'bodyBottom',\n        'public',\n        'timestamp'\n    ],\n\n    serializers: {\n        forceTextType: RB.JSONSerializers.onlyIfValue,\n        includeTextTypes: RB.JSONSerializers.onlyIfValue,\n        bodyTopRichText: RB.JSONSerializers.textType,\n        bodyBottomRichText: RB.JSONSerializers.textType,\n        'public': value => value ? 1 : undefined\n    },\n\n    supportsExtraData: true,\n\n    /**\n     * Parse the response from the server.\n     *\n     * Args:\n     *    rsp (object):\n     *        The response from the server.\n     *\n     * Returns:\n     *     object:\n     *     Attribute values to set on the model.\n     */\n    parseResourceData(rsp) {\n        const rawTextFields = rsp.raw_text_fields || rsp;\n        const data = RB.BaseResource.prototype.parseResourceData.call(\n            this, rsp);\n\n        data.bodyTopRichText =\n            (rawTextFields.body_top_text_type === 'markdown');\n        data.bodyBottomRichText =\n            (rawTextFields.body_bottom_text_type === 'markdown');\n\n        if (rsp.raw_text_fields) {\n            data.rawTextFields = {\n                bodyBottom: rsp.raw_text_fields.body_bottom,\n                bodyTop: rsp.raw_text_fields.body_top\n            };\n        }\n\n        if (rsp.markdown_text_fields) {\n            data.markdownTextFields = {\n                bodyBottom: rsp.markdown_text_fields.body_bottom,\n                bodyTop: rsp.markdown_text_fields.body_top\n            };\n        }\n\n        if (rsp.html_text_fields) {\n            data.htmlTextFields = {\n                bodyBottom: rsp.html_text_fields.body_bottom,\n                bodyTop: rsp.html_text_fields.body_top,\n            };\n        }\n\n        return data;\n    },\n\n    /**\n     * Create a new diff comment for this review.\n     *\n     * Args:\n     *     options (object):\n     *         Options for creating the review.\n     *\n     * Option Args:\n     *     id (number):\n     *         The ID for the new model (in the case of existing comments).\n     *\n     *     fileDiffID (number):\n     *         The ID of the FileDiff that this comment is for.\n     *\n     *     interFileDiffID (number):\n     *         The ID of the FileDiff that represents the \"new\" side of an\n     *         interdiff. If this is specified, the ``fileDiffID`` argument\n     *         represents the \"old\" side.\n     *\n     *         This option is mutually exclusive with ``baseFileDiffID``.\n     *\n     *     beginLineNum (number):\n     *         The line number of the start of the comment.\n     *\n     *     endLineNum (number):\n     *         The line number of the end of the comment.\n     *\n     *     baseFileDiffID (number):\n     *         The ID of the base FileDiff in the cumulative diff that the\n     *         comment is to be made upon.\n     *\n     *         This option is mutually exclusive with ``interFileDiffID``.\n     *\n     * Returns:\n     *     RB.DiffComment:\n     *     The new comment object.\n     */\n    createDiffComment(...args) {\n        let options;\n\n        if (args.length === 1) {\n            options = args[0];\n        } else {\n            console.warn([\n                'RB.Review.createDiffComment(id, fileDiffID, ',\n                'interFileDiffID, beginLineNum, endLineNum) is deprecated. ',\n                'Use RB.Review.createDiffComment(options) instead.',\n            ].join(''));\n\n            options = {\n                id: args[0],\n                fileDiffID: args[1],\n                interFileDiffID: args[2],\n                beginLineNum: args[3],\n                endLineNum: args[4],\n            };\n        }\n\n        if (!!options.interFileDiffID && !!options.baseFileDiffID) {\n            console.error(\n                'Options `interFileDiffID` and `baseFileDiffID` for ' +\n                'RB.Review.createDiffComment() are mutually exclusive.');\n            return;\n        }\n\n        return new RB.DiffComment(_.defaults({parentObject: this}, options));\n    },\n\n    /**\n     * Create a new screenshot comment for this review.\n     *\n     * Args:\n     *     id (number):\n     *         The ID for the new model (in the case of existing comments).\n     *\n     *     screenshotID (number):\n     *         The ID of the Screenshot that this comment is for.\n     *\n     *     x (number):\n     *         The X coordinate of the pixel for the upper left of the comment\n     *         region.\n     *\n     *     y (number):\n     *         The Y coordinate of the pixel for the upper left of the comment\n     *         region.\n     *\n     *     width (number):\n     *         The width of the comment region, in pixels.\n     *\n     *     height (number):\n     *         The height of the comment region, in pixels.\n     *\n     * Returns:\n     *     RB.ScreenshotComment:\n     *     The new comment object.\n     */\n    createScreenshotComment(id, screenshotID, x, y, width, height) {\n        return new RB.ScreenshotComment({\n            parentObject: this,\n            id: id,\n            screenshotID: screenshotID,\n            x: x,\n            y: y,\n            width: width,\n            height: height\n        });\n    },\n\n    /**\n     * Create a new file attachment comment for this review.\n     *\n     * Args:\n     *     id (number):\n     *         The ID for the new model (in the case of existing comments).\n     *\n     *     fileAttachmentID (number):\n     *         The ID of the FileAttachment that this comment is for.\n     *\n     *     diffAgainstFileAttachmentID (number):\n     *         The ID of the FileAttachment that the ``fileAttachmentID`` is\n     *         diffed against, if the comment is for a file diff.\n     *\n     * Returns:\n     *     RB.FileAttachmentComment:\n     *     The new comment object.\n     */\n    createFileAttachmentComment(id, fileAttachmentID,\n                                diffAgainstFileAttachmentID) {\n        return new RB.FileAttachmentComment({\n            parentObject: this,\n            id: id,\n            fileAttachmentID: fileAttachmentID,\n            diffAgainstFileAttachmentID: diffAgainstFileAttachmentID\n        });\n    },\n\n    /**\n     * Create a new general comment for this review.\n     *\n     * Args:\n     *     id (number):\n     *         The ID for the new model (in the case of existing comments).\n     *\n     *     issueOpened (boolean):\n     *         Whether this comment should have an open issue.\n     *\n     * Returns:\n     *     RB.GeneralComment:\n     *     The new comment object.\n     */\n    createGeneralComment(id, issueOpened) {\n        return new RB.GeneralComment({\n            parentObject: this,\n            id: id,\n            issueOpened: issueOpened\n        });\n    },\n\n    /**\n     * Create a new reply.\n     *\n     * If an existing draft reply exists, return that. Otherwise create a draft\n     * reply.\n     *\n     * Returns:\n     *     RB.ReviewReply:\n     *     The new reply object.\n     */\n    createReply() {\n        let draftReply = this.get('draftReply');\n\n        if (draftReply === null) {\n            draftReply = new RB.ReviewReply({\n                parentObject: this\n            });\n            this.set('draftReply', draftReply);\n\n            draftReply.once('published', () => {\n                const reviewRequest = this.get('parentObject');\n                reviewRequest.markUpdated(draftReply.get('timestamp'));\n                this.set('draftReply', null);\n            });\n        }\n\n        return draftReply;\n    }\n});\n"],"mappings":"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"}