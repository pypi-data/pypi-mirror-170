{"version":3,"file":"commitView.js","names":["RB","CommitView","Backbone","View","extend","className","template","_","_dialogBodyTemplate","events","render","model","get","$el","addClass","commitID","length","slice","date","html","defaults","revision","author","toISOString","attributes","$","timesince","_onClick","dialogView","DialogView","title","body","prefixText","summary","suffixText","buttons","id","label","primary","onClick","_createReviewRequest","bind","show","url","window","location","trigger","showProgress","cancelProgress","hide","strings","COMMIT_NOT_ACCESSIBLE"],"sources":["../../../../../../static/rb/js/newReviewRequest/views/commitView.es6.js"],"sourcesContent":["/**\n * A view for a committed revision.\n *\n * This is used specifically for new review request creation. A click on the\n * element will either navigate the page to the review request (if one exists),\n * or emit a 'create' event.\n */\nRB.CommitView = Backbone.View.extend({\n    className: 'commit',\n\n    /**\n     * Template for the main view.\n     */\n    template: _.template(dedent`\n        <div class=\"progress\">\n         <span class=\"fa fa-spinner fa-pulse\"></span>\n        </div>\n        <% if (accessible) { %>\n         <div class=\"summary\">\n          <% if (reviewRequestURL) { %>\n           <span class=\"fa fa-arrow-circle-right jump-to-commit\"/>\n          <% } %>\n          <%- summary %>\n         </div>\n        <% } %>\n        <div class=\"commit-info\">\n         <span class=\"revision\">\n          <span class=\"fa fa-code-fork\"></span>\n          <%- revision %>\n          <% if (!accessible) { %>\n           <%- RB.CommitView.strings.COMMIT_NOT_ACCESSIBLE %>\n          <% } %>\n         </span>\n         <% if (accessible && author) { %>\n          <span class=\"author\">\n           <span class=\"fa fa-user\"></span>\n           <%- author %>\n          </span>\n         <% } %>\n         <% if (date) { %>\n          <span class=\"time\">\n           <span class=\"fa fa-clock-o\"></span>\n           <time class=\"timesince\" datetime=\"<%- date %>\"></time>\n          </span>\n         <% } %>\n        </div>\n    `),\n\n    /**\n     * Template for the body content of the confirmation dialog.\n     */\n    _dialogBodyTemplate: _.template(dedent`\n        <p><%- prefixText %></p>\n        <p><code><%- commitID %>: <%- summary %></code></p>\n        <p><%- suffixText %></p>\n    `),\n\n    events: {\n        'click': '_onClick',\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.CommitView:\n     *     This object, for chaining.\n     */\n    render: function() {\n        if (!this.model.get('accessible')) {\n            this.$el.addClass('disabled');\n        }\n\n        let commitID = this.model.get('id');\n\n        if (commitID.length === 40) {\n            commitID = commitID.slice(0, 7);\n        }\n\n        if (this.model.get('reviewRequestURL')) {\n            this.$el.addClass('has-review-request');\n        }\n\n        const date = this.model.get('date');\n\n        this.$el.html(this.template(_.defaults({\n            revision: commitID,\n            author: this.model.get('authorName') || gettext('<unknown>'),\n            date: date ? date.toISOString() : null,\n        }, this.model.attributes)));\n\n        if (date) {\n            this.$('.timesince').timesince();\n        }\n\n        return this;\n    },\n\n    /**\n     * Handler for when the commit is clicked.\n     *\n     * Shows a confirmation dialog allowing the user to proceed or cancel.\n     */\n    _onClick() {\n        let commitID = this.model.get('id');\n\n        if (commitID.length > 7) {\n            commitID = commitID.slice(0, 7);\n        }\n\n        const dialogView = new RB.DialogView({\n            title: gettext('Create Review Request?'),\n            body: this._dialogBodyTemplate({\n                prefixText: gettext('You are creating a new review request from the following published commit:'),\n                commitID: commitID,\n                summary: this.model.get('summary'),\n                suffixText: gettext('Are you sure you want to continue?'),\n            }),\n            buttons: [\n                {\n                    id: 'cancel',\n                    label: gettext('Cancel'),\n                },\n                {\n                    id: 'create',\n                    label: gettext('Create Review Request'),\n                    primary: true,\n                    onClick: this._createReviewRequest.bind(this),\n                }\n            ]\n        });\n\n        dialogView.show();\n    },\n\n    /**\n     * Create a new review request for the selected commit.\n     *\n     * If a review request already exists for this commit, redirect the browser\n     * to it. If not, trigger the 'create' event.\n     */\n    _createReviewRequest() {\n        if (this.model.get('accessible')) {\n            const url = this.model.get('reviewRequestURL');\n\n            if (url) {\n                window.location = url;\n            } else {\n                this.model.trigger('create', this.model);\n            }\n        }\n    },\n\n    /**\n     * Toggle a progress indicator on for this commit.\n     */\n    showProgress() {\n        this.$('.progress').show();\n    },\n\n    /**\n     * Toggle a progress indicator off for this commit.\n     */\n    cancelProgress() {\n        this.$('.progress').hide();\n    },\n}, {\n    strings: {\n        COMMIT_NOT_ACCESSIBLE: gettext('(not accessible on this repository)'),\n    },\n});\n"],"mappings":"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"}