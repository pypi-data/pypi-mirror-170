{"version":3,"file":"serverActivityWidgetView.js","names":["RB","Admin","ServerActivityWidgetView","WidgetView","extend","renderWidget","previousHoverPoint","_$tooltip","$","_$chart","appendTo","$content","bind","ev","pos","item","dataIndex","x","Date","datapoint","toLocaleDateString","y","text","series","label","css","left","pageX","top","pageY","fadeIn","remove","_addClickAction","id","loadKey","_addToggleAction","_","toggleKey","listenTo","model","_update","loadData","options","$action","addFooterAction","html","click","preventDefault","stopPropagation","show","get","set","xaxis","mode","tickLength","min","moment","valueOf","max","yaxis","tickDecimals","grid","markings","axes","d","setUTCDate","getUTCDate","getUTCDay","setUTCSeconds","setUTCMinutes","setUTCHours","i","getTime","push","from","to","hoverable","points","radius","lines","legend","position","datasets","changeDescriptions","data","bars","color","comments","reviewRequests","reviews","length","plot"],"sources":["../../../../../../static/rb/js/admin/views/serverActivityWidgetView.es6.js"],"sourcesContent":["/**\n * Displays a graph of the activity on the server.\n */\nRB.Admin.ServerActivityWidgetView = RB.Admin.WidgetView.extend({\n    /**\n     * Render the widget.\n     */\n    renderWidget() {\n        let previousHoverPoint = null;\n\n        this._$tooltip = $();\n        this._$chart = $('<div class=\"rb-c-admin-server-activity-widget__chart\">')\n            .appendTo(this.$content)\n            .bind('plothover', (ev, pos, item) => {\n                if (item) {\n                    if (previousHoverPoint !== item.dataIndex) {\n                        const x = new Date(item.datapoint[0]).toLocaleDateString();\n                        const y = item.datapoint[1];\n\n                        previousHoverPoint = item.dataIndex;\n\n                        this._$tooltip = $('<div class=\"rb-c-admin-server-activity-widget-tooltip\">')\n                            .text(`${item.series.label} on ${x}: ${y}`)\n                            .appendTo('body')\n                            .css({\n                                left: `${item.pageX + 5}px`,\n                                top: `${item.pageY + 5}px`,\n                            })\n                            .fadeIn(200);\n                    }\n                } else {\n                    this._$tooltip.remove();\n                    this._$tooltip = $();\n                    previousHoverPoint = null;\n                }\n            });\n\n        this._addClickAction({\n            id: 'prev',\n            text: '<',\n            loadKey: 'prev',\n        });\n\n        this._addClickAction({\n            id: 'next',\n            text: '>',\n            loadKey: 'next',\n        });\n\n        this._addToggleAction({\n            id: 'show-reviews',\n            text: _('Reviews'),\n            toggleKey: 'reviews',\n        });\n\n        this._addToggleAction({\n            id: 'show-comments',\n            text: _('Comments'),\n            toggleKey: 'comments',\n        });\n\n\n        this._addToggleAction({\n            id: 'show-review-requests',\n            text: _('Review Requests'),\n            toggleKey: 'reviewRequests',\n        });\n\n        this._addToggleAction({\n            id: 'show-changes',\n            text: _('Changes'),\n            toggleKey: 'changeDescriptions',\n        });\n\n        this._addToggleAction({\n            id: 'show-legend',\n            text: _('Legend'),\n            toggleKey: 'legend',\n        });\n\n        this.listenTo(this.model, 'updated', this._update);\n\n        this.model.loadData('none');\n    },\n\n\n    /**\n     * Add a click action to the footer.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the action.\n     *\n     * Option Args:\n     *     id (string):\n     *         The ID for the action.\n     *\n     *     text (string):\n     *         The text to display.\n     *\n     *     loadKey (string):\n     *         The key to use when loading new data from the server.\n     */\n    _addClickAction(options) {\n        const $action = this.addFooterAction({\n            id: options.id,\n            html: `<a href=\"#\">${options.text}</a>`,\n        });\n\n        $action.click(ev => {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            this.model.loadData(options.loadKey);\n        });\n    },\n\n    /**\n     * Add a toggle action to the footer.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the action.\n     *\n     * Option Args:\n     *     id (string):\n     *         The ID for the action.\n     *\n     *     text (string):\n     *         The text to display.\n     *\n     *     toggleKey (string):\n     *         The key to toggle in the ``show`` settings for the model.\n     */\n    _addToggleAction(options) {\n        const $action = this.addFooterAction({\n            id: options.id,\n            html: `<a href=\"#\">${options.text}</a>`,\n        });\n\n        $action.click(ev => {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            const show = this.model.get('show');\n            show[options.toggleKey] = !show[options.toggleKey];\n            this.model.set('show', show);\n            this.model.loadData('same');\n        });\n    },\n\n    /**\n     * Update the displayed graph.\n     */\n    _update() {\n        const options = {\n            xaxis: {\n                mode: 'time',\n                tickLength: 1,\n                min: moment(this.model.get('rangeStart')).valueOf(),\n                max: moment(this.model.get('rangeEnd')).valueOf(),\n            },\n            yaxis: {\n                min: 0,\n                tickDecimals: 0,\n            },\n            grid: {\n                markings: axes => {\n                    // This will shade weekends.\n                    const markings = [];\n                    const d = new Date(axes.xaxis.min);\n\n                    // Go to the first Saturday.\n                    d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7));\n                    d.setUTCSeconds(0);\n                    d.setUTCMinutes(0);\n                    d.setUTCHours(0);\n\n                    let i = d.getTime();\n\n                    do {\n                        /*\n                         * When we don't set yaxis, the rectangle automatically\n                         * extends to infinity upwards and downwards.\n                         */\n                        markings.push({\n                            xaxis: {from: i, to: i + 2 * 24 * 60 * 60 * 1000},\n                        });\n                        i += 7 * 24 * 60 * 60 * 1000;\n                    } while (i < axes.xaxis.max);\n\n                    return markings;\n                },\n                hoverable: true,\n            },\n            series: {\n                points: {\n                    show: true,\n                    radius: 3,\n                },\n                lines: {\n                    show: true,\n                },\n            },\n            legend: {\n                position: 'nw',\n                show: this.model.get('show').legend,\n            },\n        };\n\n        const datasets = [];\n\n        if (this.model.get('show').changeDescriptions) {\n            datasets.push({\n                label: _('Change Descriptions'),\n                data: this.model.get('data').changeDescriptions,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 0,\n            });\n        }\n\n        if (this.model.get('show').comments) {\n            datasets.push({\n                label: _('Comments'),\n                data: this.model.get('data').comments,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 1,\n            });\n        }\n\n        if (this.model.get('show').reviewRequests) {\n            datasets.push({\n                label: _('Review Requests'),\n                data: this.model.get('data').reviewRequests,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 2,\n            });\n        }\n\n        if (this.model.get('show').reviews) {\n            datasets.push({\n                label: _('Reviews'),\n                data: this.model.get('data').reviews,\n                bars: { show: true, },\n                lines: { show: false, },\n                color: 3,\n            });\n        }\n\n        if (datasets.length === 0) {\n            datasets.push({\n                bars: { show: true, },\n                lines: { show: false, },\n            });\n        }\n\n        $.plot(this._$chart, datasets, options);\n    },\n});\n"],"mappings":"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"}