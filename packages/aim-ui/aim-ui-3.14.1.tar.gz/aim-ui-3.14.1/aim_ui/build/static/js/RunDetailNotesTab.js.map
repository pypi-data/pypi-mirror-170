{"version":3,"sources":["components/RouteLeavingGuard/RouteLeavingGuard.tsx","components/RouteLeavingGuard/index.ts","pages/RunDetail/RunDetailNotesTab/NoteTooltip.tsx","pages/RunDetail/RunDetailNotesTab/RunDetailNotesTab.tsx","pages/RunDetail/RunDetailNotesTab/index.ts","components/ConfirmModal/ConfirmModal.tsx"],"names":["RouteLeavingGuard","when","message","confirmBtnText","React","useState","openModal","setOpenModal","nextLocation","setNextLocation","confirmNavigation","setConfirmNavigation","history","useHistory","onBeforeUnload","event","preventDefault","returnValue","closeModal","useEffect","push","window","addEventListener","removeEventListener","location","showModal","pathname","ConfirmModal","open","onCancel","onSubmit","text","icon","name","statusType","title","NoteTooltip","children","ref","useRef","mounted","setMounted","parentNode","current","id","RunDetailNotesTab","runHash","useModel","notesModel","isLoading","noteData","notifyData","value","setValue","saveDisabled","setSaveDisabled","theme","setTheme","editorRef","initialize","analytics","ANALYTICS_EVENT_KEYS","runDetails","tabs","notes","tabView","destroy","content","RichEditorThemeColors","onNoteSave","useCallback","onNoteUpdate","onNoteCreate","onNoteChange","currentVal","isSaveDisabled","className","classNames","created_at","Tooltip","tint","moment","utc","local","format","updated_at","disabled","variant","size","onClick","placeholder","disableExtensions","tooltip","onChange","Spinner","length","NotificationContainer","handleClose","onNoteNotificationDelete","data","displayName","memo","NotesTab","props","onClose","aria-labelledby","aria-describedby","PaperProps","elevation","color","withOnlyIcon","component","weight","description","cancelBtnText","autoFocus","defaultProps"],"mappings":"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","file":"static/js/RunDetailNotesTab.js?version=e65a63bf384d67e3abe6","sourcesContent":["import React from 'react';\nimport { Prompt, useHistory } from 'react-router-dom';\n\nimport ConfirmModal from 'components/ConfirmModal/ConfirmModal';\nimport { Icon } from 'components/kit';\n\nimport { IRouteLeavingGuardProps } from './RouteLeavingGuard.d';\n\nfunction RouteLeavingGuard({\n  when,\n  message = 'Changes you made may not be saved.',\n  confirmBtnText = 'Leave',\n}: IRouteLeavingGuardProps) {\n  const [openModal, setOpenModal] = React.useState<boolean>(false);\n  const [nextLocation, setNextLocation] = React.useState<string>('');\n  const [confirmNavigation, setConfirmNavigation] = React.useState(false);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    if (confirmNavigation) {\n      history.push(nextLocation);\n      setConfirmNavigation(false);\n    }\n    window.addEventListener('beforeunload', onBeforeUnload);\n    return () => {\n      window.removeEventListener('beforeunload', onBeforeUnload);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [confirmNavigation, when]);\n\n  function onBeforeUnload(event: any): string | undefined {\n    if (!when) {\n      return;\n    } else {\n      event?.preventDefault();\n      if (event) {\n        event.returnValue =\n          'Your changes is not saved. Do you still want to leave';\n      }\n      return '';\n    }\n  }\n\n  function showModal(location: string): void {\n    setOpenModal(true);\n    setNextLocation(location);\n  }\n\n  function closeModal() {\n    setOpenModal(false);\n  }\n\n  function handleBlockedNavigation(location: Location | any): boolean {\n    if (!confirmNavigation) {\n      showModal(location.pathname);\n      return false;\n    }\n    return true;\n  }\n  function handleConfirm(): void {\n    closeModal();\n    if (nextLocation) {\n      setConfirmNavigation(true);\n    }\n  }\n\n  return (\n    <>\n      <Prompt when={when} message={handleBlockedNavigation} />\n      <ConfirmModal\n        open={openModal}\n        onCancel={closeModal}\n        onSubmit={handleConfirm}\n        text={message}\n        icon={<Icon name='warning-contained' />}\n        statusType='warning'\n        confirmBtnText={confirmBtnText}\n        title='Are you sure'\n      />\n    </>\n  );\n}\n\nexport default RouteLeavingGuard;\n","import RouteLeavingGuard from './RouteLeavingGuard';\n\nexport * from './RouteLeavingGuard.d';\n\nexport default RouteLeavingGuard;\n","import React from 'react';\n\nimport { INoteTooltipProps } from '../NotesTab/types';\n\nfunction NoteTooltip({ children }: INoteTooltipProps) {\n  const ref = React.useRef<any>(null);\n  const [mounted, setMounted] = React.useState<boolean>(false);\n\n  React.useEffect(() => {\n    if (!mounted) {\n      setMounted(true);\n    } else {\n      const parentNode: HTMLDivElement =\n        ref.current.parentNode.parentNode.parentNode;\n      if (parentNode.id !== 'notes-toolbar-popover') {\n        parentNode.id = 'notes-toolbar-popover';\n      }\n    }\n  }, [mounted]);\n\n  return <div ref={ref}>{children}</div>;\n}\n\nexport default NoteTooltip;\n","import React from 'react';\nimport classNames from 'classnames';\nimport Editor from 'rich-markdown-editor';\nimport moment from 'moment';\nimport { useModel } from 'hooks';\n\nimport { Tooltip } from '@material-ui/core';\n\nimport { Button, Icon, Text } from 'components/kit';\nimport NotificationContainer from 'components/NotificationContainer/NotificationContainer';\nimport Spinner from 'components/kit/Spinner';\nimport RouteLeavingGuard from 'components/RouteLeavingGuard';\n\nimport { ANALYTICS_EVENT_KEYS } from 'config/analytics/analyticsKeysMap';\nimport { RichEditorThemeColors } from 'config/colors/colors';\n\nimport * as analytics from 'services/analytics';\nimport notesModel from 'services/models/notes/notesModel';\n\nimport { INoteReqBody } from 'types/services/models/notes/notes';\n\nimport NoteTooltip from './NoteTooltip';\nimport { IRunDetailNotesTabProps } from './types';\n\nimport './RunDetailNotesTab.scss';\n\nfunction RunDetailNotesTab({\n  runHash,\n}: IRunDetailNotesTabProps): React.FunctionComponentElement<React.ReactNode> {\n  const { isLoading, noteData, notifyData } = useModel(notesModel)!;\n  const [value, setValue] = React.useState<string>('');\n  const [saveDisabled, setSaveDisabled] = React.useState<boolean>(true);\n  const [theme, setTheme] = React.useState<null | {}>(null);\n  const editorRef = React.useRef<Editor | any>(null);\n\n  React.useEffect(() => {\n    notesModel.initialize(runHash);\n    analytics.pageView(ANALYTICS_EVENT_KEYS.runDetails.tabs.notes.tabView);\n\n    return () => {\n      notesModel.destroy();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useEffect(() => {\n    if (editorRef.current) {\n      setValue(noteData?.id ? noteData?.content : '');\n      setTheme({\n        ...editorRef.current?.theme(),\n        ...RichEditorThemeColors,\n      });\n    }\n  }, [noteData]);\n\n  // CRUD handlers\n  const onNoteSave = React.useCallback((): void => {\n    setSaveDisabled(true);\n    if (noteData?.id) {\n      onNoteUpdate();\n    } else {\n      notesModel.onNoteCreate(runHash, {\n        content: editorRef.current.value(),\n      } as INoteReqBody);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [noteData?.id, runHash]);\n\n  const onNoteUpdate = React.useCallback((): void => {\n    notesModel.onNoteUpdate(runHash, {\n      content: editorRef.current.value(),\n    } as INoteReqBody);\n  }, [runHash]);\n\n  const onNoteChange = React.useCallback(\n    (currentVal: () => string): void => {\n      const isSaveDisabled: boolean = value === currentVal();\n      if (saveDisabled !== isSaveDisabled) {\n        setSaveDisabled(isSaveDisabled);\n      }\n    },\n    [saveDisabled, value],\n  );\n\n  return (\n    <section className='RunDetailNotesTab'>\n      <RouteLeavingGuard when={!saveDisabled} />\n      <div\n        className={classNames('RunDetailNotesTab__Editor', {\n          isLoading,\n        })}\n      >\n        <div className='RunDetailNotesTab__Editor__actionPanel'>\n          <div className='RunDetailNotesTab__Editor__actionPanel__info'>\n            {noteData?.created_at && (\n              <Tooltip title='Created at'>\n                <div className='RunDetailNotesTab__Editor__actionPanel__info-field'>\n                  <Icon name='calendar' />\n                  <Text tint={70}>\n                    {`${moment\n                      .utc(noteData?.created_at)\n                      .local()\n                      .format('YYYY-MM-DD HH:mm A')}`}\n                  </Text>\n                </div>\n              </Tooltip>\n            )}\n            {noteData?.updated_at && (\n              <Tooltip title='Updated at'>\n                <div className='RunDetailNotesTab__Editor__actionPanel__info-field'>\n                  <Icon name='time' />\n                  <Text tint={70}>\n                    {`${moment\n                      .utc(noteData?.updated_at)\n                      .local()\n                      .format('YYYY-MM-DD HH:mm A')}`}\n                  </Text>\n                </div>\n              </Tooltip>\n            )}\n          </div>\n          <Tooltip title='Save Note'>\n            <div>\n              <Button\n                disabled={saveDisabled || isLoading}\n                variant='contained'\n                size='small'\n                onClick={onNoteSave}\n              >\n                Save\n              </Button>\n            </div>\n          </Tooltip>\n        </div>\n        <Editor\n          ref={editorRef}\n          className='RunDetailNotesTab__Editor__container'\n          value={value}\n          placeholder='Leave your Note'\n          theme={theme || editorRef.current?.theme()}\n          disableExtensions={['table', 'image', 'container_notice']}\n          tooltip={({ children }) => {\n            return <NoteTooltip>{children}</NoteTooltip>;\n          }}\n          onChange={onNoteChange}\n        />\n        {isLoading && <Spinner />}\n      </div>\n      {notifyData!.length > 0 && (\n        <NotificationContainer\n          handleClose={notesModel.onNoteNotificationDelete}\n          data={notifyData!}\n        />\n      )}\n    </section>\n  );\n}\n\nRunDetailNotesTab.displayName = 'RunDetailNotesTab';\n\nexport default React.memo(RunDetailNotesTab);\n","import NotesTab from './RunDetailNotesTab';\n\nexport default NotesTab;\n","import React from 'react';\n\nimport { Dialog } from '@material-ui/core';\n\nimport { Button, Text, Icon } from 'components/kit';\nimport ErrorBoundary from 'components/ErrorBoundary/ErrorBoundary';\n\nimport { IConfirmModalProps } from 'types/components/ConfirmModal/ConfirmModal';\n\nimport './ConfirmModal.scss';\n\nfunction ConfirmModal(\n  props: IConfirmModalProps,\n): React.FunctionComponentElement<React.ReactNode> {\n  return (\n    <ErrorBoundary>\n      <Dialog\n        open={props.open}\n        onClose={props.onCancel}\n        aria-labelledby='dialog-title'\n        aria-describedby='dialog-description'\n        PaperProps={{\n          elevation: 10,\n        }}\n        className={`ConfirmModal ConfirmModal__${props.statusType}`}\n      >\n        <div className='ConfirmModal__Body'>\n          <Button\n            size='small'\n            className='ConfirmModal__Close__Icon'\n            color='secondary'\n            withOnlyIcon\n            onClick={props.onCancel}\n          >\n            <Icon name='close' />\n          </Button>\n\n          <div className='ConfirmModal__Title__Container'>\n            <div className='ConfirmModal__Icon'>{props.icon}</div>\n            {props.title && (\n              <Text size={16} tint={100} component='h4' weight={600}>\n                {props.title}\n              </Text>\n            )}\n          </div>\n\n          <div>\n            {props.description && (\n              <Text\n                className='ConfirmModal__description'\n                weight={400}\n                component='p'\n                id='dialog-description'\n              >\n                {props.description}\n              </Text>\n            )}\n\n            <div>\n              {props.text && (\n                <Text\n                  className='ConfirmModal__text'\n                  weight={400}\n                  component='p'\n                  size={14}\n                  id='dialog-description'\n                >\n                  {props.text || ''}\n                </Text>\n              )}\n              {props.children && props.children}\n            </div>\n          </div>\n        </div>\n\n        <div className='ConfirmModal__Footer'>\n          <Button\n            onClick={props.onCancel}\n            className='ConfirmModal__CancelButton'\n          >\n            {props.cancelBtnText}\n          </Button>\n          <Button\n            onClick={props.onSubmit}\n            color='primary'\n            variant='contained'\n            className='ConfirmModal__ConfirmButton'\n            autoFocus\n          >\n            {props.confirmBtnText}\n          </Button>\n        </div>\n      </Dialog>\n    </ErrorBoundary>\n  );\n}\n\nConfirmModal.defaultProps = {\n  confirmBtnText: 'Confirm',\n  cancelBtnText: 'Cancel',\n  statusType: 'info',\n};\n\nConfirmModal.displayName = 'ConfirmModal';\n\nexport default React.memo<IConfirmModalProps>(ConfirmModal);\n"],"sourceRoot":""}