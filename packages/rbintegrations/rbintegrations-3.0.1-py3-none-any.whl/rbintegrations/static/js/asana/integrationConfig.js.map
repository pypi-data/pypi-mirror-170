{"version":3,"file":"integrationConfig.js","names":["$","$accessToken","$workspace","$error","insertAfter","hide","selectize","create","dropdownParent","searchField","valueField","labelField","render","option","item","escape","name","onChange","value","val","options","$control","width","disable","showError","errorStr","html","_","show","lastKey","changeWorkspaceEnabled","throttle","apiKey","trim","length","load","callback","params","param","api_key","ajax","url","SITE_ROOT","type","success","res","result","enable","data","error","console","xhr","textStatus","errorThrown","on"],"sources":["../../../../../../rbintegrations/static/js/asana/integrationConfig.es6.js"],"sourcesContent":["$(function() {\n    const $accessToken = $('#id_asana_access_token');\n    const $workspace = $('#id_asana_workspace');\n    const $error = $('<div class=\"errorlist\">')\n        .insertAfter($accessToken)\n        .hide();\n\n    $workspace.selectize({\n        create: false,\n        dropdownParent: 'body',\n        searchField: 'name',\n        valueField: 'id',\n        labelField: 'name',\n        render: {\n            option(item, escape) {\n                return `<div>${escape(item.name)}</div>`;\n            },\n        },\n        onChange(value) {\n            $('#id_asana_workspace_name').val(this.options[value].name);\n        },\n    });\n\n    const selectize = $workspace[0].selectize;\n    selectize.$control.width($('#id_name').width());\n    selectize.disable();\n\n    function showError(errorStr) {\n        $error\n            .html(dedent`\n                <span class=\"rb-icon rb-icon-warning\"></span>\n                ${_.escape(errorStr)}\n            `)\n            .show();\n    }\n\n    let lastKey = null;\n\n    const changeWorkspaceEnabled = _.throttle(() => {\n        const apiKey = $accessToken.val().trim();\n\n        if (lastKey === apiKey) {\n            return;\n        }\n\n        lastKey = apiKey;\n        $error.hide();\n        selectize.disable();\n\n        if (apiKey.length === 0) {\n            return;\n        }\n\n        selectize.load(callback => {\n            const params = $.param({ api_key: apiKey });\n\n            $.ajax({\n                url: `${SITE_ROOT}rbintegrations/asana/workspaces/?${params}`,\n                type: 'GET',\n                success(res) {\n                    if (res.result === 'success') {\n                        selectize.enable();\n                        callback(res.data);\n                    } else if (res.result === 'error') {\n                        showError(res.error);\n                        callback();\n                    } else {\n                        console.error('Unexpected error when fetching ' +\n                                      'Asana workspace list',\n                                      res);\n                        showError('Unable to communicate with Asana');\n                        callback();\n                    }\n                },\n                error(xhr, textStatus, errorThrown) {\n                    console.error('Unexpected error when fetching ' +\n                                  'Asana workspace list',\n                                  xhr);\n                    showError('Unable to communicate with Asana');\n                    callback();\n                },\n            });\n        });\n    }, 100);\n\n    $accessToken.on('change keyup', changeWorkspaceEnabled);\n    changeWorkspaceEnabled();\n});\n"],"mappings":"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"}